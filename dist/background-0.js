LavaPack.loadBundle([[10,{"../../../shared/constants/network":5465,"../../../shared/modules/selectors/networks":5575,"../controllers/account-tracker-controller":143,"@metamask/utils":2835},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,s){Object.defineProperty(s,"__esModule",{value:!0}),s.AccountTrackerControllerInit=void 0;var r,n=e("@metamask/utils"),i=e("../../../shared/modules/selectors/networks"),a=e("../../../shared/constants/network"),o=(r=e("../controllers/account-tracker-controller"))&&r.__esModule?r:{default:r};s.AccountTrackerControllerInit=({controllerMessenger:e,initMessenger:t})=>{const{provider:s,blockTracker:r}=t.call("NetworkController:getSelectedNetworkClient")??{};(0,n.assert)(s,"Provider is required to initialize AccountTrackerController."),(0,n.assert)(r,"Block tracker is required to initialize AccountTrackerController.");return{persistedStateKey:null,memStateKey:null,controller:new o.default({state:{accounts:{}},messenger:e,provider:s,blockTracker:r,getNetworkIdentifier:e=>{const s=t.call("NetworkController:getState"),r=e??(0,i.getProviderConfig)({metamask:s});return r.type===a.NETWORK_TYPES.RPC&&r.rpcUrl?r.rpcUrl:r.type}})}}}}},{package:"$root$",file:"app/scripts/controller-init/account-tracker-controller-init.ts"}],[100,{"../../../shared/lib/sentry":5540,"../controllers/metametrics-controller":150,"../lib/segment":238},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,s){Object.defineProperty(s,"__esModule",{value:!0}),s.MetaMetricsControllerInit=void 0;var r,n=(r=e("../controllers/metametrics-controller"))&&r.__esModule?r:{default:r},i=e("../lib/segment"),a=e("../../../shared/lib/sentry");s.MetaMetricsControllerInit=({controllerMessenger:e,extension:t,persistedState:s})=>({controller:new n.default({state:s.MetaMetricsController,messenger:e,version:"13.5.0",environment:"staging",segment:i.segment,extension:t,captureException:a.captureException})})}}},{package:"$root$",file:"app/scripts/controller-init/metametrics-controller-init.ts"}],[101,{"./multichain-account-service-init":102,"./multichain-assets-controller-init":103,"./multichain-balances-controller-init":104,"./multichain-network-controller-init":105,"./multichain-rates-assets-controller-init":107,"./multichain-transactions-controller-init":108},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,s){Object.defineProperty(s,"__esModule",{value:!0}),Object.defineProperty(s,"MultichainAccountServiceInit",{enumerable:!0,get:function(){return r.MultichainAccountServiceInit}}),Object.defineProperty(s,"MultichainAssetsControllerInit",{enumerable:!0,get:function(){return n.MultichainAssetsControllerInit}}),Object.defineProperty(s,"MultichainAssetsRatesControllerInit",{enumerable:!0,get:function(){return c.MultichainAssetsRatesControllerInit}}),Object.defineProperty(s,"MultichainBalancesControllerInit",{enumerable:!0,get:function(){return i.MultichainBalancesControllerInit}}),Object.defineProperty(s,"MultichainNetworkControllerInit",{enumerable:!0,get:function(){return o.MultichainNetworkControllerInit}}),Object.defineProperty(s,"MultichainTransactionsControllerInit",{enumerable:!0,get:function(){return a.MultichainTransactionsControllerInit}});var r=e("./multichain-account-service-init"),n=e("./multichain-assets-controller-init"),i=e("./multichain-balances-controller-init"),a=e("./multichain-transactions-controller-init"),o=e("./multichain-network-controller-init"),c=e("./multichain-rates-assets-controller-init")}}},{package:"$root$",file:"app/scripts/controller-init/multichain/index.ts"}],[102,{"../../lib/util":276,"@metamask/multichain-account-service":2081},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,s){Object.defineProperty(s,"__esModule",{value:!0}),s.MultichainAccountServiceInit=void 0;var r=e("@metamask/multichain-account-service"),n=e("../../lib/util");s.MultichainAccountServiceInit=({controllerMessenger:e,initMessenger:t})=>{const s=new r.MultichainAccountService({messenger:e}),i=t.call("PreferencesController:getState");return t.subscribe("PreferencesController:stateChange",(0,n.previousValueComparator)((e,t)=>{const{useExternalServices:r}=e,{useExternalServices:n}=t;return r!==n&&s.setBasicFunctionality(n).catch(e=>{console.error("Failed to set basic functionality on MultichainAccountService:",e)}),!0},i)),{memStateKey:null,persistedStateKey:null,controller:s}}}}},{package:"$root$",file:"app/scripts/controller-init/multichain/multichain-account-service-init.ts"}],[103,{"@metamask/assets-controllers":1138},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,s){Object.defineProperty(s,"__esModule",{value:!0}),s.MultichainAssetsControllerInit=void 0;var r=e("@metamask/assets-controllers");s.MultichainAssetsControllerInit=({controllerMessenger:e,persistedState:t})=>({controller:new r.MultichainAssetsController({messenger:e,state:t.MultichainAssetsController})})}}},{package:"$root$",file:"app/scripts/controller-init/multichain/multichain-assets-controller-init.ts"}],[104,{"@metamask/assets-controllers":1138},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,s){Object.defineProperty(s,"__esModule",{value:!0}),s.MultichainBalancesControllerInit=void 0;var r=e("@metamask/assets-controllers");s.MultichainBalancesControllerInit=({controllerMessenger:e,persistedState:t})=>({controller:new r.MultichainBalancesController({messenger:e,state:t.MultichainBalancesController})})}}},{package:"$root$",file:"app/scripts/controller-init/multichain/multichain-balances-controller-init.ts"}],[105,{"./multichain-network-service-init":106,"@metamask/multichain-network-controller":2105},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,s){Object.defineProperty(s,"__esModule",{value:!0}),s.MultichainNetworkControllerInit=void 0;var r=e("@metamask/multichain-network-controller"),n=e("./multichain-network-service-init");s.MultichainNetworkControllerInit=({controllerMessenger:e,persistedState:t})=>{const s=(0,n.MultichainNetworkServiceInit)();return{controller:new r.MultichainNetworkController({messenger:e,state:t.MultichainNetworkController,networkService:s})}}}}},{package:"$root$",file:"app/scripts/controller-init/multichain/multichain-network-controller-init.ts"}],[106,{"@metamask/multichain-network-controller":2105},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,s){Object.defineProperty(s,"__esModule",{value:!0}),s.MultichainNetworkServiceInit=void 0;var r=e("@metamask/multichain-network-controller");s.MultichainNetworkServiceInit=()=>new r.MultichainNetworkService({fetch:window.fetch.bind(window)})}}},{package:"$root$",file:"app/scripts/controller-init/multichain/multichain-network-service-init.ts"}],[107,{"@metamask/assets-controllers":1138},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,s){Object.defineProperty(s,"__esModule",{value:!0}),s.MultichainAssetsRatesControllerInit=void 0;var r=e("@metamask/assets-controllers");s.MultichainAssetsRatesControllerInit=({controllerMessenger:e,persistedState:t})=>({controller:new r.MultichainAssetsRatesController({messenger:e,state:t.MultichainAssetsRatesController})})}}},{package:"$root$",file:"app/scripts/controller-init/multichain/multichain-rates-assets-controller-init.ts"}],[108,{"@metamask/multichain-transactions-controller":2143},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,s){Object.defineProperty(s,"__esModule",{value:!0}),s.MultichainTransactionsControllerInit=void 0;var r=e("@metamask/multichain-transactions-controller");s.MultichainTransactionsControllerInit=({controllerMessenger:e,persistedState:t})=>({controller:new r.MultichainTransactionsController({messenger:e,state:t.MultichainTransactionsController})})}}},{package:"$root$",file:"app/scripts/controller-init/multichain/multichain-transactions-controller-init.ts"}],[109,{"@metamask/notification-services-controller/notification-services":2249},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,s){Object.defineProperty(s,"__esModule",{value:!0}),s.NotificationServicesControllerInit=void 0;var r=e("@metamask/notification-services-controller/notification-services");s.NotificationServicesControllerInit=({controllerMessenger:e,persistedState:t})=>({controller:new r.Controller({messenger:e,state:t.NotificationServicesController,env:{featureAnnouncements:{platform:"extension",spaceId:":spaceId",accessToken:":accessToken"}}})})}}},{package:"$root$",file:"app/scripts/controller-init/notifications/notification-services-controller-init.ts"}],[1097,{"@metamask/base-controller":1203,"@metamask/controller-utils":1321},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,s){var r,n,i=this&&this.__classPrivateFieldGet||function(e,t,s,r){if("a"===s&&!r)throw new TypeError("Private accessor was defined without a getter");if("function"==typeof t?e!==t||!r:!t.has(e))throw new TypeError("Cannot read private member from an object whose class did not declare it");return"m"===s?r:"a"===s?r.call(e):r?r.value:t.get(e)};Object.defineProperty(s,"__esModule",{value:!0}),s.AddressBookController=s.getDefaultAddressBookControllerState=s.controllerName=s.AddressType=void 0;const a=e("@metamask/base-controller"),o=e("@metamask/controller-utils");var c;!function(e){e.externallyOwnedAccounts="EXTERNALLY_OWNED_ACCOUNTS",e.contractAccounts="CONTRACT_ACCOUNTS",e.nonAccounts="NON_ACCOUNTS"}(c||(s.AddressType=c={})),s.controllerName="AddressBookController";const l={addressBook:{persist:!0,anonymous:!1}};s.getDefaultAddressBookControllerState=()=>({addressBook:{}});class u extends a.BaseController{constructor({messenger:e,state:t}){const a={...(0,s.getDefaultAddressBookControllerState)(),...t};super({messenger:e,metadata:l,name:s.controllerName,state:a}),r.add(this),i(this,r,"m",n).call(this)}list(){const{addressBook:e}=this.state;return Object.keys(e).reduce((t,s)=>{const r=s;return[...t,...Object.values(e[r])]},[])}clear(){this.update(e=>{e.addressBook={}})}delete(e,t){if(t=(0,o.toChecksumHexAddress)(t),!([e,t].every(e=>(0,o.isSafeDynamicKey)(e))&&(0,o.isValidHexAddress)(t)&&this.state.addressBook[e]&&this.state.addressBook[e][t]))return!1;const s={...this.state.addressBook[e][t]};return this.update(s=>{const r=s.addressBook[e];r?.[t]&&(delete r[t],0===Object.keys(r).length&&delete s.addressBook[e])}),"*"!==String(e)&&this.messagingSystem.publish("AddressBookController:contactDeleted",s),!0}set(e,t,s=(0,o.toHex)(1),r="",n){if(e=(0,o.toChecksumHexAddress)(e),!(0,o.isValidHexAddress)(e))return!1;const i={address:e,chainId:s,isEns:!1,memo:r,name:t,addressType:n,lastUpdatedAt:Date.now()},a=(0,o.normalizeEnsName)(t);return a&&(i.name=a,i.isEns=!0),this.update(t=>{t.addressBook={...this.state.addressBook,[s]:{...this.state.addressBook[s],[e]:i}}}),"*"!==String(s)&&this.messagingSystem.publish("AddressBookController:contactUpdated",i),!0}}s.AddressBookController=u,r=new WeakSet,n=function(){this.messagingSystem.registerActionHandler(`${s.controllerName}:list`,this.list.bind(this)),this.messagingSystem.registerActionHandler(`${s.controllerName}:set`,this.set.bind(this)),this.messagingSystem.registerActionHandler(`${s.controllerName}:delete`,this.delete.bind(this))},s.default=u}}},{package:"@metamask/address-book-controller",file:"node_modules/@metamask/address-book-controller/dist/AddressBookController.cjs"}],[1098,{"./AddressBookController.cjs":1097},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,s){Object.defineProperty(s,"__esModule",{value:!0}),s.AddressBookController=s.getDefaultAddressBookControllerState=void 0;var r=e("./AddressBookController.cjs");Object.defineProperty(s,"getDefaultAddressBookControllerState",{enumerable:!0,get:function(){return r.getDefaultAddressBookControllerState}}),Object.defineProperty(s,"AddressBookController",{enumerable:!0,get:function(){return r.AddressBookController}})}}},{package:"@metamask/address-book-controller",file:"node_modules/@metamask/address-book-controller/dist/index.cjs"}],[1099,{"@metamask/base-controller":1203},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,s){var r,n,i=this&&this.__classPrivateFieldGet||function(e,t,s,r){if("a"===s&&!r)throw new TypeError("Private accessor was defined without a getter");if("function"==typeof t?e!==t||!r:!t.has(e))throw new TypeError("Cannot read private member from an object whose class did not declare it");return"m"===s?r:"a"===s?r.call(e):r?r.value:t.get(e)};Object.defineProperty(s,"__esModule",{value:!0}),s.AnnouncementController=void 0;const a=e("@metamask/base-controller"),o={announcements:{}},c={announcements:{persist:!0,anonymous:!0}};class l extends a.BaseController{constructor({messenger:e,state:t,allAnnouncements:s}){const a={...o,...t};super({messenger:e,metadata:c,name:"AnnouncementController",state:a}),r.add(this),i(this,r,"m",n).call(this,s)}resetViewed(){this.update(({announcements:e})=>{for(const t of Object.values(e))t.isShown=!1})}updateViewed(e){this.update(({announcements:t})=>{for(const s of Object.keys(e).map(Number))t[s].isShown=e[s]})}}s.AnnouncementController=l,r=new WeakSet,n=function(e){this.update(t=>{Object.values(e).forEach(e=>{t.announcements[e.id]=t.announcements[e.id]??{...e,isShown:!1}})})}}}},{package:"@metamask/announcement-controller",file:"node_modules/@metamask/announcement-controller/dist/AnnouncementController.cjs"}],[11,{"../../../../shared/constants/metametrics":5462,"../../../../shared/lib/trace":5546,"@metamask/account-tree-controller":1088},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,s){Object.defineProperty(s,"__esModule",{value:!0}),s.AccountTreeControllerInit=void 0;var r=e("@metamask/account-tree-controller"),n=e("../../../../shared/lib/trace"),i=e("../../../../shared/constants/metametrics");s.AccountTreeControllerInit=({controllerMessenger:e,persistedState:t,initMessenger:s})=>({controller:new r.AccountTreeController({messenger:e,state:t.AccountTreeController,config:{trace:n.trace,backupAndSync:{onBackupAndSyncEvent:e=>{s.call("MetaMetricsController:trackEvent",{category:i.MetaMetricsEventCategory.BackupAndSync,event:i.MetaMetricsEventName.ProfileActivityUpdated,properties:{event:e}})}}}})})}}},{package:"$root$",file:"app/scripts/controller-init/accounts/account-tree-controller-init.ts"}],[110,{"../../../../shared/modules/mv3.utils":5567,"../../controllers/push-notifications":164,"@metamask/notification-services-controller/push-services":2267,"@metamask/notification-services-controller/push-services/web":2275},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,s){Object.defineProperty(s,"__esModule",{value:!0}),s.NotificationServicesPushControllerInit=void 0;var r=e("@metamask/notification-services-controller/push-services"),n=e("@metamask/notification-services-controller/push-services/web"),i=e("../../../../shared/modules/mv3.utils"),a=e("../../controllers/push-notifications");s.NotificationServicesPushControllerInit=({controllerMessenger:e,persistedState:t})=>({controller:new r.Controller({messenger:e,state:{...r.defaultState,...t.NotificationServicesPushController},env:{apiKey:"",authDomain:"",storageBucket:"",projectId:"",messagingSenderId:"",appId:"",measurementId:"",vapidKey:""},config:{isPushFeatureEnabled:i.isManifestV3&&!0,platform:"extension",pushService:{createRegToken:n.createRegToken,deleteRegToken:n.deleteRegToken,subscribeToPushNotifications:(0,n.createSubscribeToPushNotifications)({messenger:e,onReceivedHandler:a.onPushNotificationReceived,onClickHandler:a.onPushNotificationClicked})}}})})}}},{package:"$root$",file:"app/scripts/controller-init/notifications/notification-services-push-controller-init.ts"}],[1100,{"./AnnouncementController.cjs":1099},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,s){Object.defineProperty(s,"__esModule",{value:!0}),s.AnnouncementController=void 0;var r=e("./AnnouncementController.cjs");Object.defineProperty(s,"AnnouncementController",{enumerable:!0,get:function(){return r.AnnouncementController}})}}},{package:"@metamask/announcement-controller",file:"node_modules/@metamask/announcement-controller/dist/index.cjs"}],[111,{"../controllers/onboarding":153},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,s){Object.defineProperty(s,"__esModule",{value:!0}),s.OnboardingControllerInit=void 0;var r,n=(r=e("../controllers/onboarding"))&&r.__esModule?r:{default:r};s.OnboardingControllerInit=({controllerMessenger:e,persistedState:t})=>({controller:new n.default({state:t.OnboardingController,messenger:e})})}}},{package:"$root$",file:"app/scripts/controller-init/onboarding-controller-init.ts"}],[112,{"../controllers/permissions":157,"../controllers/permissions/snaps/specifications":159,"@metamask/permission-controller":2297},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,s){Object.defineProperty(s,"__esModule",{value:!0}),s.PermissionControllerInit=void 0;var r=e("@metamask/permission-controller"),n=e("../controllers/permissions"),i=e("../controllers/permissions/snaps/specifications");s.PermissionControllerInit=({controllerMessenger:e,persistedState:t,initMessenger:s,getController:a})=>{const o=a("ApprovalController"),c=a("KeyringController");return{controller:new r.PermissionController({state:t.PermissionController,messenger:e,caveatSpecifications:(0,n.getCaveatSpecifications)({listAccounts:s.call.bind(s,"AccountsController:listAccounts"),findNetworkClientIdByChainId:s.call.bind(s,"NetworkController:findNetworkClientIdByChainId"),isNonEvmScopeSupported:s.call.bind(s,"MultichainRouter:isSupportedScope"),getNonEvmAccountAddresses:s.call.bind(s,"MultichainRouter:getSupportedAccounts")}),permissionSpecifications:{...(0,n.getPermissionSpecifications)(),...(0,i.getSnapPermissionSpecifications)(s,{addAndShowApprovalRequest:o.addAndShowApprovalRequest.bind(o),addNewKeyring:c.addNewKeyring.bind(c)})},unrestrictedMethods:n.unrestrictedMethods})}}}}},{package:"$root$",file:"app/scripts/controller-init/permission-controller-init.ts"}],[113,{"../controllers/preferences-controller":161},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,s){Object.defineProperty(s,"__esModule",{value:!0}),s.PreferencesControllerInit=void 0;var r=e("../controllers/preferences-controller");s.PreferencesControllerInit=({controllerMessenger:e,persistedState:t,initLangCode:s})=>({controller:new r.PreferencesController({state:{currentLocale:s??"",...t.PreferencesController},messenger:e})})}}},{package:"$root$",file:"app/scripts/controller-init/preferences-controller-init.ts"}],[114,{"@metamask/assets-controllers":1138},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,s){Object.defineProperty(s,"__esModule",{value:!0}),s.RatesControllerInit=void 0;var r=e("@metamask/assets-controllers");s.RatesControllerInit=({controllerMessenger:e,persistedState:t})=>({memStateKey:"MultichainRatesController",persistedStateKey:"MultichainRatesController",controller:new r.RatesController({state:t.MultichainRatesController,messenger:e,includeUsdRate:!0})})}}},{package:"$root$",file:"app/scripts/controller-init/rates-controller-init.ts"}],[115,{"../../../development/build/constants":500,"../lib/util":276,"@metamask/remote-feature-flag-controller":2414,"@metamask/utils":2835},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,s){Object.defineProperty(s,"__esModule",{value:!0}),s.RemoteFeatureFlagControllerInit=void 0,s.getConfigForRemoteFeatureFlagRequest=l;var r=e("@metamask/utils"),n=e("@metamask/remote-feature-flag-controller"),i=e("../../../development/build/constants"),a=e("../lib/util");const o={flask:n.DistributionType.Flask,main:n.DistributionType.Main,beta:n.DistributionType.Beta,experimental:n.DistributionType.Main},c={[i.ENVIRONMENT.DEVELOPMENT]:n.EnvironmentType.Development,[i.ENVIRONMENT.RELEASE_CANDIDATE]:n.EnvironmentType.ReleaseCandidate,[i.ENVIRONMENT.PRODUCTION]:n.EnvironmentType.Production};function l(){(0,r.assert)("main","METAMASK_BUILD_TYPE is not defined"),(0,r.assert)("staging","METAMASK_ENVIRONMENT is not defined");return{distribution:o.main||n.DistributionType.Main,environment:c.staging||n.EnvironmentType.Development}}s.RemoteFeatureFlagControllerInit=({controllerMessenger:e,initMessenger:t})=>{const s=t.call("PreferencesController:getState"),{distribution:r,environment:i}=l(),o=new n.RemoteFeatureFlagController({messenger:e,fetchInterval:9e5,disabled:!s.useExternalServices,getMetaMetricsId:()=>t.call("MetaMetricsController:getMetaMetricsId"),clientConfigApiService:new n.ClientConfigApiService({fetch:globalThis.fetch.bind(globalThis),config:{client:n.ClientType.Extension,distribution:r,environment:i}})});return t.subscribe("PreferencesController:stateChange",(0,a.previousValueComparator)((e,t)=>{const{useExternalServices:s}=e,{useExternalServices:r}=t;return r&&!s?(o.enable(),o.updateRemoteFeatureFlags().catch(e=>{console.error("Failed to update remote feature flags:",e)})):!r&&s&&o.disable(),!0},s)),{controller:o}}}}},{package:"$root$",file:"app/scripts/controller-init/remote-feature-flag-controller-init.ts"}],[116,{"./oauth-service-init":117,"./seedless-onboarding-controller-init":118},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,s){Object.defineProperty(s,"__esModule",{value:!0}),Object.defineProperty(s,"OAuthServiceInit",{enumerable:!0,get:function(){return r.OAuthServiceInit}}),Object.defineProperty(s,"SeedlessOnboardingControllerInit",{enumerable:!0,get:function(){return n.SeedlessOnboardingControllerInit}});var r=e("./oauth-service-init"),n=e("./seedless-onboarding-controller-init")}}},{package:"$root$",file:"app/scripts/controller-init/seedless-onboarding/index.ts"}],[117,{"../../services/oauth/oauth-service":494,"../../services/oauth/web-authenticator-factory":497},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,s){Object.defineProperty(s,"__esModule",{value:!0}),s.OAuthServiceInit=void 0;var r,n=(r=e("../../services/oauth/oauth-service"))&&r.__esModule?r:{default:r},i=e("../../services/oauth/web-authenticator-factory");s.OAuthServiceInit=e=>{const{controllerMessenger:t,getController:s}=e,r=s("MetaMetricsController");return{controller:new n.default({messenger:t,env:{googleClientId:"",appleClientId:""},webAuthenticator:(0,i.webAuthenticatorFactory)(),bufferedTrace:r.bufferedTrace.bind(r),bufferedEndTrace:r.bufferedEndTrace.bind(r)}),memStateKey:null,persistedStateKey:null}}}}},{package:"$root$",file:"app/scripts/controller-init/seedless-onboarding/oauth-service-init.ts"}],[118,{"../../lib/encryptor-factory":194,"../../services/oauth/config":491,"@metamask/seedless-onboarding-controller":2441},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,s){Object.defineProperty(s,"__esModule",{value:!0}),s.SeedlessOnboardingControllerInit=void 0;var r=e("@metamask/seedless-onboarding-controller"),n=e("../../lib/encryptor-factory"),i=e("../../services/oauth/config");s.SeedlessOnboardingControllerInit=e=>{const{initMessenger:t,controllerMessenger:s,persistedState:a}=e,o=(0,n.encryptorFactory)(6e5),c=(0,i.isDevOrTestBuild)()?r.Web3AuthNetwork.Devnet:r.Web3AuthNetwork.Mainnet;return{controller:new r.SeedlessOnboardingController({messenger:s,state:a.SeedlessOnboardingController,network:c,passwordOutdatedCacheTTL:15e3,refreshJWTToken:(...e)=>t.call("OAuthService:getNewRefreshToken",...e),revokeRefreshToken:(...e)=>t.call("OAuthService:revokeRefreshToken",...e),renewRefreshToken:(...e)=>t.call("OAuthService:renewRefreshToken",...e),encryptor:{decrypt:(e,t)=>o.decrypt(e,t),decryptWithDetail:(e,t)=>o.decryptWithDetail(e,t),decryptWithKey(e,t){let s;return s="string"==typeof t?JSON.parse(t):t,o.decryptWithKey(e,s)},encrypt:(e,t)=>o.encrypt(e,t),encryptWithDetail:(e,t)=>o.encryptWithDetail(e,t),importKey:e=>o.importKey(e)}})}}}}},{package:"$root$",file:"app/scripts/controller-init/seedless-onboarding/seedless-onboarding-controller-init.ts"}],[119,{"../lib/WeakRefObjectMap":177,"@metamask/selected-network-controller":2446},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,s){Object.defineProperty(s,"__esModule",{value:!0}),s.SelectedNetworkControllerInit=void 0;var r=e("@metamask/selected-network-controller"),n=e("../lib/WeakRefObjectMap");s.SelectedNetworkControllerInit=({controllerMessenger:e,persistedState:t})=>({controller:new r.SelectedNetworkController({state:t.SelectedNetworkController,messenger:e,domainProxyMap:new n.WeakRefObjectMap})})}}},{package:"$root$",file:"app/scripts/controller-init/selected-network-controller-init.ts"}],[12,{"../controllers/app-state-controller":146},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,s){Object.defineProperty(s,"__esModule",{value:!0}),s.AppStateControllerInit=void 0;var r=e("../controllers/app-state-controller");s.AppStateControllerInit=({controllerMessenger:e,persistedState:t,setLocked:s,extension:n})=>({controller:new r.AppStateController({messenger:e,state:t.AppStateController,onInactiveTimeout:()=>s(),extension:n})})}}},{package:"$root$",file:"app/scripts/controller-init/app-state-controller-init.ts"}],[120,{"../../../../shared/modules/environment":5559,"@metamask/shield-controller":2450},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,s){Object.defineProperty(s,"__esModule",{value:!0}),s.ShieldControllerInit=void 0;var r=e("@metamask/shield-controller"),n=e("../../../../shared/modules/environment");s.ShieldControllerInit=e=>{const{controllerMessenger:t,initMessenger:s,persistedState:i}=e,a=new r.ShieldController({messenger:t,state:i.ShieldController,backend:new r.ShieldRemoteBackend({getAccessToken:()=>s.call("AuthenticationController:getBearerToken"),fetch:fetch,baseUrl:"https://shield-rule-engine.dev-api.cx.metamask.io"})});return(0,n.getIsMetaMaskShieldFeatureEnabled)()&&a.start(),{controller:a}}}}},{package:"$root$",file:"app/scripts/controller-init/shield/shield-controller-init.ts"}],[121,{"../../../../shared/constants/smartTransactions":5474,"../../../../shared/modules/selectors":5574,"@metamask/smart-transactions-controller":2462,"@metamask/smart-transactions-controller/dist/types":2463},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,s){Object.defineProperty(s,"__esModule",{value:!0}),s.SmartTransactionsControllerInit=void 0;var r,n=(r=e("@metamask/smart-transactions-controller"))&&r.__esModule?r:{default:r},i=e("@metamask/smart-transactions-controller/dist/types"),a=e("../../../../shared/constants/smartTransactions"),o=e("../../../../shared/modules/selectors");s.SmartTransactionsControllerInit=e=>{const{controllerMessenger:t,initMessenger:s,getController:r,persistedState:c,getStateUI:l,getGlobalNetworkClientId:u,getAccountType:d,getDeviceModel:p,getHardwareTypeForMetric:h,trace:m}=e,g=r("TransactionController");return{controller:new n.default({supportedChainIds:(0,a.getAllowedSmartTransactionsChainIds)(),clientId:i.ClientId.Extension,getNonceLock:(e,t)=>g.getNonceLock(e,t||u()),confirmExternalTransaction:(...e)=>g.confirmExternalTransaction(...e),trackMetaMetricsEvent:s.call.bind(s,"MetaMetricsController:trackEvent"),state:c.SmartTransactionsController,messenger:t,getTransactions:(...e)=>g.getTransactions(...e),updateTransaction:(...e)=>g.updateTransaction(...e),getFeatureFlags:()=>{const e=l();return(0,o.getFeatureFlagsByChainId)(e)},getMetaMetricsProps:async()=>{var e;const{metamask:t}=l(),{internalAccounts:s}=t,r=null==s?void 0:s.selectedAccount,n=r?null==s||null===(e=s.accounts)||void 0===e?void 0:e[r]:null,i=(null==n?void 0:n.address)??"";if(!i)return{accountHardwareType:undefined,accountType:undefined,deviceModel:undefined};return{accountHardwareType:await h(i),accountType:await d(i),deviceModel:await p(i)}},trace:m})}}}}},{package:"$root$",file:"app/scripts/controller-init/smart-transactions/smart-transactions-controller-init.ts"}],[122,{"@metamask/snaps-controllers":2479},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,s){Object.defineProperty(s,"__esModule",{value:!0}),s.CronjobControllerInit=void 0;var r=e("@metamask/snaps-controllers");s.CronjobControllerInit=({controllerMessenger:e,persistedState:t,getCronjobControllerStorageManager:s})=>({controller:new r.CronjobController({state:t.CronjobController,messenger:e,stateManager:s()}),persistedStateKey:null})}}},{package:"$root$",file:"app/scripts/controller-init/snaps/cronjob-controller-init.ts"}],[123,{"../../../../shared/modules/mv3.utils":5567,"@metamask/permission-controller":2297,"@metamask/snaps-controllers":2479,"@metamask/utils":2835},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,s){Object.defineProperty(s,"__esModule",{value:!0}),s.ExecutionServiceInit=void 0;var r=e("@metamask/snaps-controllers"),n=e("@metamask/utils"),i=e("@metamask/permission-controller"),a=e("../../../../shared/modules/mv3.utils");s.ExecutionServiceInit=({controllerMessenger:e,offscreenPromise:t,setupUntrustedCommunicationEip1193:s})=>{function o(e,t){s({connectionStream:t,sender:{snapId:e},subjectType:i.SubjectType.Snap})}if(a.isManifestV3&&"undefined"!=typeof chrome&&void 0!==chrome.offscreen)return{memStateKey:null,persistedStateKey:null,controller:new r.OffscreenExecutionService({messenger:e,setupSnapProvider:o,offscreenPromise:t})};const c="https://execution.metamask.io/iframe/10.2.1/index.html";return(0,n.assert)(c,"Missing iframe URL."),{memStateKey:null,persistedStateKey:null,controller:new r.IframeExecutionService({messenger:e,iframeUrl:new URL(c),setupSnapProvider:o})}}}}},{package:"$root$",file:"app/scripts/controller-init/snaps/execution-service-init.ts"}],[124,{"./cronjob-controller-init":122,"./execution-service-init":123,"./rate-limit-controller-init":125,"./snap-controller-init":126,"./snap-insights-controller-init":127,"./snap-interface-controller-init":128,"./snaps-name-provider-init":129,"./snaps-registry-init":130,"./websocket-service-init":131},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,s){Object.defineProperty(s,"__esModule",{value:!0}),Object.defineProperty(s,"CronjobControllerInit",{enumerable:!0,get:function(){return r.CronjobControllerInit}}),Object.defineProperty(s,"ExecutionServiceInit",{enumerable:!0,get:function(){return n.ExecutionServiceInit}}),Object.defineProperty(s,"RateLimitControllerInit",{enumerable:!0,get:function(){return i.RateLimitControllerInit}}),Object.defineProperty(s,"SnapControllerInit",{enumerable:!0,get:function(){return a.SnapControllerInit}}),Object.defineProperty(s,"SnapInsightsControllerInit",{enumerable:!0,get:function(){return o.SnapInsightsControllerInit}}),Object.defineProperty(s,"SnapInterfaceControllerInit",{enumerable:!0,get:function(){return c.SnapInterfaceControllerInit}}),Object.defineProperty(s,"SnapsNameProviderInit",{enumerable:!0,get:function(){return l.SnapsNameProviderInit}}),Object.defineProperty(s,"SnapsRegistryInit",{enumerable:!0,get:function(){return u.SnapsRegistryInit}}),Object.defineProperty(s,"WebSocketServiceInit",{enumerable:!0,get:function(){return d.WebSocketServiceInit}});var r=e("./cronjob-controller-init"),n=e("./execution-service-init"),i=e("./rate-limit-controller-init"),a=e("./snap-controller-init"),o=e("./snap-insights-controller-init"),c=e("./snap-interface-controller-init"),l=e("./snaps-name-provider-init"),u=e("./snaps-registry-init"),d=e("./websocket-service-init")}}},{package:"$root$",file:"app/scripts/controller-init/snaps/index.ts"}],[125,{"@metamask/notification-services-controller/notification-services":2249,"@metamask/rate-limit-controller":2411,loglevel:4573},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,s){Object.defineProperty(s,"__esModule",{value:!0}),s.RateLimitControllerInit=void 0;var r,n=e("@metamask/rate-limit-controller"),i=(r=e("loglevel"))&&r.__esModule?r:{default:r},a=e("@metamask/notification-services-controller/notification-services");s.RateLimitControllerInit=({controllerMessenger:e,initMessenger:t,persistedState:s,showNotification:r})=>({controller:new n.RateLimitController({state:s.RateLimitController,messenger:e,implementations:{showNativeNotification:{method:(e,s)=>{const n=t.call("SubjectMetadataController:getState").subjectMetadata[e];return r((null==n?void 0:n.name)??e,s).catch(e=>{i.default.error("Failed to create notification",e)}),null},rateLimitCount:2,rateLimitTimeout:3e5},showInAppNotification:{method:(e,s)=>{const{message:r,title:n,footerLink:i,interfaceId:o}=s,c={title:n,...i?{footerLink:i}:{},interfaceId:o},l={data:{message:r,origin:e,...o?{detailedView:c}:{}},type:a.TRIGGER_TYPES.SNAP,readDate:null};return t.call("NotificationServicesController:updateMetamaskNotificationsList",l),null},rateLimitCount:5,rateLimitTimeout:6e4}}}),memStateKey:null,persistedStateKey:null})}}},{package:"$root$",file:"app/scripts/controller-init/snaps/rate-limit-controller-init.ts"}],[126,{"../../../../shared/constants/keyring":5458,"../../../../shared/constants/snaps/permissions":5475,"../../lib/encryptor-factory":194,"../../lib/util":276,"@metamask/snaps-controllers":2479,"@metamask/utils":2835},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,s){Object.defineProperty(s,"__esModule",{value:!0}),s.SnapControllerInit=void 0;var r=e("@metamask/snaps-controllers"),n=e("@metamask/utils"),i=e("../../../../shared/constants/snaps/permissions"),a=e("../../lib/encryptor-factory"),o=e("../../../../shared/constants/keyring"),c=e("../../lib/util");s.SnapControllerInit=({initMessenger:e,controllerMessenger:t,persistedState:s,removeAllConnections:l,preinstalledSnaps:u})=>{const d=(0,c.getBooleanFlag)(!1),p=(0,c.getBooleanFlag)(!0),h=(0,c.getBooleanFlag)(!0);return{controller:new r.SnapController({dynamicPermissions:["endowment:caip25"],environmentEndowmentPermissions:Object.values(i.EndowmentPermissions),excludedPermissions:{...i.ExcludedSnapPermissions,...i.ExcludedSnapEndowments},closeAllConnections:l,state:s.SnapController,messenger:t,featureFlags:{allowLocalSnaps:d,requireAllowlist:p,rejectInvalidPlatformVersion:h,useCaip25Permission:!0},encryptor:(0,a.encryptorFactory)(6e5),getMnemonicSeed:async function(){const t=e.call("KeyringController:getKeyringsByType",o.KeyringType.hdKeyTree);if(!(t[0]&&(0,n.hasProperty)(t[0],"seed")&&t[0].seed instanceof Uint8Array))throw new Error("Primary keyring mnemonic unavailable.");return t[0].seed},preinstalledSnaps:u,getFeatureFlags:function(){return{disableSnaps:!1===e.call("PreferencesController:getState").useExternalServices}},trackEvent:e.call.bind(e,"MetaMetricsController:trackEvent")})}}}}},{package:"$root$",file:"app/scripts/controller-init/snaps/snap-controller-init.ts"}],[127,{"@metamask/snaps-controllers":2479},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,s){Object.defineProperty(s,"__esModule",{value:!0}),s.SnapInsightsControllerInit=void 0;var r=e("@metamask/snaps-controllers");s.SnapInsightsControllerInit=({controllerMessenger:e,persistedState:t})=>({controller:new r.SnapInsightsController({state:t.SnapInsightsController,messenger:e})})}}},{package:"$root$",file:"app/scripts/controller-init/snaps/snap-insights-controller-init.ts"}],[128,{"@metamask/snaps-controllers":2479},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,s){Object.defineProperty(s,"__esModule",{value:!0}),s.SnapInterfaceControllerInit=void 0;var r=e("@metamask/snaps-controllers");s.SnapInterfaceControllerInit=({controllerMessenger:e,persistedState:t})=>({controller:new r.SnapInterfaceController({state:t.SnapInterfaceController,messenger:e})})}}},{package:"$root$",file:"app/scripts/controller-init/snaps/snap-interface-controller-init.ts"}],[129,{"../../lib/SnapsNameProvider":176},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,s){Object.defineProperty(s,"__esModule",{value:!0}),s.SnapsNameProviderInit=void 0;var r=e("../../lib/SnapsNameProvider");s.SnapsNameProviderInit=({controllerMessenger:e})=>({persistedStateKey:null,memStateKey:null,controller:new r.SnapsNameProvider({messenger:e})})}}},{package:"$root$",file:"app/scripts/controller-init/snaps/snaps-name-provider-init.ts"}],[13,{"@metamask/assets-controllers":1138},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,s){Object.defineProperty(s,"__esModule",{value:!0}),s.AssetsContractControllerInit=void 0;var r=e("@metamask/assets-controllers");s.AssetsContractControllerInit=({controllerMessenger:e,getGlobalChainId:t})=>({controller:new r.AssetsContractController({messenger:e,chainId:t()}),memStateKey:null})}}},{package:"$root$",file:"app/scripts/controller-init/assets/assets-contract-controller-init.ts"}],[130,{"../../lib/util":276,"@metamask/snaps-controllers":2479},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,s){Object.defineProperty(s,"__esModule",{value:!0}),s.SnapsRegistryInit=void 0;var r=e("@metamask/snaps-controllers"),n=e("../../lib/util");s.SnapsRegistryInit=({controllerMessenger:e,persistedState:t})=>{const s=(0,n.getBooleanFlag)(!0);return{controller:new r.JsonSnapsRegistry({state:t.SnapsRegistry,messenger:e,refetchOnAllowlistMiss:s})}}}}},{package:"$root$",file:"app/scripts/controller-init/snaps/snaps-registry-init.ts"}],[131,{"@metamask/snaps-controllers":2479},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,s){Object.defineProperty(s,"__esModule",{value:!0}),s.WebSocketServiceInit=void 0;var r=e("@metamask/snaps-controllers");s.WebSocketServiceInit=({controllerMessenger:e})=>({memStateKey:null,persistedStateKey:null,controller:new r.WebSocketService({messenger:e})})}}},{package:"$root$",file:"app/scripts/controller-init/snaps/websocket-service-init.ts"}],[132,{"@metamask/permission-controller":2297},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,s){Object.defineProperty(s,"__esModule",{value:!0}),s.SubjectMetadataControllerInit=void 0;var r=e("@metamask/permission-controller");s.SubjectMetadataControllerInit=({controllerMessenger:e,persistedState:t})=>({controller:new r.SubjectMetadataController({state:t.SubjectMetadataController,messenger:e,subjectCacheLimit:100})})}}},{package:"$root$",file:"app/scripts/controller-init/subject-metadata-controller-init.ts"}],[1326,{"./constants.cjs":1327,"./utils.cjs":1329,"@metamask/base-controller":1203,"@metamask/keyring-controller":2022,"@metamask/utils":2835},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,s){var r,n,i=this&&this.__classPrivateFieldSet||function(e,t,s,r,n){if("m"===r)throw new TypeError("Private method is not writable");if("a"===r&&!n)throw new TypeError("Private accessor was defined without a setter");if("function"==typeof t?e!==t||!n:!t.has(e))throw new TypeError("Cannot write private member to an object whose class did not declare it");return"a"===r?n.call(e,s):n?n.value=s:t.set(e,s),s},a=this&&this.__classPrivateFieldGet||function(e,t,s,r){if("a"===s&&!r)throw new TypeError("Private accessor was defined without a getter");if("function"==typeof t?e!==t||!r:!t.has(e))throw new TypeError("Cannot read private member from an object whose class did not declare it");return"m"===s?r:"a"===s?r.call(e):r?r.value:t.get(e)};Object.defineProperty(s,"__esModule",{value:!0}),s.DelegationController=s.controllerName=void 0;const o=e("@metamask/base-controller"),c=e("@metamask/keyring-controller"),l=e("@metamask/utils"),u=e("./constants.cjs"),d=e("./utils.cjs");s.controllerName="DelegationController";const p={delegations:{persist:!0,anonymous:!1}};class h extends o.BaseController{constructor({messenger:e,state:t,hashDelegation:a,getDelegationEnvironment:o}){super({messenger:e,metadata:p,name:s.controllerName,state:{delegations:{},...t}}),r.set(this,void 0),n.set(this,void 0),i(this,r,a,"f"),i(this,n,o,"f")}async signDelegation(e){const{delegation:t,chainId:s}=e,{DelegationManager:r}=a(this,n,"f").call(this,s),i=(0,d.createTypedMessageParams)({chainId:(0,l.hexToNumber)(s),from:t.delegator,delegation:{...t,signature:"0x"},verifyingContract:r});return await this.messagingSystem.call("KeyringController:signTypedMessage",i,c.SignTypedDataVersion.V4)}store(e){const{entry:t}=e,s=a(this,r,"f").call(this,t.delegation);if(!(0,d.isHexEqual)(t.delegation.authority,u.ROOT_AUTHORITY)&&!this.state.delegations[t.delegation.authority])throw new Error("Invalid authority");this.update(e=>{e.delegations[s]=t})}list(e){const t=this.messagingSystem.call("AccountsController:getSelectedAccount").address;let s=Object.values(this.state.delegations);e?.from&&(s=s.filter(t=>(0,d.isHexEqual)(t.delegation.delegator,e.from))),(!e?.from||e?.from&&!(0,d.isHexEqual)(e.from,t))&&(s=s.filter(e=>(0,d.isHexEqual)(e.delegation.delegate,t)));const r=e?.chainId;r&&(s=s.filter(e=>(0,d.isHexEqual)(e.chainId,r)));const n=e?.tags;return n&&n.length>0&&(s=s.filter(e=>n.every(t=>e.tags.includes(t)))),s}retrieve(e){return this.state.delegations[e]??null}chain(e){const t=[],s=this.retrieve(e);if(!s)return null;t.push(s);for(let e=s.delegation.authority;e!==u.ROOT_AUTHORITY;){const s=this.retrieve(e);if(!s)throw new Error("Invalid delegation chain");t.push(s),e=s.delegation.authority}return t}delete(e){if(!this.retrieve(e))return 0;const t=Object.entries(this.state.delegations),s=[e],r=[];for(;s.length>0;){const e=s.pop();t.filter(([t,s])=>s.delegation.authority===e).forEach(([e])=>{s.push(e)}),r.push(e)}return this.update(e=>{r.forEach(t=>{delete e.delegations[t]})}),r.length}}s.DelegationController=h,r=new WeakMap,n=new WeakMap}}},{package:"@metamask/delegation-controller",file:"node_modules/@metamask/delegation-controller/dist/DelegationController.cjs"}],[1327,{},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,s){Object.defineProperty(s,"__esModule",{value:!0}),s.SIGNABLE_DELEGATION_TYPED_DATA=s.ROOT_AUTHORITY=void 0,s.ROOT_AUTHORITY="0xffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff";s.SIGNABLE_DELEGATION_TYPED_DATA={EIP712Domain:[{name:"name",type:"string"},{name:"version",type:"string"},{name:"chainId",type:"uint256"},{name:"verifyingContract",type:"address"}],Caveat:[{name:"enforcer",type:"address"},{name:"terms",type:"bytes"}],Delegation:[{name:"delegate",type:"address"},{name:"delegator",type:"address"},{name:"authority",type:"bytes32"},{name:"caveats",type:"Caveat[]"},{name:"salt",type:"uint256"}]}}}},{package:"@metamask/delegation-controller",file:"node_modules/@metamask/delegation-controller/dist/constants.cjs"}],[1328,{"./DelegationController.cjs":1326},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,s){Object.defineProperty(s,"__esModule",{value:!0}),s.DelegationController=void 0;var r=e("./DelegationController.cjs");Object.defineProperty(s,"DelegationController",{enumerable:!0,get:function(){return r.DelegationController}})}}},{package:"@metamask/delegation-controller",file:"node_modules/@metamask/delegation-controller/dist/index.cjs"}],[1329,{"./constants.cjs":1327,"@metamask/utils":2835},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,s){Object.defineProperty(s,"__esModule",{value:!0}),s.createTypedMessageParams=s.toDelegationStruct=s.isHexEqual=void 0;const r=e("@metamask/utils"),n=e("./constants.cjs");s.isHexEqual=function(e,t){return e.toLowerCase()===t.toLowerCase()};s.toDelegationStruct=e=>{const t=e.caveats.map(e=>({enforcer:(0,r.getChecksumAddress)(e.enforcer),terms:e.terms,args:e.args})),s="0x"===e.salt?0n:BigInt(e.salt);return{delegate:(0,r.getChecksumAddress)(e.delegate),delegator:(0,r.getChecksumAddress)(e.delegator),authority:e.authority,caveats:t,salt:s,signature:e.signature}},s.createTypedMessageParams=function(e){const{chainId:t,from:r,delegation:i,verifyingContract:a}=e;return{data:{types:n.SIGNABLE_DELEGATION_TYPED_DATA,primaryType:"Delegation",domain:{chainId:t,name:"DelegationManager",version:"1",verifyingContract:a},message:(0,s.toDelegationStruct)(i)},from:r}}}}},{package:"@metamask/delegation-controller",file:"node_modules/@metamask/delegation-controller/dist/utils.cjs"}],[133,{"./subscription-controller-init":134},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,s){Object.defineProperty(s,"__esModule",{value:!0}),Object.defineProperty(s,"SubscriptionControllerInit",{enumerable:!0,get:function(){return r.SubscriptionControllerInit}});var r=e("./subscription-controller-init")}}},{package:"$root$",file:"app/scripts/controller-init/subscription/index.ts"}],[1330,{},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,s){Object.defineProperty(s,"__esModule",{value:!0});var r={DelegationManager:"0xdb9B1e94B5b69Df7e401DDbedE43491141047dB3",EntryPoint:"0x0000000071727De22E5E9d8BAf0edAc6f37da032",SimpleFactory:"0x69Aa2f9fe1572F1B640E1bbc512f5c3a734fc77c",MultiSigDeleGatorImpl:"0x56a9EdB16a0105eb5a4C54f4C062e2868844f3A7",HybridDeleGatorImpl:"0x48dBe696A4D990079e039489bA2053B36E8FFEC4",EIP7702StatelessDeleGatorImpl:"0x63c0c19a282a1B52b07dD5a65b58948A07DAE32B",AllowedCalldataEnforcer:"0xc2b0d624c1c4319760C96503BA27C347F3260f55",AllowedMethodsEnforcer:"0x2c21fD0Cb9DC8445CB3fb0DC5E7Bb0Aca01842B5",AllowedTargetsEnforcer:"0x7F20f61b1f09b08D970938F6fa563634d65c4EeB",BlockNumberEnforcer:"0x5d9818dF0AE3f66e9c3D0c5029DAF99d1823ca6c",DeployedEnforcer:"0x24ff2AA430D53a8CD6788018E902E098083dcCd2",ERC20BalanceChangeEnforcer:"0xcdF6aB796408598Cea671d79506d7D48E97a5437",ERC20TransferAmountEnforcer:"0xf100b0819427117EcF76Ed94B358B1A5b5C6D2Fc",ERC20PeriodTransferEnforcer:"0x474e3Ae7E169e940607cC624Da8A15Eb120139aB",ERC20StreamingEnforcer:"0x56c97aE02f233B29fa03502Ecc0457266d9be00e",ERC721BalanceChangeEnforcer:"0x8aFdf96eDBbe7e1eD3f5Cd89C7E084841e12A09e",ERC721TransferEnforcer:"0x3790e6B7233f779b09DA74C72b6e94813925b9aF",ERC1155BalanceChangeEnforcer:"0x63c322732695cAFbbD488Fc6937A0A7B66fC001A",ExactCalldataBatchEnforcer:"0x982FD5C86BBF425d7d1451f974192d4525113DfD",ExactCalldataEnforcer:"0x99F2e9bF15ce5eC84685604836F71aB835DBBdED",ExactExecutionBatchEnforcer:"0x1e141e455d08721Dd5BCDA1BaA6Ea5633Afd5017",ExactExecutionEnforcer:"0x146713078D39eCC1F5338309c28405ccf85Abfbb",IdEnforcer:"0xC8B5D93463c893401094cc70e66A206fb5987997",LimitedCallsEnforcer:"0x04658B29F6b82ed55274221a06Fc97D318E25416",NativeBalanceChangeEnforcer:"0xbD7B277507723490Cd50b12EaaFe87C616be6880",ArgsEqualityCheckEnforcer:"0x44B8C6ae3C304213c3e298495e12497Ed3E56E41",NativeTokenPaymentEnforcer:"0x4803a326ddED6dDBc60e659e5ed12d85c7582811",NativeTokenTransferAmountEnforcer:"0xF71af580b9c3078fbc2BBF16FbB8EEd82b330320",NativeTokenStreamingEnforcer:"0xD10b97905a320b13a0608f7E9cC506b56747df19",NativeTokenPeriodTransferEnforcer:"0x9BC0FAf4Aca5AE429F4c06aEEaC517520CB16BD9",NonceEnforcer:"0xDE4f2FAC4B3D87A1d9953Ca5FC09FCa7F366254f",OwnershipTransferEnforcer:"0x7EEf9734E7092032B5C56310Eb9BbD1f4A524681",RedeemerEnforcer:"0xE144b0b2618071B4E56f746313528a669c7E65c5",SpecificActionERC20TransferBatchEnforcer:"0x00e0251aaA263dfE3B3541B758A82D1CBA1c3B6D",TimestampEnforcer:"0x1046bb45C8d673d4ea75321280DB34899413c069",ValueLteEnforcer:"0x92Bf12322527cAA612fd31a0e810472BBB106A8F",MultiTokenPeriodEnforcer:"0xFB2f1a9BD76d3701B730E5d69C3219D42D80eBb7"},n={DelegationManager:"0x56D56e07e3d6Ee5a24e30203A37a0a460f42D7A3",EntryPoint:"0x0000000071727De22E5E9d8BAf0edAc6f37da032",SimpleFactory:"0x6ff518884f21168c30c58CB21184D6AdBC18Ad90",MultiSigDeleGatorImpl:"0xd1f421EDbA5e3FA9efe3874827114b20C5BEC40C",HybridDeleGatorImpl:"0x941f3a016F8726d5643Ce62452d0D78492D42b42",AllowedCalldataEnforcer:"0xff71d60f3208469cBCE0859717B5198042DCB3F3",AllowedMethodsEnforcer:"0xe32C2561792e8446Abe73B9f557B881C13906186",AllowedTargetsEnforcer:"0x06aaE4c67EEA95277c46Bf79b1583d4a01772D22",BlockNumberEnforcer:"0x8E470D2Ae278457b42d2405E0B8Cd4BE21Ed9045",DeployedEnforcer:"0xf9088f013dBD9ebb7Cebd66fEB48253c6Ac5a820",ERC20BalanceGteEnforcer:"0xB7B6f32ec6343261D814e55Ed8C5925d91Cab861",ERC20TransferAmountEnforcer:"0x9A069b18032B31429A363AeCFb1B6A0564b44471",IdEnforcer:"0x91015c3b9D9523966eD2399885e5Df7A567f916c",LimitedCallsEnforcer:"0xe694bFfffEA3E85923b1210b37e6a0175e910863",NonceEnforcer:"0xE83BCFD8bBE672A96747e831050a91cf44F4F87A",TimestampEnforcer:"0x550FdD13eEBC1f22ea2a2480024BacBF0Ad7e5CE",ValueLteEnforcer:"0xBE32a6DB7471F63BB168C088c57Db01AfAe87967",NativeTokenTransferAmountEnforcer:"0x5eD3833d7B957A8DB8A461c3AF2d668Ec25382E0",NativeBalanceGteEnforcer:"0x376a98860E210DdEda3689fb39565592c563cB0A",ArgsEqualityCheckEnforcer:"0x7378dE585998d3E18Ce147867C335C25B3dB8Ee5",NativeTokenPaymentEnforcer:"0x87Fe18EbF99e42fcE8A03a25F1d20E119407f8e7",RedeemerEnforcer:"0x926672b130D1EF60A9d6b11D2048d121b30f40C1"},i={DelegationManager:"0xbe4138886cb096bdc1b930f2f0ca7892aa234d78",EntryPoint:"0x0000000071727De22E5E9d8BAf0edAc6f37da032",SimpleFactory:"0x6ff518884f21168c30c58CB21184D6AdBC18Ad90",MultiSigDeleGatorImpl:"0x11f555af5844d85bfcf5d61d2a22866527eb585a",HybridDeleGatorImpl:"0xd6edd1256deccb2b06bdecef92dc16bcf26e531b",AllowedCalldataEnforcer:"0x48db3835a873d64a4af2c09f014052407c003bd7",AllowedMethodsEnforcer:"0xfd731951bf1c52afccee3e6f14ab656475b76dd4",AllowedTargetsEnforcer:"0xbc8673c0afa52d86d991c06881e55b2966920564",BlockNumberEnforcer:"0xc15faffa0d879b9263c15a46ce31eacfa2e0e8ae",DeployedEnforcer:"0x5accb9559b56a6c1e3f90e342c85c42d93720d43",ERC20BalanceGteEnforcer:"0xb5d6b1ec6d868a3bae5b7f48178eaa2686a7a087",ERC20TransferAmountEnforcer:"0x92ac423b9c111962179a6242e1adb58d02c103be",IdEnforcer:"0x34152d9f3f8f74338d50703e780389e829b4abac",LimitedCallsEnforcer:"0x4b3adad4a328bee8ba17b86074d92fe7372180cd",NonceEnforcer:"0x2f32ff3fc3086d7f63f16fe8d0065390d460b40d",TimestampEnforcer:"0x78e05f779490c24bf3bfa135b4112e7003b321cd",ValueLteEnforcer:"0xfc20ede0a1132e839fbda9d7ed3904ff3c89540f"},a={mainnet:1,polygon:137,bsc:56,optimism:10,arbitrum:42161,linea:59144,base:8453,gnosis:100,sepolia:11155111,lineaSepolia:59141,baseSepolia:84532,megaEthTestnet:6342,chiado:10200,lineaGoerli:59140},o={"1.0.0":{[a.optimism]:i,[a.polygon]:i,[a.base]:i,[a.arbitrum]:i,[a.linea]:i,[a.sepolia]:{...i,HybridDeleGatorImpl:"0x5989F5D13DF8fc818EdA65e417AED90459fD67F7"},[a.lineaSepolia]:{...i,HybridDeleGatorImpl:"0x5989F5D13DF8fc818EdA65e417AED90459fD67F7"}},"1.1.0":{[a.arbitrum]:n,[a.base]:n,[a.linea]:n,[a.optimism]:n,[a.polygon]:n,[a.sepolia]:n,[a.lineaSepolia]:n,[a.baseSepolia]:{...n,SimpleFactory:"0xE8eA1DE8D6AfE400B7C8C1A81B7C29B7876b4d02"}},"1.3.0":{[a.mainnet]:r,[a.polygon]:r,[a.bsc]:r,[a.optimism]:r,[a.arbitrum]:r,[a.linea]:r,[a.base]:r,[a.gnosis]:r,[a.sepolia]:r,[a.lineaSepolia]:r,[a.baseSepolia]:r,[a.megaEthTestnet]:r,[a.chiado]:r}};s.CHAIN_ID=a,s.DELEGATOR_CONTRACTS=o}}},{package:"@metamask/delegation-deployments",file:"node_modules/@metamask/delegation-deployments/dist/index.js"}],[134,{"../../../../development/build/constants":500,"@metamask/subscription-controller":2738},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,s){Object.defineProperty(s,"__esModule",{value:!0}),s.SubscriptionControllerInit=void 0;var r=e("@metamask/subscription-controller"),n=e("../../../../development/build/constants");s.SubscriptionControllerInit=e=>{const{initMessenger:t,controllerMessenger:s,persistedState:i}=e,a=new r.SubscriptionService({env:"staging"===n.ENVIRONMENT.DEVELOPMENT||"staging"===n.ENVIRONMENT.TESTING?r.Env.UAT:r.Env.PRD,auth:{getAccessToken:()=>t.call("AuthenticationController:getBearerToken")}});return{controller:new r.SubscriptionController({messenger:s,state:i.SubscriptionController,subscriptionService:a})}}}}},{package:"$root$",file:"app/scripts/controller-init/subscription/subscription-controller-init.ts"}],[135,{"../controllers/swaps":165},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,s){Object.defineProperty(s,"__esModule",{value:!0}),s.SwapsControllerInit=void 0;var r,n=(r=e("../controllers/swaps"))&&r.__esModule?r:{default:r};s.SwapsControllerInit=({controllerMessenger:e,initMessenger:t,persistedState:s,getController:r})=>{const i=r("GasFeeController"),a=r("TransactionController");return{controller:new n.default({messenger:e,getBufferedGasLimit:async(e,s)=>{const r=t.call("NetworkController:getState"),{gas:n,simulationFails:i}=await a.estimateGasBuffered(e.txParams,s,r.selectedNetworkClientId);return{gasLimit:n,simulationFails:i}},getEIP1559GasFeeEstimates:(...e)=>i.fetchGasFeeEstimates(...e),getLayer1GasFee:(...e)=>a.getLayer1GasFee(...e),trackMetaMetricsEvent:t.call.bind(t,"MetaMetricsController:trackEvent")},s.SwapsController)}}}}},{package:"$root$",file:"app/scripts/controller-init/swaps-controller-init.ts"}],[136,{"@metamask/assets-controllers":1138},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,s){Object.defineProperty(s,"__esModule",{value:!0}),s.TokenBalancesControllerInit=void 0;var r=e("@metamask/assets-controllers");s.TokenBalancesControllerInit=({controllerMessenger:e,initMessenger:t,persistedState:s})=>{var n;const{useMultiAccountBalanceChecker:i}=t.call("PreferencesController:getState"),a=t.call("RemoteFeatureFlagController:getState"),o=(null==a||null===(n=a.remoteFeatureFlags)||void 0===n?void 0:n.assetsAccountApiBalances)??[];return{controller:new r.TokenBalancesController({messenger:e,state:s.TokenBalancesController,useAccountsAPI:!1,queryMultipleAccounts:i,interval:3e4,allowExternalServices:()=>t.call("PreferencesController:getState").useExternalServices,useAccountsApiBalances:o})}}}}},{package:"$root$",file:"app/scripts/controller-init/token-balances-controller-init.ts"}],[137,{"@metamask/assets-controllers":1138},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,s){Object.defineProperty(s,"__esModule",{value:!0}),s.TokenDetectionControllerInit=void 0;var r=e("@metamask/assets-controllers");s.TokenDetectionControllerInit=({controllerMessenger:e,initMessenger:t})=>({memStateKey:null,persistedStateKey:null,controller:new r.TokenDetectionController({messenger:e,getBalancesInSingleCall:(...e)=>t.call("AssetsContractController:getBalancesInSingleCall",...e),trackMetaMetricsEvent:(...e)=>t.call("MetaMetricsController:trackEvent",...e),useAccountsAPI:!0,platform:"extension",useTokenDetection:()=>t.call("PreferencesController:getState").useTokenDetection,useExternalServices:()=>t.call("PreferencesController:getState").useExternalServices})})}}},{package:"$root$",file:"app/scripts/controller-init/token-detection-controller-init.ts"}],[138,{"../lib/util":276,"@metamask/assets-controllers":1138},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,s){Object.defineProperty(s,"__esModule",{value:!0}),s.TokenListControllerInit=void 0;var r=e("@metamask/assets-controllers"),n=e("../lib/util");s.TokenListControllerInit=({controllerMessenger:e,initMessenger:t,persistedState:s})=>{const i=t.call("NetworkController:getState").selectedNetworkClientId,{chainId:a}=t.call("NetworkController:getNetworkClientById",i).configuration,o=t.call("PreferencesController:getState"),c=e=>{const{useTokenDetection:t,useTransactionSimulations:s,preferences:r}=e??{},{petnamesEnabled:n}=r??{};return t||n||s},l=new r.TokenListController({messenger:e,state:s.TokenListController,preventPollingOnNetworkRestart:!c(o),chainId:a});return t.subscribe("PreferencesController:stateChange",(0,n.previousValueComparator)((e,t)=>(((e,t)=>{const s=c(t),r=c(e);s!==r&&l.updatePreventPollingOnNetworkRestart(!r)})(t,e),!0),o)),{controller:l}}}}},{package:"$root$",file:"app/scripts/controller-init/token-list-controller-init.ts"}],[139,{"@metamask/assets-controllers":1138,"@metamask/utils":2835},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,s){Object.defineProperty(s,"__esModule",{value:!0}),s.TokensControllerInit=void 0;var r=e("@metamask/assets-controllers"),n=e("@metamask/utils");s.TokensControllerInit=({controllerMessenger:e,initMessenger:t,persistedState:s})=>{const i=t.call("NetworkController:getState").selectedNetworkClientId,{chainId:a}=t.call("NetworkController:getNetworkClientById",i).configuration,{provider:o}=t.call("NetworkController:getSelectedNetworkClient")??{};(0,n.assert)(o,"Provider is required to initialize TokensController.");return{controller:new r.TokensController({messenger:e,state:s.TokensController,provider:o,chainId:a})}}}}},{package:"$root$",file:"app/scripts/controller-init/tokens-controller-init.ts"}],[14,{"./assets-contract-controller-init":13,"./network-order-controller-init":15,"./nft-controller-init":16,"./nft-detection-controller-init":17,"./token-rates-controller-init":18},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,s){Object.defineProperty(s,"__esModule",{value:!0}),Object.defineProperty(s,"AssetsContractControllerInit",{enumerable:!0,get:function(){return a.AssetsContractControllerInit}}),Object.defineProperty(s,"NetworkOrderControllerInit",{enumerable:!0,get:function(){return o.NetworkOrderControllerInit}}),Object.defineProperty(s,"NftControllerInit",{enumerable:!0,get:function(){return n.NftControllerInit}}),Object.defineProperty(s,"NftDetectionControllerInit",{enumerable:!0,get:function(){return i.NftDetectionControllerInit}}),Object.defineProperty(s,"TokenRatesControllerInit",{enumerable:!0,get:function(){return r.TokenRatesControllerInit}});var r=e("./token-rates-controller-init"),n=e("./nft-controller-init"),i=e("./nft-detection-controller-init"),a=e("./assets-contract-controller-init"),o=e("./network-order-controller-init")}}},{package:"$root$",file:"app/scripts/controller-init/assets/index.ts"}],[140,{},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,s){}}},{package:"$root$",file:"app/scripts/controller-init/types.ts"}],[141,{"./messengers":57,"./types":140,"@metamask/utils":2835},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,s){Object.defineProperty(s,"__esModule",{value:!0}),s.initControllers=function({baseControllerMessenger:e,existingControllers:t=[],initFunctions:s,initRequest:r}){i("Initializing controllers",Object.keys(s).length);const a=t.reduce((e,t)=>(e[t.name]=t,e),{}),o={},c={};let l={};const u=e=>function(e,t){const s=e[t];if(!s)throw new Error(`Controller requested before it was initialized: ${t}`);return s}(a,e);for(const[t,d]of Object.entries(s)){const s=t,p=d,h=n.CONTROLLER_MESSENGERS[s],m=null==h?void 0:h.getMessenger,g=null==h?void 0:h.getInitMessenger,f={...r,controllerMessenger:null==m?void 0:m(e),getController:u,initMessenger:null==g?void 0:g(e)},y=p({...f,controllerMessenger:f.controllerMessenger}),{controller:w,persistedStateKey:v,memStateKey:b}=y,S=y.api??{},E=null===v?undefined:v??s,k=null===b?undefined:b??s;a[s]=w,l={...l,...S},E&&(o[E]=w),k&&(c[k]=w),i("Initialized controller",s,{api:Object.keys(S),persistedStateKey:E,memStateKey:k})}return{controllerApi:l,controllerMemState:c,controllerPersistedState:o,controllersByName:a}};var r=e("@metamask/utils"),n=(e("./types"),e("./messengers"));const i=(0,r.createProjectLogger)("controller-init")}}},{package:"$root$",file:"app/scripts/controller-init/utils.ts"}],[142,{"@metamask/base-controller":1203},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,s){Object.defineProperty(s,"__esModule",{value:!0}),s.AccountOrderController=void 0;var r=e("@metamask/base-controller");const n={pinnedAccountList:[],hiddenAccountList:[]},i={pinnedAccountList:{includeInStateLogs:!0,persist:!0,anonymous:!0,usedInUi:!0},hiddenAccountList:{includeInStateLogs:!0,persist:!0,anonymous:!0,usedInUi:!0}};class a extends r.BaseController{constructor({messenger:e,state:t}){super({messenger:e,metadata:i,name:"AccountOrderController",state:{...n,...t}})}updateAccountsList(e){this.update(t=>(t.pinnedAccountList=e,t))}updateHiddenAccountsList(e){this.update(t=>(t.hiddenAccountList=e,t))}}s.AccountOrderController=a}}},{package:"$root$",file:"app/scripts/controllers/account-order.ts"}],[143,{"../../../shared/constants/network":5465,"../constants/contracts":5,"../lib/util":276,"@ethersproject/contracts":635,"@ethersproject/providers":673,"@metamask/base-controller":1203,"@metamask/controller-utils":1321,"@metamask/utils":2835,lodash:4565,loglevel:4573,"single-call-balance-checker-abi":5316,uuid:5398},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,s){Object.defineProperty(s,"__esModule",{value:!0}),s.getDefaultAccountTrackerControllerState=s.default=void 0;var r=e("uuid"),n=g(e("loglevel")),i=e("@ethersproject/providers"),a=e("@ethersproject/contracts"),o=g(e("single-call-balance-checker-abi")),c=e("lodash"),l=e("@metamask/utils"),u=e("@metamask/base-controller"),d=e("@metamask/controller-utils"),p=e("../../../shared/constants/network"),h=e("../constants/contracts"),m=e("../lib/util");function g(e){return e&&e.__esModule?e:{default:e}}function f(e,t,s){y(e,t),t.set(e,s)}function y(e,t){if(t.has(e))throw new TypeError("Cannot initialize the same private elements twice on an object")}function w(e,t){return e.get(b(e,t))}function v(e,t,s){return e.set(b(e,t),s),s}function b(e,t,s){if("function"==typeof e?e===t:e.has(t))return arguments.length<3?t:s;throw new TypeError("Private element is not present on this object")}const S="AccountTrackerController",E={accounts:{includeInStateLogs:!1,persist:!0,anonymous:!1,usedInUi:!0},currentBlockGasLimit:{includeInStateLogs:!1,persist:!0,anonymous:!0,usedInUi:!0},accountsByChainId:{includeInStateLogs:!1,persist:!0,anonymous:!1,usedInUi:!0},currentBlockGasLimitByChainId:{includeInStateLogs:!1,persist:!0,anonymous:!0,usedInUi:!0}},k=()=>({accounts:{},currentBlockGasLimit:"",accountsByChainId:{},currentBlockGasLimitByChainId:{}});s.getDefaultAccountTrackerControllerState=k;var T=new WeakMap,M=new WeakMap,C=new WeakMap,I=new WeakMap,A=new WeakMap,_=new WeakMap,P=new WeakMap,N=new WeakSet,O=new WeakMap;class j extends u.BaseController{constructor(e){var t,s;super({name:S,metadata:E,state:{accounts:{},currentBlockGasLimit:"",accountsByChainId:{},currentBlockGasLimitByChainId:{},...e.state},messenger:e.messenger}),y(t=this,s=N),s.add(t),f(this,T,new Map),f(this,M,{}),f(this,C,void 0),f(this,I,void 0),f(this,A,{}),f(this,_,void 0),f(this,P,void 0),f(this,O,async e=>{await b(N,this,F).call(this,undefined,e)}),v(C,this,e.provider),v(I,this,e.blockTracker),v(_,this,e.getNetworkIdentifier),this.messagingSystem.subscribe("KeyringController:accountRemoved",e=>this.removeAccounts([e]));const r=this.messagingSystem.call("OnboardingController:getState");this.messagingSystem.subscribe("OnboardingController:stateChange",(0,m.previousValueComparator)((e,t)=>{const{completedOnboarding:s}=e,{completedOnboarding:r}=t;return!s&&r&&this.updateAccountsAllActiveNetworks(),!0},r)),v(P,this,this.messagingSystem.call("AccountsController:getSelectedAccount")),this.messagingSystem.subscribe("AccountsController:selectedEvmAccountChange",e=>{const{useMultiAccountBalanceChecker:t}=this.messagingSystem.call("PreferencesController:getState");w(P,this).id===e.id||t||(v(P,this,e),this.updateAccountsAllActiveNetworks())}),this._registerMessageHandlers()}resetState(){const{accounts:e,accountsByChainId:t,currentBlockGasLimit:s,currentBlockGasLimitByChainId:r}={accounts:{},currentBlockGasLimit:"",accountsByChainId:{},currentBlockGasLimitByChainId:{}};this.update(n=>{n.accounts=e,n.accountsByChainId=t,n.currentBlockGasLimit=s,n.currentBlockGasLimitByChainId=r})}start(){v(A,this,{[b(N,this,R).call(this)]:w(I,this).getCurrentBlock()}),w(I,this).once("latest",e=>{w(A,this)[b(N,this,R).call(this)]=e}),w(I,this).removeListener("latest",w(O,this)),w(I,this).addListener("latest",w(O,this)),this.updateAccounts()}stop(){w(I,this).removeListener("latest",w(O,this))}startPollingByNetworkClientId(e){const t=(0,r.v4)(),s=w(T,this).get(e);if(s)s.add(t);else{const s=new Set;s.add(t),w(T,this).set(e,s),b(N,this,L).call(this,e)}return t}stopAllPolling(){this.stop(),w(T,this).forEach((e,t)=>{e.forEach(e=>{this.stopPollingByPollingToken(e)})})}stopPollingByPollingToken(e){if(!e)throw new Error("pollingToken required");w(T,this).forEach((t,s)=>{t.has(e)&&(t.delete(e),0===t.size&&(w(T,this).delete(s),b(N,this,B).call(this,s)))})}syncWithAddresses(e){const{accounts:t}=this.state,s=Object.keys(t),r=[];e.forEach(e=>{s.includes(e)||r.push(e)});const n=[];s.forEach(t=>{e.includes(t)||n.push(t)}),this.addAccounts(r),this.removeAccounts(n)}addAccounts(e){const{accounts:t,accountsByChainId:s}=this.state,r=(0,c.cloneDeep)(t),n=(0,c.cloneDeep)(s);e.forEach(e=>{r[e]={}}),Object.keys(n).forEach(t=>{e.forEach(e=>{n[t][e]={}})}),this.update(e=>{e.accounts=r,e.accountsByChainId=n}),w(A,this)[b(N,this,R).call(this)]&&this.updateAccounts(),w(T,this).forEach((e,t)=>{const{chainId:s}=b(N,this,D).call(this,t);w(A,this)[s]&&this.updateAccounts(t)})}removeAccounts(e){const{accounts:t,accountsByChainId:s}=this.state,r=(0,c.cloneDeep)(t),n=(0,c.cloneDeep)(s);e.forEach(e=>{delete r[e]}),Object.keys(n).forEach(t=>{e.forEach(e=>{delete n[t][e]})}),this.update(e=>{e.accounts=r,e.accountsByChainId=n})}clearAccounts(){this.update(e=>{e.accounts={},e.accountsByChainId={[b(N,this,R).call(this)]:{}}})}async updateAccountsAllActiveNetworks(){await this.updateAccounts(),await Promise.all(Array.from(w(T,this)).map(([e])=>this.updateAccounts(e)))}async updateAccounts(e){const{completedOnboarding:t}=this.messagingSystem.call("OnboardingController:getState");if(!t)return;const{chainId:s,provider:r,identifier:n}=b(N,this,D).call(this,e),{useMultiAccountBalanceChecker:i}=this.messagingSystem.call("PreferencesController:getState");let a=[];if(i){const{accounts:e}=this.state;a=Object.keys(e)}else{a=[this.messagingSystem.call("AccountsController:getSelectedAccount").address]}n!==p.LOCALHOST_RPC_URL&&"http://127.0.0.1:8545"!==n&&s in h.SINGLE_CALL_BALANCES_ADDRESSES?await b(N,this,G).call(this,a,h.SINGLE_CALL_BALANCES_ADDRESSES[s],r,s):await Promise.all(a.map(e=>b(N,this,U).call(this,e,r,s)))}async updateAccountByAddress({address:e,networkClientId:t}={}){const{completedOnboarding:s}=this.messagingSystem.call("OnboardingController:getState");if(!s)return;const r=e||this.messagingSystem.call("AccountsController:getSelectedAccount").address;if(!r)return;const{chainId:n,provider:i}=b(N,this,D).call(this,t);await b(N,this,U).call(this,r,i,n)}updateNativeBalances(e){this.update(t=>{e.forEach(({address:e,chainId:s,balance:r})=>{t.accountsByChainId[s]||(t.accountsByChainId[s]={}),t.accountsByChainId[s][e]||(t.accountsByChainId[s][e]={address:e,balance:"0x0"}),r&&(t.accountsByChainId[s][e].balance=(0,d.toHex)(r))})})}updateStakedBalances(e){this.update(t=>{e.forEach(({address:e,chainId:s,stakedBalance:r})=>{t.accountsByChainId[s]||(t.accountsByChainId[s]={}),t.accountsByChainId[s][e]||(t.accountsByChainId[s][e]={address:e,balance:"0x0"}),r&&(t.accountsByChainId[s][e].stakedBalance=(0,d.toHex)(r))})})}_registerMessageHandlers(){this.messagingSystem.registerActionHandler(`${S}:updateNativeBalances`,this.updateNativeBalances.bind(this)),this.messagingSystem.registerActionHandler(`${S}:updateStakedBalances`,this.updateStakedBalances.bind(this))}}function R(){const{selectedNetworkClientId:e}=this.messagingSystem.call("NetworkController:getState"),{configuration:{chainId:t}}=this.messagingSystem.call("NetworkController:getNetworkClientById",e);return t}function D(e){if(e){const{configuration:t,provider:s,blockTracker:r}=this.messagingSystem.call("NetworkController:getNetworkClientById",e);return{chainId:t.chainId,provider:s,blockTracker:r,identifier:w(_,this).call(this,t)}}return{chainId:b(N,this,R).call(this),provider:w(C,this),blockTracker:w(I,this),identifier:w(_,this).call(this)}}function L(e){if(w(M,this)[e])return;const{blockTracker:t}=b(N,this,D).call(this,e),s=t=>b(N,this,F).call(this,e,t);t.addListener("latest",s),w(M,this)[e]=s,this.updateAccounts(e)}function B(e){if(!w(M,this)[e])return;const{blockTracker:t}=b(N,this,D).call(this,e);t.removeListener("latest",w(M,this)[e]),delete w(M,this)[e]}function x(e){const{accounts:t,accountsByChainId:s}=this.state;if(s[e])return(0,c.cloneDeep)(s[e]);const r={};return Object.keys(t).forEach(e=>{r[e]={}}),r}async function F(e,t){const{chainId:s,provider:r}=b(N,this,D).call(this,e);w(A,this)[s]=t;const i=await r.request({method:"eth_getBlockByNumber",params:[t,!1]});if(!i)return;const a=i.gasLimit;this.update(e=>{s===b(N,this,R).call(this)&&(e.currentBlockGasLimit=a),e.currentBlockGasLimitByChainId[s]=a});try{await this.updateAccounts(e)}catch(e){n.default.error(e)}}async function U(e,t,s){const{useMultiAccountBalanceChecker:r}=this.messagingSystem.call("PreferencesController:getState");let n="0x0";try{n=await t.request({method:"eth_getBalance",params:[e,"latest"]})}catch(e){if(e&&"object"==typeof e&&(0,l.hasProperty)(e,"data")&&e.data&&(0,l.hasProperty)(e.data,"request")&&e.data.request&&(0,l.hasProperty)(e.data.request,"method")&&"eth_getBalance"!==e.data.request.method)throw e}const i={address:e,balance:n},a=b(N,this,x).call(this,s);if(!a[e])return;let o=a;r||(o={},Object.keys(a).forEach(t=>{e!==t&&(o[t]={address:t,balance:null})})),o[e]=i,this.update(e=>{s===b(N,this,R).call(this)&&(e.accounts=o),e.accountsByChainId[s]=o})}async function G(e,t,s,r){const c=await new a.Contract(t,o.default,new i.Web3Provider(s)),l=["0x0000000000000000000000000000000000000000"];try{const t=await c.balances(e,l),s=b(N,this,x).call(this,r),n={};Object.keys(s).forEach(t=>{e.includes(t)||(n[t]={address:t,balance:null})}),e.forEach((e,s)=>{const r=t[s]?t[s].toHexString():"0x0";n[e]={address:e,balance:r}}),this.update(e=>{r===b(N,this,R).call(this)&&(e.accounts=n),e.accountsByChainId[r]=n})}catch(t){n.default.warn("MetaMask - Account Tracker single call balance fetch failed",t),Promise.allSettled(e.map(e=>b(N,this,U).call(this,e,s,r)))}}s.default=j}}},{package:"$root$",file:"app/scripts/controllers/account-tracker-controller.ts"}],[144,{"../../../shared/constants/alerts":5445,"@metamask/base-controller":1203},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,s){Object.defineProperty(s,"__esModule",{value:!0}),s.getDefaultAlertControllerState=s.AlertController=void 0;var r=e("@metamask/base-controller"),n=e("../../../shared/constants/alerts");function i(e,t){if(t.has(e))throw new TypeError("Cannot initialize the same private elements twice on an object")}function a(e,t,s){return e.set(o(e,t),s),s}function o(e,t,s){if("function"==typeof e?e===t:e.has(t))return arguments.length<3?t:s;throw new TypeError("Private element is not present on this object")}const c=()=>({alertEnabledness:n.TOGGLEABLE_ALERT_TYPES.reduce((e,t)=>(e[t]=!0,e),{}),unconnectedAccountAlertShownOrigins:{},web3ShimUsageOrigins:{}});s.getDefaultAlertControllerState=c;const l={alertEnabledness:{includeInStateLogs:!0,persist:!0,anonymous:!0,usedInUi:!0},unconnectedAccountAlertShownOrigins:{includeInStateLogs:!0,persist:!0,anonymous:!1,usedInUi:!0},web3ShimUsageOrigins:{includeInStateLogs:!0,persist:!0,anonymous:!1,usedInUi:!0}};var u=new WeakMap,d=new WeakSet;class p extends r.BaseController{constructor(e){var t,s;super({messenger:e.messenger,metadata:l,name:"AlertController",state:{...c(),...e.state}}),i(t=this,s=d),s.add(t),function(e,t,s){i(e,t),t.set(e,s)}(this,u,void 0),a(u,this,this.messagingSystem.call("AccountsController:getSelectedAccount").address),this.messagingSystem.subscribe("AccountsController:selectedAccountChange",e=>{this.state.unconnectedAccountAlertShownOrigins&&function(e,t){return e.get(o(e,t))}(u,this)!==e.address&&(a(u,this,e.address),this.update(e=>{e.unconnectedAccountAlertShownOrigins={}}))})}setAlertEnabledness(e,t){this.update(s=>{s.alertEnabledness[e]=t})}setUnconnectedAccountAlertShown(e){this.update(t=>{t.unconnectedAccountAlertShownOrigins[e]=!0})}getWeb3ShimUsageState(e){var t;return null===(t=this.state.web3ShimUsageOrigins)||void 0===t?void 0:t[e]}setWeb3ShimUsageRecorded(e){o(d,this,h).call(this,e,n.Web3ShimUsageAlertStates.recorded)}setWeb3ShimUsageAlertDismissed(e){o(d,this,h).call(this,e,n.Web3ShimUsageAlertStates.dismissed)}}function h(e,t){this.update(s=>{s.web3ShimUsageOrigins&&(s.web3ShimUsageOrigins[e]=t)})}s.AlertController=p}}},{package:"$root$",file:"app/scripts/controllers/alert-controller.ts"}],[145,{"@metamask/base-controller":1203},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,s){Object.defineProperty(s,"__esModule",{value:!0}),s.getDefaultAppMetadataControllerState=s.default=void 0;var r=e("@metamask/base-controller");function n(e,t){(function(e,t){if(t.has(e))throw new TypeError("Cannot initialize the same private elements twice on an object")})(e,t),t.add(e)}function i(e,t,s){if("function"==typeof e?e===t:e.has(t))return arguments.length<3?t:s;throw new TypeError("Private element is not present on this object")}const a=()=>({currentAppVersion:"",previousAppVersion:"",previousMigrationVersion:0,currentMigrationVersion:0});s.getDefaultAppMetadataControllerState=a;const o={currentAppVersion:{includeInStateLogs:!0,persist:!0,anonymous:!0,usedInUi:!1},previousAppVersion:{includeInStateLogs:!0,persist:!0,anonymous:!0,usedInUi:!1},previousMigrationVersion:{includeInStateLogs:!0,persist:!0,anonymous:!0,usedInUi:!1},currentMigrationVersion:{includeInStateLogs:!0,persist:!0,anonymous:!0,usedInUi:!1}};var c=new WeakSet;class l extends r.BaseController{constructor({state:e={},messenger:t,currentAppVersion:s="",currentMigrationVersion:r=0}){super({name:"AppMetadataController",metadata:o,state:{currentAppVersion:"",previousAppVersion:"",previousMigrationVersion:0,currentMigrationVersion:0,...e},messenger:t}),n(this,c),i(c,this,u).call(this,s),i(c,this,d).call(this,r)}}function u(e){const t=this.state.currentAppVersion;e!==t&&this.update(s=>{s.currentAppVersion=e,s.previousAppVersion=t})}function d(e){const t=this.state.currentMigrationVersion;e!==t&&this.update(s=>{s.previousMigrationVersion=t,s.currentMigrationVersion=e})}s.default=l}}},{package:"$root$",file:"app/scripts/controllers/app-metadata.ts"}],[146,{"../../../shared/constants/alarms":5444,"../../../shared/constants/app":5447,"../../../shared/constants/preferences":5470,"../../../shared/constants/time":5480,"../../../shared/modules/mv3.utils":5567,"../../../ui/helpers/utils/build-types":6698,"@metamask/base-controller":1203,"@metamask/controller-utils":1321,"@metamask/utils":2835,loglevel:4573,uuid:5398},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,s){Object.defineProperty(s,"__esModule",{value:!0}),s.AppStateController=void 0;var r,n=e("uuid"),i=(r=e("loglevel"))&&r.__esModule?r:{default:r},a=e("@metamask/controller-utils"),o=e("@metamask/base-controller"),c=e("@metamask/utils"),l=e("../../../shared/constants/time"),u=e("../../../shared/constants/alarms"),d=e("../../../shared/modules/mv3.utils"),p=e("../../../ui/helpers/utils/build-types"),h=e("../../../shared/constants/app"),m=e("../../../shared/constants/preferences");function g(e,t,s){return(t=function(e){var t=function(e,t){if("object"!=typeof e||!e)return e;var s=e[Symbol.toPrimitive];if(void 0!==s){var r=s.call(e,t||"default");if("object"!=typeof r)return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==typeof t?t:t+""}(t))in e?Object.defineProperty(e,t,{value:s,enumerable:!0,configurable:!0,writable:!0}):e[t]=s,e}function f(e,t,s){y(e,t),t.set(e,s)}function y(e,t){if(t.has(e))throw new TypeError("Cannot initialize the same private elements twice on an object")}function w(e,t){return e.get(b(e,t))}function v(e,t,s){return e.set(b(e,t),s),s}function b(e,t,s){if("function"==typeof e?e===t:e.has(t))return arguments.length<3?t:s;throw new TypeError("Private element is not present on this object")}const S={activeQrCodeScanRequest:{includeInStateLogs:!1,persist:!1,anonymous:!0,usedInUi:!0},addressSecurityAlertResponses:{includeInStateLogs:!0,persist:!1,anonymous:!0,usedInUi:!0},browserEnvironment:{includeInStateLogs:!0,persist:!0,anonymous:!0,usedInUi:!0},connectedStatusPopoverHasBeenShown:{includeInStateLogs:!0,persist:!0,anonymous:!0,usedInUi:!0},currentExtensionPopupId:{includeInStateLogs:!0,persist:!1,anonymous:!0,usedInUi:!0},currentPopupId:{includeInStateLogs:!0,persist:!1,anonymous:!0,usedInUi:!0},defaultHomeActiveTabName:{includeInStateLogs:!0,persist:!0,anonymous:!0,usedInUi:!0},enableEnforcedSimulations:{includeInStateLogs:!0,persist:!0,anonymous:!0,usedInUi:!0},enableEnforcedSimulationsForTransactions:{includeInStateLogs:!0,persist:!1,anonymous:!0,usedInUi:!0},enforcedSimulationsSlippage:{includeInStateLogs:!0,persist:!0,anonymous:!0,usedInUi:!0},enforcedSimulationsSlippageForTransactions:{includeInStateLogs:!0,persist:!1,anonymous:!0,usedInUi:!0},fullScreenGasPollTokens:{includeInStateLogs:!0,persist:!1,anonymous:!0,usedInUi:!0},hadAdvancedGasFeesSetPriorToMigration92_3:{includeInStateLogs:!0,persist:!0,anonymous:!0,usedInUi:!1},isRampCardClosed:{includeInStateLogs:!0,persist:!0,anonymous:!0,usedInUi:!0},isUpdateAvailable:{includeInStateLogs:!0,persist:!1,anonymous:!0,usedInUi:!0},lastInteractedConfirmationInfo:{includeInStateLogs:!0,persist:!0,anonymous:!0,usedInUi:!0},lastUpdatedAt:{includeInStateLogs:!0,persist:!0,anonymous:!0,usedInUi:!0},lastViewedUserSurvey:{includeInStateLogs:!0,persist:!0,anonymous:!0,usedInUi:!0},newPrivacyPolicyToastClickedOrClosed:{includeInStateLogs:!0,persist:!0,anonymous:!0,usedInUi:!0},newPrivacyPolicyToastShownDate:{includeInStateLogs:!0,persist:!0,anonymous:!0,usedInUi:!0},nftsDetectionNoticeDismissed:{includeInStateLogs:!0,persist:!0,anonymous:!0,usedInUi:!1},nftsDropdownState:{includeInStateLogs:!0,persist:!1,anonymous:!0,usedInUi:!0},notificationGasPollTokens:{includeInStateLogs:!0,persist:!1,anonymous:!0,usedInUi:!0},onboardingDate:{includeInStateLogs:!0,persist:!0,anonymous:!0,usedInUi:!0},outdatedBrowserWarningLastShown:{includeInStateLogs:!0,persist:!0,anonymous:!0,usedInUi:!0},popupGasPollTokens:{includeInStateLogs:!0,persist:!1,anonymous:!0,usedInUi:!0},productTour:{includeInStateLogs:!0,persist:!0,anonymous:!0,usedInUi:!0},recoveryPhraseReminderHasBeenShown:{includeInStateLogs:!0,persist:!0,anonymous:!0,usedInUi:!0},recoveryPhraseReminderLastShown:{includeInStateLogs:!0,persist:!0,anonymous:!0,usedInUi:!0},showAccountBanner:{includeInStateLogs:!0,persist:!0,anonymous:!0,usedInUi:!0},showBetaHeader:{includeInStateLogs:!0,persist:!0,anonymous:!0,usedInUi:!0},showDownloadMobileAppSlide:{includeInStateLogs:!0,persist:!0,anonymous:!0,usedInUi:!0},showNetworkBanner:{includeInStateLogs:!0,persist:!0,anonymous:!0,usedInUi:!0},showPermissionsTour:{includeInStateLogs:!0,persist:!0,anonymous:!0,usedInUi:!0},showTestnetMessageInDropdown:{includeInStateLogs:!0,persist:!0,anonymous:!0,usedInUi:!1},signatureSecurityAlertResponses:{includeInStateLogs:!0,persist:!1,anonymous:!0,usedInUi:!0},slides:{includeInStateLogs:!0,persist:!0,anonymous:!0,usedInUi:!0},snapsInstallPrivacyWarningShown:{includeInStateLogs:!0,persist:!0,anonymous:!0,usedInUi:!0},surveyLinkLastClickedOrClosed:{includeInStateLogs:!0,persist:!0,anonymous:!0,usedInUi:!0},termsOfUseLastAgreed:{includeInStateLogs:!0,persist:!0,anonymous:!0,usedInUi:!0},throttledOrigins:{includeInStateLogs:!0,persist:!1,anonymous:!0,usedInUi:!0},timeoutMinutes:{includeInStateLogs:!0,persist:!0,anonymous:!0,usedInUi:!1},trezorModel:{includeInStateLogs:!0,persist:!0,anonymous:!0,usedInUi:!1},updateModalLastDismissedAt:{includeInStateLogs:!0,persist:!0,anonymous:!0,usedInUi:!0}};var E=new WeakMap,k=new WeakMap,T=new WeakMap,M=new WeakMap,C=new WeakMap,I=new WeakSet;class A extends o.BaseController{constructor({state:e={},messenger:t,onInactiveTimeout:s,extension:r}){super({name:"AppStateController",metadata:S,state:{activeQrCodeScanRequest:null,browserEnvironment:{},connectedStatusPopoverHasBeenShown:!0,defaultHomeActiveTabName:null,enableEnforcedSimulations:!0,enableEnforcedSimulationsForTransactions:{},enforcedSimulationsSlippage:10,enforcedSimulationsSlippageForTransactions:{},fullScreenGasPollTokens:[],hadAdvancedGasFeesSetPriorToMigration92_3:!1,isRampCardClosed:!1,isUpdateAvailable:!1,lastUpdatedAt:null,lastViewedUserSurvey:null,newPrivacyPolicyToastClickedOrClosed:null,newPrivacyPolicyToastShownDate:null,nftsDetectionNoticeDismissed:!1,notificationGasPollTokens:[],onboardingDate:null,outdatedBrowserWarningLastShown:null,popupGasPollTokens:[],productTour:"accountIcon",recoveryPhraseReminderHasBeenShown:!1,recoveryPhraseReminderLastShown:(new Date).getTime(),showAccountBanner:!0,showBetaHeader:(0,p.isBeta)(),showDownloadMobileAppSlide:!0,showNetworkBanner:!0,showPermissionsTour:!0,showTestnetMessageInDropdown:!0,slides:[],surveyLinkLastClickedOrClosed:null,throttledOrigins:{},timeoutMinutes:m.DEFAULT_AUTO_LOCK_TIME_LIMIT,trezorModel:null,updateModalLastDismissedAt:null,addressSecurityAlertResponses:{},currentExtensionPopupId:0,nftsDropdownState:{},signatureSecurityAlertResponses:{},...e,addressSecurityAlertResponses:{},currentExtensionPopupId:0,nftsDropdownState:{},signatureSecurityAlertResponses:{}},messenger:t}),function(e,t){y(e,t),t.add(e)}(this,I),f(this,E,void 0),f(this,k,void 0),f(this,T,void 0),g(this,"waitingForUnlock",void 0),f(this,M,void 0),f(this,C,null),g(this,"getAddressSecurityAlertResponse",e=>this.state.addressSecurityAlertResponses[e.toLowerCase()]),g(this,"addAddressSecurityAlertResponse",(e,t)=>{this.update(s=>{s.addressSecurityAlertResponses[e.toLowerCase()]=t})}),v(E,this,r),v(k,this,s||(()=>undefined)),v(T,this,null),this.waitingForUnlock=[],t.subscribe("KeyringController:unlock",b(I,this,P).bind(this)),t.subscribe("PreferencesController:stateChange",({preferences:e})=>{const t=this.state;"number"==typeof(null==e?void 0:e.autoLockTimeLimit)&&t.timeoutMinutes!==e.autoLockTimeLimit&&b(I,this,N).call(this,e.autoLockTimeLimit)});const{preferences:n}=t.call("PreferencesController:getState");"number"==typeof n.autoLockTimeLimit&&b(I,this,N).call(this,n.autoLockTimeLimit),this.messagingSystem.registerActionHandler("AppStateController:getUnlockPromise",this.getUnlockPromise.bind(this)),this.messagingSystem.registerActionHandler("AppStateController:requestQrCodeScan",b(I,this,B).bind(this)),v(M,this,null)}getUnlockPromise(e){return new Promise(t=>{const{isUnlocked:s}=this.messagingSystem.call("KeyringController:getState");s?t():b(I,this,_).call(this,t,e)})}setDefaultHomeActiveTabName(e){this.update(t=>{t.defaultHomeActiveTabName=e})}setConnectedStatusPopoverHasBeenShown(){this.update(e=>{e.connectedStatusPopoverHasBeenShown=!0})}setRecoveryPhraseReminderHasBeenShown(){this.update(e=>{e.recoveryPhraseReminderHasBeenShown=!0})}setSurveyLinkLastClickedOrClosed(e){this.update(t=>{t.surveyLinkLastClickedOrClosed=e})}setOnboardingDate(){this.update(e=>{e.onboardingDate=Date.now()})}setLastViewedUserSurvey(e){this.update(t=>{t.lastViewedUserSurvey=e})}setRampCardClosed(){this.update(e=>{e.isRampCardClosed=!0})}setNewPrivacyPolicyToastClickedOrClosed(){this.update(e=>{e.newPrivacyPolicyToastClickedOrClosed=!0})}setNewPrivacyPolicyToastShownDate(e){this.update(t=>{t.newPrivacyPolicyToastShownDate=e})}updateSlides(e){this.update(t=>{const s=t.slides||[],r=e.map(e=>{const t=s.find(t=>t.id===e.id);return t?{...t,...e}:e});t.slides=[...r]})}removeSlide(e){this.update(t=>{const s=t.slides||[];t.slides=s.map(t=>t.id===e?{...t,dismissed:!0}:t),e===h.DOWNLOAD_MOBILE_APP_SLIDE_ID&&(t.showDownloadMobileAppSlide=!1)})}setRecoveryPhraseReminderLastShown(e){this.update(t=>{t.recoveryPhraseReminderLastShown=e})}setTermsOfUseLastAgreed(e){this.update(t=>{t.termsOfUseLastAgreed=e})}setSnapsInstallPrivacyWarningShownStatus(e){this.update(t=>{t.snapsInstallPrivacyWarningShown=e})}setOutdatedBrowserWarningLastShown(e){this.update(t=>{t.outdatedBrowserWarningLastShown=e})}setLastActiveTime(){b(I,this,O).call(this)}setIsUpdateAvailable(e){this.update(t=>{t.isUpdateAvailable=e})}setUpdateModalLastDismissedAt(e){this.update(t=>{t.updateModalLastDismissedAt=e})}setLastUpdatedAt(e){this.update(t=>{t.lastUpdatedAt=e})}setBrowserEnvironment(e,t){this.update(s=>{s.browserEnvironment={os:e,browser:t}})}addPollingToken(e,t){t.toString()!==h.POLLING_TOKEN_ENVIRONMENT_TYPES[h.ENVIRONMENT_TYPE_BACKGROUND]&&b(I,this,R).call(this,t)&&b(I,this,j).call(this,e,t)}removePollingToken(e,t){if(t.toString()!==h.POLLING_TOKEN_ENVIRONMENT_TYPES[h.ENVIRONMENT_TYPE_BACKGROUND]){const s=this.state[t];b(I,this,R).call(this,t)&&this.update(r=>{r[t]=s.filter(t=>t!==e)})}}clearPollingTokens(){this.update(e=>{e.popupGasPollTokens=[],e.notificationGasPollTokens=[],e.fullScreenGasPollTokens=[]})}setShowTestnetMessageInDropdown(e){this.update(t=>{t.showTestnetMessageInDropdown=e})}setShowBetaHeader(e){this.update(t=>{t.showBetaHeader=e})}setShowPermissionsTour(e){this.update(t=>{t.showPermissionsTour=e})}setProductTour(e){this.update(t=>{t.productTour=e})}setShowNetworkBanner(e){this.update(t=>{t.showNetworkBanner=e})}setShowAccountBanner(e){this.update(t=>{t.showAccountBanner=e})}setCurrentExtensionPopupId(e){this.update(t=>{t.currentExtensionPopupId=e})}setTrezorModel(e){this.update(t=>{t.trezorModel=e})}updateNftDropDownState(e){this.update(t=>{t.nftsDropdownState=e})}getSignatureSecurityAlertResponse(e){return this.state.signatureSecurityAlertResponses[e]}addSignatureSecurityAlertResponse(e){e.securityAlertId&&this.update(t=>{t.signatureSecurityAlertResponses[String(e.securityAlertId)]=e})}setCurrentPopupId(e){this.update(t=>{t.currentPopupId=e})}getLastInteractedConfirmationInfo(){return this.state.lastInteractedConfirmationInfo}setLastInteractedConfirmationInfo(e){this.update(t=>{t.lastInteractedConfirmationInfo=e})}getCurrentPopupId(){return this.state.currentPopupId}getThrottledOriginState(e){return this.state.throttledOrigins[e]}updateThrottledOriginState(e,t){this.update(s=>{s.throttledOrigins[e]=t})}completeQrCodeScan(e){if(!w(C,this))throw new Error("No QR code scan is in progress.");this.update(e=>{e.activeQrCodeScanRequest=null}),w(C,this).resolve(e),v(C,this,null)}cancelQrCodeScan(e){if(!w(C,this))throw new Error("No QR code scan is in progress.");this.update(e=>{e.activeQrCodeScanRequest=null}),w(C,this).reject(e||new Error("Scan cancelled")),v(C,this,null)}setEnableEnforcedSimulations(e){this.update(t=>{t.enableEnforcedSimulations=e})}setEnableEnforcedSimulationsForTransaction(e,t){this.update(s=>{s.enableEnforcedSimulationsForTransactions[e]=t})}setEnforcedSimulationsSlippage(e){this.update(t=>{t.enforcedSimulationsSlippage=e})}setEnforcedSimulationsSlippageForTransaction(e,t){this.update(s=>{s.enforcedSimulationsSlippageForTransactions[e]=t})}}function _(e,t){this.waitingForUnlock.push({resolve:e}),this.messagingSystem.publish("AppStateController:unlockChange"),t&&b(I,this,D).call(this)}function P(){if(this.waitingForUnlock.length>0){for(;this.waitingForUnlock.length>0;){var e;null===(e=this.waitingForUnlock.shift())||void 0===e||e.resolve()}this.messagingSystem.publish("AppStateController:unlockChange")}b(I,this,L).call(this)}function N(e){this.update(t=>{t.timeoutMinutes=e}),b(I,this,O).call(this)}function O(){const{timeoutMinutes:e}=this.state;if(w(T,this)?clearTimeout(w(T,this)):d.isManifestV3&&w(E,this).alarms.clear(u.AUTO_LOCK_TIMEOUT_ALARM),!e)return;const t=Number(e);d.isManifestV3?(w(E,this).alarms.create(u.AUTO_LOCK_TIMEOUT_ALARM,{delayInMinutes:t,periodInMinutes:t}),w(E,this).alarms.onAlarm.addListener(e=>{e.name===u.AUTO_LOCK_TIMEOUT_ALARM&&(w(k,this).call(this),w(E,this).alarms.clear(u.AUTO_LOCK_TIMEOUT_ALARM))})):v(T,this,setTimeout(()=>w(k,this).call(this),t*l.MINUTE))}function j(e,t){this.update(s=>{s[t].push(e)})}function R(e){return["popupGasPollTokens","notificationGasPollTokens","fullScreenGasPollTokens"].includes(e)}function D(){w(M,this)||(v(M,this,(0,n.v4)()),this.messagingSystem.call("ApprovalController:addRequest",{id:w(M,this),origin:h.ORIGIN_METAMASK,type:a.ApprovalType.Unlock},!0).catch(()=>{v(M,this,null)}))}function L(){if(w(M,this)){try{this.messagingSystem.call("ApprovalController:acceptRequest",w(M,this))}catch(e){i.default.error("Failed to unlock approval request",e)}v(M,this,null)}}function B(e){if(w(C,this))return w(C,this).promise;const t=(0,c.createDeferredPromise)();return v(C,this,t),this.update(t=>{t.activeQrCodeScanRequest=e}),t.promise}s.AppStateController=A}}},{package:"$root$",file:"app/scripts/controllers/app-state-controller.ts"}],[147,{"../../../shared/constants/metametrics":5462,"../../../shared/modules/hexstring-utils":5564,"@metamask/base-controller":1203,"@metamask/controller-utils":1321,"@metamask/message-manager":2070,"@metamask/utils":2835,buffer:3793,loglevel:4573},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,s){(function(t){(function(){Object.defineProperty(s,"__esModule",{value:!0}),s.managerName=s.isEIP1024EncryptedMessage=s.getDefaultState=s.default=void 0;var r,n=(r=e("loglevel"))&&r.__esModule?r:{default:r},i=e("@metamask/message-manager"),a=e("@metamask/base-controller"),o=e("@metamask/controller-utils"),c=e("@metamask/utils"),l=e("../../../shared/constants/metametrics"),u=e("../../../shared/modules/hexstring-utils");function d(e,t,s){return(t=function(e){var t=function(e,t){if("object"!=typeof e||!e)return e;var s=e[Symbol.toPrimitive];if(void 0!==s){var r=s.call(e,t||"default");if("object"!=typeof r)return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==typeof t?t:t+""}(t))in e?Object.defineProperty(e,t,{value:s,enumerable:!0,configurable:!0,writable:!0}):e[t]=s,e}const p={unapprovedDecryptMsgs:{includeInStateLogs:!0,persist:!1,anonymous:!1,usedInUi:!0},unapprovedDecryptMsgCount:{includeInStateLogs:!0,persist:!1,anonymous:!1,usedInUi:!0}},h=s.managerName="DecryptMessageManager",m=e=>!!((0,c.isObject)(e.data)&&(0,c.hasProperty)(e.data,"version")&&(0,c.hasProperty)(e.data,"nonce")&&(0,c.hasProperty)(e.data,"ephemPublicKey")&&(0,c.hasProperty)(e.data,"ciphertext"));s.isEIP1024EncryptedMessage=m;const g=()=>({unapprovedDecryptMsgs:{},unapprovedDecryptMsgCount:0});s.getDefaultState=g;class f extends a.BaseController{constructor({getState:e,metricsEvent:t,messenger:s,managerMessenger:r}){super({metadata:p,messenger:s,name:"DecryptMessageController",state:{unapprovedDecryptMsgs:{},unapprovedDecryptMsgCount:0}}),d(this,"_getState",void 0),d(this,"_metricsEvent",void 0),d(this,"_decryptMessageManager",void 0),this._getState=e,this._metricsEvent=t,this._decryptMessageManager=new i.DecryptMessageManager({additionalFinishStatuses:["decrypted"],messenger:r}),s.subscribe(`${h}:unapprovedMessage`,this._requestApproval.bind(this)),this._subscribeToMessageState(s,(e,t,s)=>{e.unapprovedDecryptMsgs=t,e.unapprovedDecryptMsgCount=s})}get unapprovedDecryptMsgCount(){return this._decryptMessageManager.getUnapprovedMessagesCount()}resetState(){this.update(()=>({unapprovedDecryptMsgs:{},unapprovedDecryptMsgCount:0}))}clearUnapproved(){this._decryptMessageManager.clearUnapprovedMessages()}async newRequestDecryptMessage(e,t){return this._decryptMessageManager.addUnapprovedMessageAsync(e,t)}async decryptMessage(e){const t=e.metamaskId;try{const s=await this._decryptMessageManager.approveMessage(e);if(s.data=this._parseMessageData(s.data),!m(s))throw new Error("Invalid encrypted data.");const r=await this.messagingSystem.call("KeyringController:decryptMessage",s);this._decryptMessageManager.setMessageStatusAndResult(t,r,"decrypted"),this._acceptApproval(t)}catch(e){throw n.default.info("MetaMaskController - eth_decrypt failed.",e),this._cancelAbstractMessage(this._decryptMessageManager,t),e}return this._getState()}async decryptMessageInline(e){const t=e.metamaskId;if(e.data=this._parseMessageData(e.data),!m(e))throw new Error("Invalid encrypted data.");const s=await this.messagingSystem.call("KeyringController:decryptMessage",e);return this._decryptMessageManager.setResult(t,s),this._getState()}cancelDecryptMessage(e){return this._decryptMessageManager.rejectMessage(e),this._rejectApproval(e),this._getState()}rejectUnapproved(e){Object.keys(this._decryptMessageManager.getUnapprovedMessages()).forEach(t=>{this._cancelAbstractMessage(this._decryptMessageManager,t,e)})}_acceptApproval(e){this.messagingSystem.call("ApprovalController:acceptRequest",e)}_cancelAbstractMessage(e,t,s){return s&&this._metricsEvent({event:s,category:l.MetaMetricsEventCategory.Messages,properties:{action:"Decrypt Message Request"}}),e.rejectMessage(t),this._rejectApproval(t),this._getState()}_subscribeToMessageState(e,t){e.subscribe(`${h}:stateChange`,e=>{const s=this._migrateMessages(e.unapprovedMessages);this.update(r=>{t(r,s,e.unapprovedMessagesCount)})})}_migrateMessages(e){const t={};for(const s of Object.keys(e)){const r=e[s],n=this._migrateMessage(r);t[s]=n}return t}_migrateMessage(e){const{messageParams:t,...s}=e;return{...s,rawSig:e.rawSig,msgParams:t,origin:t.origin}}_requestApproval(e){const t=e.metamaskId,s=e.origin||o.ORIGIN_METAMASK;try{this.messagingSystem.call("ApprovalController:addRequest",{id:t,origin:s,type:o.ApprovalType.EthDecrypt},!0)}catch(e){n.default.info("Error adding request to approval controller",e)}}_parseMessageData(e){const s=(0,u.stripHexPrefix)(e),r=t.from(s,"hex");return JSON.parse(r.toString("utf8"))}_rejectApproval(e){try{this.messagingSystem.call("ApprovalController:rejectRequest",e,"Cancel")}catch(e){n.default.info("Error rejecting request to approval controller",e)}}}s.default=f}).call(this)}).call(this,e("buffer").Buffer)}}},{package:"$root$",file:"app/scripts/controllers/decrypt-message.ts"}],[148,{"../../../shared/constants/app":5447,"../../../shared/constants/keyring":5458,"../../../shared/constants/metametrics":5462,"@metamask/base-controller":1203,"@metamask/message-manager":2070,loglevel:4573},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,s){Object.defineProperty(s,"__esModule",{value:!0}),s.default=void 0;var r,n=(r=e("loglevel"))&&r.__esModule?r:{default:r},i=e("@metamask/message-manager"),a=e("@metamask/base-controller"),o=e("../../../shared/constants/metametrics"),c=e("../../../shared/constants/keyring"),l=e("../../../shared/constants/app");function u(e,t,s){return(t=function(e){var t=function(e,t){if("object"!=typeof e||!e)return e;var s=e[Symbol.toPrimitive];if(void 0!==s){var r=s.call(e,t||"default");if("object"!=typeof r)return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==typeof t?t:t+""}(t))in e?Object.defineProperty(e,t,{value:s,enumerable:!0,configurable:!0,writable:!0}):e[t]=s,e}const d="EncryptionPublicKeyManager",p={unapprovedEncryptionPublicKeyMsgs:{includeInStateLogs:!0,persist:!1,anonymous:!1,usedInUi:!0},unapprovedEncryptionPublicKeyMsgCount:{includeInStateLogs:!0,persist:!1,anonymous:!1,usedInUi:!0}};class h extends a.BaseController{constructor({messenger:e,managerMessenger:t,getEncryptionPublicKey:s,getAccountKeyringType:r,getState:n,metricsEvent:a}){super({name:"EncryptionPublicKeyController",metadata:p,messenger:e,state:{unapprovedEncryptionPublicKeyMsgs:{},unapprovedEncryptionPublicKeyMsgCount:0}}),u(this,"_getEncryptionPublicKey",void 0),u(this,"_getAccountKeyringType",void 0),u(this,"_getState",void 0),u(this,"_encryptionPublicKeyManager",void 0),u(this,"_metricsEvent",void 0),this._getEncryptionPublicKey=s,this._getAccountKeyringType=r,this._getState=n,this._metricsEvent=a,this._encryptionPublicKeyManager=new i.EncryptionPublicKeyManager({additionalFinishStatuses:["received"],messenger:t}),this.messagingSystem.subscribe(`${d}:unapprovedMessage`,this._requestApproval.bind(this)),this._subscribeToMessageState(e,(e,t,s)=>{e.unapprovedEncryptionPublicKeyMsgs=t,e.unapprovedEncryptionPublicKeyMsgCount=s})}get unapprovedMsgCount(){return this._encryptionPublicKeyManager.getUnapprovedMessagesCount()}resetState(){this.update(()=>({unapprovedEncryptionPublicKeyMsgs:{},unapprovedEncryptionPublicKeyMsgCount:0}))}async newRequestEncryptionPublicKey(e,t){switch(await this._getAccountKeyringType(e)){case c.KeyringType.ledger:return new Promise((e,t)=>{t(new Error("Ledger does not support eth_getEncryptionPublicKey."))});case c.KeyringType.trezor:return new Promise((e,t)=>{t(new Error("Trezor does not support eth_getEncryptionPublicKey."))});case c.KeyringType.lattice:return new Promise((e,t)=>{t(new Error("Lattice does not support eth_getEncryptionPublicKey."))});case c.KeyringType.qr:return Promise.reject(new Error("QR hardware does not support eth_getEncryptionPublicKey."));default:return this._encryptionPublicKeyManager.addUnapprovedMessageAsync({from:e},t)}}async encryptionPublicKey(e){n.default.info("MetaMaskController - encryptionPublicKey");const t=e.metamaskId;try{const s=await this._encryptionPublicKeyManager.approveMessage(e),r=await this._getEncryptionPublicKey(s.from);return this._encryptionPublicKeyManager.setMessageStatusAndResult(t,r,"received"),this._acceptApproval(t),this._getState()}catch(e){throw n.default.info("MetaMaskController - eth_getEncryptionPublicKey failed.",e),this._cancelAbstractMessage(this._encryptionPublicKeyManager,t),e}}cancelEncryptionPublicKey(e){return this._cancelAbstractMessage(this._encryptionPublicKeyManager,e)}rejectUnapproved(e){Object.keys(this._encryptionPublicKeyManager.getUnapprovedMessages()).forEach(t=>{this._cancelAbstractMessage(this._encryptionPublicKeyManager,t,e)})}clearUnapproved(){this._encryptionPublicKeyManager.clearUnapprovedMessages()}_cancelAbstractMessage(e,t,s){return s&&this._metricsEvent({event:s,category:o.MetaMetricsEventCategory.Messages,properties:{action:"Encryption public key Request"}}),e.rejectMessage(t),this._rejectApproval(t),this._getState()}_subscribeToMessageState(e,t){e.subscribe(`${d}:stateChange`,e=>{const s=this._migrateMessages(e.unapprovedMessages);this.update(r=>{t(r,s,e.unapprovedMessagesCount)})})}_migrateMessages(e){const t={};for(const s of Object.keys(e)){const r=e[s],n=this._migrateMessage(r);t[s]=n}return t}_migrateMessage(e){const{messageParams:t,...s}=e;return{...s,rawSig:e.rawSig,msgParams:t.from,origin:t.origin}}_requestApproval(e){const t=e.metamaskId,s=e.origin||l.ORIGIN_METAMASK;this.messagingSystem.call("ApprovalController:addRequest",{id:t,origin:s,type:"eth_getEncryptionPublicKey"},!0).catch(()=>{})}_acceptApproval(e){this.messagingSystem.call("ApprovalController:acceptRequest",e)}_rejectApproval(e){this.messagingSystem.call("ApprovalController:rejectRequest",e,"Cancel")}}s.default=h}}},{package:"$root$",file:"app/scripts/controllers/encryption-public-key.ts"}],[149,{"../../../../shared/lib/accounts/institutional-wallet-snap":5488,"@metamask/base-controller":1203,"@metamask/controller-utils":1321,"@metamask/snaps-utils":2713,"@metamask/transaction-controller":2790},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,s){Object.defineProperty(s,"__esModule",{value:!0}),s.InstitutionalSnapController=void 0;var r=e("@metamask/transaction-controller"),n=e("@metamask/snaps-utils"),i=e("@metamask/base-controller"),a=e("@metamask/controller-utils");function o(e,t){(function(e,t){if(t.has(e))throw new TypeError("Cannot initialize the same private elements twice on an object")})(e,t),t.add(e)}function c(e,t,s){if("function"==typeof e?e===t:e.has(t))return arguments.length<3?t:s;throw new TypeError("Private element is not present on this object")}const l=e("../../../../shared/lib/accounts/institutional-wallet-snap").INSTITUTIONAL_WALLET_SNAP_ID,u="InstitutionalSnapController",d={};var p=new WeakSet;class h extends i.BaseController{constructor({messenger:e}){super({messenger:e,name:u,state:{},metadata:d}),o(this,p),c(p,this,m).call(this)}async deferPublicationHook(e){if(await c(p,this,w).call(this,e)){const t=await c(p,this,f).call(this,e);return await c(p,this,y).call(this,e.id,t),!1}return!0}async beforeCheckPendingTransactionHook(e){return!await c(p,this,w).call(this,e)}}function m(){this.messagingSystem.registerActionHandler(`${u}:publishHook`,this.deferPublicationHook.bind(this)),this.messagingSystem.registerActionHandler(`${u}:beforeCheckPendingTransactionHook`,this.beforeCheckPendingTransactionHook.bind(this))}async function g(e){return await this.messagingSystem.call("SnapController:handleRequest",e)}async function f(e){const t={from:e.txParams.from,to:e.txParams.to,value:e.txParams.value,data:e.txParams.data,chainId:e.chainId},s={snapId:l,origin:a.ORIGIN_METAMASK,handler:n.HandlerType.OnRpcRequest,request:{method:"transactions.getMutableTransactionParameters",params:t}},i=await c(p,this,g).call(this,s);return{hash:i.transaction.transactionHash,nonce:i.transaction.nonce,gasLimit:i.transaction.gasLimit,maxFeePerGas:i.transaction.maxFeePerGas,maxPriorityFeePerGas:i.transaction.maxPriorityFeePerGas,type:i.transaction.type,status:r.TransactionStatus.submitted}}async function y(e,{status:t,hash:s,nonce:r,gasLimit:n,maxFeePerGas:i,maxPriorityFeePerGas:a,type:o}){return await this.messagingSystem.call("TransactionController:updateCustodialTransaction",{transactionId:e,status:t,hash:s,nonce:r,gasLimit:n,maxFeePerGas:i,maxPriorityFeePerGas:a,type:o})}async function w(e){var t;const s=await this.messagingSystem.call("AccountsController:getAccountByAddress",e.txParams.from);return null==s||null===(t=s.options.custodian)||void 0===t?void 0:t.deferPublication}s.InstitutionalSnapController=h}}},{package:"$root$",file:"app/scripts/controllers/institutional-snap/InstitutionalSnapController.ts"}],[15,{"../../../../shared/constants/network":5465,"../../controllers/network-order":152,"@metamask/keyring-api":2012,"@metamask/utils":2835},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,s){Object.defineProperty(s,"__esModule",{value:!0}),s.validateAndFixNetworkState=s.NetworkOrderControllerInit=void 0;var r=e("@metamask/keyring-api"),n=e("@metamask/utils"),i=e("../../../../shared/constants/network"),a=e("../../controllers/network-order");const o=(e,t)=>{var s,r;const{state:i}=e;if(null==i||null===(s=i.enabledNetworkMap)||void 0===s||!s[n.KnownCaipNamespace.Eip155]){return void(Object.keys(i.enabledNetworkMap||{}).filter(e=>e!==n.KnownCaipNamespace.Eip155).some(e=>Object.keys(i.enabledNetworkMap[e]||{}).length>0)||e.setEnabledNetworks(["0x1"],n.KnownCaipNamespace.Eip155))}const a=Object.keys(null==i||null===(r=i.enabledNetworkMap)||void 0===r?void 0:r[n.KnownCaipNamespace.Eip155]);if(0===a.length){return void(Object.keys(i.enabledNetworkMap).filter(e=>e!==n.KnownCaipNamespace.Eip155).some(e=>Object.keys(i.enabledNetworkMap[e]).length>0)||e.setEnabledNetworks(["0x1"],n.KnownCaipNamespace.Eip155))}if(a.length>1){a.length===t.length&&t.every(e=>a.includes(e))||e.setEnabledNetworks(t,n.KnownCaipNamespace.Eip155)}};s.validateAndFixNetworkState=o;s.NetworkOrderControllerInit=({controllerMessenger:e,persistedState:t,getController:s})=>{const c=new a.NetworkOrderController({messenger:e,state:{orderedNetworkList:[],enabledNetworkMap:{[n.KnownCaipNamespace.Eip155]:{[i.CHAIN_IDS.MAINNET]:!0},[n.KnownCaipNamespace.Solana]:{[r.SolScope.Mainnet]:!0,[r.SolScope.Devnet]:!0}},...t.NetworkOrderController}});return setTimeout(()=>{const e=s("NetworkController").state.networkConfigurationsByChainId,t=i.FEATURED_NETWORK_CHAIN_IDS.filter(t=>t in e);o(c,t)},0),{controller:c}}}}},{package:"$root$",file:"app/scripts/controller-init/assets/network-order-controller-init.ts"}],[150,{"../../../development/build/constants":500,"../../../shared/constants/alarms":5444,"../../../shared/constants/app":5447,"../../../shared/constants/keyring":5458,"../../../shared/constants/metametrics":5462,"../../../shared/constants/time":5480,"../../../shared/constants/transaction":5482,"../../../shared/lib/trace":5546,"../../../shared/modules/mv3.utils":5567,"../lib/util":276,"@metamask/base-controller":1203,"@metamask/name-controller":2199,"@metamask/utils":2835,buffer:3793,"ethereumjs-util":4052,lodash:4565,uuid:5398},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,s){(function(t){(function(){Object.defineProperty(s,"__esModule",{value:!0}),s.overrideAnonymousEventNames=s.getDefaultMetaMetricsControllerState=s.default=void 0;var r=e("lodash"),n=e("ethereumjs-util"),i=e("uuid"),a=e("@metamask/name-controller"),o=e("@metamask/utils"),c=e("@metamask/base-controller"),l=e("../../../shared/constants/app"),u=e("../../../shared/constants/metametrics"),d=e("../../../shared/constants/time"),p=e("../../../shared/modules/mv3.utils"),h=e("../../../shared/constants/alarms"),m=e("../lib/util"),g=e("../../../shared/constants/transaction"),f=e("../../../shared/lib/trace"),y=e("../../../development/build/constants"),w=e("../../../shared/constants/keyring");function v(e,t,s){return(t=function(e){var t=function(e,t){if("object"!=typeof e||!e)return e;var s=e[Symbol.toPrimitive];if(void 0!==s){var r=s.call(e,t||"default");if("object"!=typeof r)return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==typeof t?t:t+""}(t))in e?Object.defineProperty(e,t,{value:s,enumerable:!0,configurable:!0,writable:!0}):e[t]=s,e}function b(e,t,s){S(e,t),t.set(e,s)}function S(e,t){if(t.has(e))throw new TypeError("Cannot initialize the same private elements twice on an object")}function E(e,t){return e.get(T(e,t))}function k(e,t,s){return e.set(T(e,t),s),s}function T(e,t,s){if("function"==typeof e?e===t:e.has(t))return arguments.length<3?t:s;throw new TypeError("Private element is not present on this object")}const M=s.overrideAnonymousEventNames={[g.TransactionMetaMetricsEvent.added]:g.AnonymousTransactionMetaMetricsEvent.added,[g.TransactionMetaMetricsEvent.approved]:g.AnonymousTransactionMetaMetricsEvent.approved,[g.TransactionMetaMetricsEvent.finalized]:g.AnonymousTransactionMetaMetricsEvent.finalized,[g.TransactionMetaMetricsEvent.rejected]:g.AnonymousTransactionMetaMetricsEvent.rejected,[g.TransactionMetaMetricsEvent.submitted]:g.AnonymousTransactionMetaMetricsEvent.submitted,[u.MetaMetricsEventName.SignatureRequested]:u.MetaMetricsEventName.SignatureRequestedAnon,[u.MetaMetricsEventName.SignatureApproved]:u.MetaMetricsEventName.SignatureApprovedAnon,[u.MetaMetricsEventName.SignatureRejected]:u.MetaMetricsEventName.SignatureRejectedAnon},C=e=>{setTimeout(()=>{throw e})},I=e=>{const t=[];return e.uniqueIdentifier&&t.push(e.uniqueIdentifier),e.actionId&&t.push(e.actionId),t.length&&e.isDuplicateAnonymizedEvent&&t.push("0x000"),t.length?t.join("-"):(0,m.generateRandomId)()},A={'You must pass either an "anonymousId" or a "userId".':!0},_={metaMetricsId:{includeInStateLogs:!0,persist:!0,anonymous:!0,usedInUi:!0},participateInMetaMetrics:{includeInStateLogs:!0,persist:!0,anonymous:!0,usedInUi:!0},latestNonAnonymousEventTimestamp:{includeInStateLogs:!0,persist:!0,anonymous:!0,usedInUi:!0},fragments:{includeInStateLogs:!0,persist:!0,anonymous:!1,usedInUi:!0},eventsBeforeMetricsOptIn:{includeInStateLogs:!0,persist:!0,anonymous:!1,usedInUi:!1},tracesBeforeMetricsOptIn:{includeInStateLogs:!0,persist:!0,anonymous:!1,usedInUi:!1},traits:{includeInStateLogs:!0,persist:!0,anonymous:!1,usedInUi:!1},dataCollectionForMarketing:{includeInStateLogs:!0,persist:!0,anonymous:!1,usedInUi:!0},marketingCampaignCookieId:{includeInStateLogs:!0,persist:!0,anonymous:!0,usedInUi:!1},segmentApiCalls:{includeInStateLogs:!0,persist:!0,anonymous:!1,usedInUi:!1},isSocialLoginFlowEnabledForMetrics:{includeInStateLogs:!0,persist:!0,anonymous:!0,usedInUi:!0}},P=()=>({participateInMetaMetrics:null,metaMetricsId:null,dataCollectionForMarketing:null,marketingCampaignCookieId:null,latestNonAnonymousEventTimestamp:0,eventsBeforeMetricsOptIn:[],tracesBeforeMetricsOptIn:[],traits:{},fragments:{},segmentApiCalls:{},isSocialLoginFlowEnabledForMetrics:!1});s.getDefaultMetaMetricsControllerState=P;var N=new WeakMap,O=new WeakMap,j=new WeakMap,R=new WeakMap,D=new WeakSet,L=new WeakMap;class B extends c.BaseController{constructor({state:e={},messenger:t,segment:s,version:n,environment:i,extension:a,captureException:c=C}){var l,u;super({name:"MetaMetricsController",metadata:_,state:{participateInMetaMetrics:null,metaMetricsId:null,dataCollectionForMarketing:null,marketingCampaignCookieId:null,latestNonAnonymousEventTimestamp:0,eventsBeforeMetricsOptIn:[],tracesBeforeMetricsOptIn:[],traits:{},fragments:{},segmentApiCalls:{},isSocialLoginFlowEnabledForMetrics:!1,...e},messenger:t}),S(l=this,u=D),u.add(l),b(this,N,void 0),v(this,"chainId",void 0),v(this,"locale",void 0),v(this,"previousUserTraits",void 0),v(this,"version",void 0),b(this,O,void 0),b(this,j,void 0),b(this,R,void 0),b(this,L,(0,r.memoize)((e={})=>Object.values(e).reduce((e,t)=>e.concat(...Object.values(t)),[]))),k(N,this,e=>{const t=(0,o.getErrorMessage)(e);A[t]||c(e)}),this.chainId=T(D,this,x).call(this);const g=this.messagingSystem.call("PreferencesController:getState");this.locale=g.currentLocale.replace("_","-"),this.version="production"===i?n:`${n}-${i}`,k(O,this,a),k(j,this,i),this.messagingSystem.registerActionHandler("MetaMetricsController:trackEvent",this.trackEvent.bind(this)),this.messagingSystem.registerActionHandler("MetaMetricsController:getMetaMetricsId",this.getMetaMetricsId.bind(this)),this.messagingSystem.registerActionHandler("MetaMetricsController:createEventFragment",this.createEventFragment.bind(this)),this.messagingSystem.registerActionHandler("MetaMetricsController:getEventFragmentById",this.getEventFragmentById.bind(this)),this.messagingSystem.registerActionHandler("MetaMetricsController:updateEventFragment",this.updateEventFragment.bind(this)),this.messagingSystem.registerActionHandler("MetaMetricsController:deleteEventFragment",this.deleteEventFragment.bind(this)),this.messagingSystem.registerActionHandler("MetaMetricsController:finalizeEventFragment",this.finalizeEventFragment.bind(this));const f=(0,r.omitBy)(e.fragments,"persist");this.messagingSystem.subscribe("PreferencesController:stateChange",({currentLocale:e})=>{this.locale=null==e?void 0:e.replace("_","-")}),this.messagingSystem.subscribe("NetworkController:networkDidChange",({selectedNetworkClientId:e})=>{this.chainId=T(D,this,x).call(this,e)}),k(R,this,s),Object.values(f).forEach(e=>{this.processAbandonedFragment(e)}),p.isManifestV3&&Object.values(e.segmentApiCalls||{}).forEach(({eventType:e,payload:t})=>{try{T(D,this,X).call(this,e,t)}catch(e){E(N,this).call(this,e)}}),p.isManifestV3?(E(O,this).alarms.getAll().then(e=>{(0,m.checkAlarmExists)(e,h.METAMETRICS_FINALIZE_EVENT_FRAGMENT_ALARM)||E(O,this).alarms.create(h.METAMETRICS_FINALIZE_EVENT_FRAGMENT_ALARM,{delayInMinutes:1,periodInMinutes:1})}),E(O,this).alarms.onAlarm.addListener(e=>{e.name===h.METAMETRICS_FINALIZE_EVENT_FRAGMENT_ALARM&&this.finalizeAbandonedFragments()})):setInterval(()=>{this.finalizeAbandonedFragments()},30*d.SECOND)}setIsSocialLoginFlowEnabledForMetrics(e){this.update(t=>{t.isSocialLoginFlowEnabledForMetrics=e})}finalizeAbandonedFragments(){Object.values(this.state.fragments).forEach(e=>{e.timeout&&e.lastUpdated&&Date.now()-e.lastUpdated/1e3>e.timeout&&this.processAbandonedFragment(e)})}generateMetaMetricsId(){return(0,n.bufferToHex)((0,n.keccak)(t.from(String(Date.now())+String(Math.round(Math.random()*Number.MAX_SAFE_INTEGER)))))}createEventFragment(e){if(!e.successEvent)throw new Error(`Must specify success event. Success event was: ${e.event}. Payload keys were: ${Object.keys(e)}. ${"object"==typeof e.properties?`Payload property keys were: ${Object.keys(e.properties)}`:""}`);const{fragments:t}=this.state,s=e.uniqueIdentifier??(0,i.v4)(),n={id:s,...e,lastUpdated:Date.now()},a=e.initialEvent===g.TransactionMetaMetricsEvent.submitted&&t[s]?{...t[s],canDeleteIfAbandoned:!1}:{};return this.update(e=>{e.fragments[s]=(0,r.merge)({},a,n)}),n.initialEvent&&this.trackEvent({event:n.initialEvent,category:n.category,properties:n.properties,sensitiveProperties:n.sensitiveProperties,page:n.page,referrer:n.referrer,revenue:n.revenue,value:n.value,currency:n.currency,environmentType:n.environmentType,actionId:e.actionId,uniqueIdentifier:e.uniqueIdentifier}),n}getEventFragmentById(e){return this.state.fragments[e]}processAbandonedFragment(e){e.canDeleteIfAbandoned?this.deleteEventFragment(e.id):this.finalizeEventFragment(e.id,{abandoned:!0})}updateEventFragment(e,t){const{fragments:s}=this.state,n=s[e];if(!n&&e.includes("transaction-submitted-"))this.update(s=>{s.fragments[e]={canDeleteIfAbandoned:!0,category:u.MetaMetricsEventCategory.Transactions,successEvent:g.TransactionMetaMetricsEvent.finalized,id:e,...t,lastUpdated:Date.now()}});else{if(!n)throw new Error(`Event fragment with id ${e} does not exist.`);this.update(s=>{s.fragments[e]=(0,r.merge)(s.fragments[e],{...t,lastUpdated:Date.now()})})}}deleteEventFragment(e){this.state.fragments[e]&&this.update(t=>{delete t.fragments[e]})}finalizeEventFragment(e,{abandoned:t=!1,page:s,referrer:r}={}){const n=this.state.fragments[e];if(!n)throw new Error(`Funnel with id ${e} does not exist.`);const i=t?n.failureEvent:n.successEvent;this.trackEvent({event:i??"",category:n.category,properties:n.properties,sensitiveProperties:n.sensitiveProperties,page:s??n.page,referrer:n.referrer??r,revenue:n.revenue,value:n.value,currency:n.currency,environmentType:n.environmentType,actionId:n.actionId,uniqueIdentifier:n.uniqueIdentifier?`${n.uniqueIdentifier}-${t?"failure":"success"}`:undefined}),this.update(t=>{delete t.fragments[e]})}identify(e){const{metaMetricsId:t,participateInMetaMetrics:s}=this.state;if(!s||!t||!e)return;if("object"!=typeof e)return void console.warn("MetaMetricsController#identify: userTraits parameter must be an object. Received type: "+typeof e);const r=T(D,this,H).call(this,e);T(D,this,V).call(this,r)}updateExtensionUninstallUrl(e,s){const r={av:this.version};e&&(r.mmi=t.from(s).toString("base64"),r.env=E(j,this));const n=new URLSearchParams(r);E(O,this)&&E(O,this).runtime&&E(O,this).runtime.setUninstallURL(`https://metamask.io/uninstalled?${n}`)}async setParticipateInMetaMetrics(e){const{metaMetricsId:t}=this.state,s=e&&!t?this.generateMetaMetricsId():t;return this.update(t=>{t.participateInMetaMetrics=e,t.metaMetricsId=s}),e?(this.trackEventsAfterMetricsOptIn(),this.clearEventsAfterMetricsOptIn(),this.trackTracesAfterMetricsOptIn(),this.clearTracesAfterMetricsOptIn()):this.state.marketingCampaignCookieId&&this.setMarketingCampaignCookieId(null),E(j,this)!==y.ENVIRONMENT.DEVELOPMENT&&null!==s&&this.updateExtensionUninstallUrl(e,s),s}setDataCollectionForMarketing(e){const{metaMetricsId:t}=this.state;return this.update(t=>{t.dataCollectionForMarketing=e}),!e&&this.state.marketingCampaignCookieId&&this.setMarketingCampaignCookieId(null),t}setMarketingCampaignCookieId(e){this.update(t=>{t.marketingCampaignCookieId=e})}trackPage(e,t){try{if(!1===this.state.participateInMetaMetrics)return;if(null===this.state.participateInMetaMetrics&&(null==t||!t.isOptInPath))return;const{name:s,params:r,environmentType:n,page:i,referrer:a,actionId:o}=e,{metaMetricsId:c}=this.state,l=c?"userId":"anonymousId",d=c??u.METAMETRICS_ANONYMOUS_ID;T(D,this,X).call(this,"page",{messageId:I({actionId:o}),[l]:d,name:s,properties:{params:r,locale:this.locale,chain_id:this.chainId,environment_type:n},context:T(D,this,G).call(this,a,i)})}catch(e){E(N,this).call(this,e)}}trackEvent(e,t){T(D,this,U).call(this,e),T(D,this,F).call(this,e,t).catch(e=>{E(N,this).call(this,e)})}handleMetaMaskStateUpdate(e){const t=this._buildUserTraitsObject(e);t&&this.identify(t)}trackEventsAfterMetricsOptIn(){const{eventsBeforeMetricsOptIn:e}=this.state;e.forEach(e=>{this.trackEvent(e)})}clearEventsAfterMetricsOptIn(){this.update(e=>{e.eventsBeforeMetricsOptIn=[]})}addEventBeforeMetricsOptIn(e){this.update(t=>{t.eventsBeforeMetricsOptIn.push(e)})}trackTracesAfterMetricsOptIn(){const{tracesBeforeMetricsOptIn:e}=this.state;e.forEach(e=>{"start"===e.type?(0,f.trace)(e.request):"end"===e.type&&(0,f.endTrace)(e.request)})}clearTracesAfterMetricsOptIn(){this.update(e=>{e.tracesBeforeMetricsOptIn=[]})}addTraceBeforeMetricsOptIn(e){this.update(t=>{t.tracesBeforeMetricsOptIn.push(e)})}bufferedTrace(e,t){if(this.state.participateInMetaMetrics)return t?(0,f.trace)(e,t):(0,f.trace)(e);let s;if(e.parentContext&&"object"==typeof e.parentContext){const t=e.parentContext;s=null==t?void 0:t._name}return this.addTraceBeforeMetricsOptIn({type:"start",request:{...e,parentContext:undefined,startTime:e.startTime??Date.now()},parentTraceName:s}),undefined}bufferedEndTrace(e){this.state.participateInMetaMetrics?(0,f.endTrace)(e):this.addTraceBeforeMetricsOptIn({type:"end",request:{...e,timestamp:e.timestamp??Date.now()}})}updateTraits(e){this.update(t=>{t.traits={...t.traits,...e}})}getMetaMetricsId(){let{metaMetricsId:e}=this.state;return e||(e=this.generateMetaMetricsId(),this.update(t=>{t.metaMetricsId=e})),e}_buildUserTraitsObject(e){var t,s,n;const{traits:i}=this.state,a={[u.MetaMetricsUserTrait.AddressBookEntries]:(0,r.sum)(Object.values(e.addressBook).map(r.size)),[u.MetaMetricsUserTrait.InstallDateExt]:i[u.MetaMetricsUserTrait.InstallDateExt]||"",[u.MetaMetricsUserTrait.LedgerConnectionType]:e.ledgerTransportType,[u.MetaMetricsUserTrait.NetworksAdded]:Object.values(e.networkConfigurationsByChainId).map(e=>e.chainId),[u.MetaMetricsUserTrait.NetworksWithoutTicker]:Object.values(e.networkConfigurationsByChainId).filter(({nativeCurrency:e})=>!e).map(({chainId:e})=>e),[u.MetaMetricsUserTrait.ChainIdList]:[...Object.keys(e.networkConfigurationsByChainId).map(e=>`eip155:${parseInt(e,16)}`),...Object.keys(e.multichainNetworkConfigurationsByChainId)],[u.MetaMetricsUserTrait.NftAutodetectionEnabled]:e.useNftDetection,[u.MetaMetricsUserTrait.NumberOfAccounts]:Object.values(e.internalAccounts.accounts).length,[u.MetaMetricsUserTrait.NumberOfNftCollections]:T(D,this,K).call(this,e.allNfts),[u.MetaMetricsUserTrait.NumberOfNfts]:E(L,this).call(this,e.allNfts).length,[u.MetaMetricsUserTrait.NumberOfTokens]:T(D,this,q).call(this,e.allTokens),[u.MetaMetricsUserTrait.NumberOfHDEntropies]:T(D,this,W).call(this,e)??(null===(t=this.previousUserTraits)||void 0===t?void 0:t.number_of_hd_entropies),[u.MetaMetricsUserTrait.OpenSeaApiEnabled]:e.openSeaEnabled,[u.MetaMetricsUserTrait.ThreeBoxEnabled]:!1,[u.MetaMetricsUserTrait.Theme]:e.theme||"default",[u.MetaMetricsUserTrait.TokenDetectionEnabled]:e.useTokenDetection,[u.MetaMetricsUserTrait.ShowNativeTokenAsMainBalance]:e.ShowNativeTokenAsMainBalance,[u.MetaMetricsUserTrait.CurrentCurrency]:e.currentCurrency,[u.MetaMetricsUserTrait.SecurityProviders]:e.securityAlertsEnabled?["blockaid"]:[],[u.MetaMetricsUserTrait.PetnameAddressCount]:T(D,this,Z).call(this,e),[u.MetaMetricsUserTrait.IsMetricsOptedIn]:e.participateInMetaMetrics,[u.MetaMetricsUserTrait.HasMarketingConsent]:e.dataCollectionForMarketing,[u.MetaMetricsUserTrait.TokenSortPreference]:(null===(s=e.tokenSortConfig)||void 0===s?void 0:s.key)||"",[u.MetaMetricsUserTrait.PrivacyModeEnabled]:e.preferences.privacyMode,[u.MetaMetricsUserTrait.NetworkFilterPreference]:Object.keys(e.preferences.tokenNetworkFilter||{}),[u.MetaMetricsUserTrait.ProfileId]:null===(n=Object.entries(e.srpSessionData||{}))||void 0===n||null===(n=n[0])||void 0===n||null===(n=n[1])||void 0===n||null===(n=n.profile)||void 0===n?void 0:n.profileId};if(!this.previousUserTraits&&e.participateInMetaMetrics)return this.previousUserTraits=a,a;if(this.previousUserTraits&&!(0,r.isEqual)(this.previousUserTraits,a)){const t=(0,r.pickBy)(a,(e,t)=>{const s=this.previousUserTraits[t];return!(0,r.isEqual)(s,e)});return e.participateInMetaMetrics&&(this.previousUserTraits=a),t}return null}}function x(e){const t=e||this.messagingSystem.call("NetworkController:getState").selectedNetworkClientId,{configuration:{chainId:s}}=this.messagingSystem.call("NetworkController:getNetworkClientById",t);return s}async function F(e,t){if(!(this.state.participateInMetaMetrics||null!=t&&t.isOptIn))return;const s=[];if(e.sensitiveProperties){if(!0===(null==t?void 0:t.excludeMetaMetricsId))throw new Error("sensitiveProperties was specified in an event payload that also set the excludeMetaMetricsId flag");const n=M[`${e.event}`],i={...e,event:n??e.event},a=(0,r.merge)({...i.sensitiveProperties},{...i.properties});s.push(T(D,this,J).call(this,T(D,this,$).call(this,{...i,properties:a,isDuplicateAnonymizedEvent:!0}),{...t,excludeMetaMetricsId:!0}))}s.push(T(D,this,J).call(this,T(D,this,$).call(this,e),t)),await Promise.all(s)}function U(e){if(!e.event)throw new Error(`Must specify event. Event was: ${e.event}. Payload keys were: ${Object.keys(e)}. ${"object"==typeof e.properties?`Payload property keys were: ${Object.keys(e.properties)}`:""}`)}function G(e,t=u.METAMETRICS_BACKGROUND_PAGE_OBJECT){return{app:{name:"MetaMask Extension",version:this.version},userAgent:window.navigator.userAgent,page:t,referrer:e,marketingCampaignCookieId:this.state.marketingCampaignCookieId}}function $(e){const{event:t,properties:s,revenue:n,value:i,currency:a,category:o,page:c,referrer:u,environmentType:d=l.ENVIRONMENT_TYPE_BACKGROUND}=e;let p;return p=s&&"chain_id_caip"in s&&"string"==typeof s.chain_id_caip?null:s&&"chain_id"in s&&"string"==typeof s.chain_id?s.chain_id:this.chainId,{event:t,messageId:I(e),properties:{...(0,r.omit)(s,["revenue","locale","currency","value"]),revenue:n,value:i,currency:a,category:o,locale:this.locale,chain_id:p,environment_type:d},context:T(D,this,G).call(this,u,c)}}function H(e){return Object.entries(e).reduce((e,[t,s])=>T(D,this,Q).call(this,s)?{...e,[t]:s.toISOString()}:T(D,this,z).call(this,s)?{...e,[t]:s}:(console.warn(`MetaMetricsController: "${t}" value is not a valid trait type`),e),{})}function K(e={}){const t=E(L,this).call(this,e).map(e=>e.address);return new Set(t).size}function q(e){return Object.values(e).reduce((e,t)=>e+(0,r.sum)(Object.values(t).map(r.size)),0)}function W(e){var t;return(null===(t=e.keyrings)||void 0===t?void 0:t.filter(e=>e.type===w.KeyringType.hdKeyTree).length)??0}function V(e){const{metaMetricsId:t}=this.state;if(e&&0!==Object.keys(e).length)try{T(D,this,X).call(this,"identify",{userId:t??undefined,traits:e})}catch(e){E(N,this).call(this,e)}else console.warn("MetaMetricsController#_identify: No userTraits found")}function z(e){const t=typeof e;return"string"===t||"boolean"===t||"number"===t||T(D,this,Y).call(this,e)||T(D,this,Q).call(this,e)}function Y(e){return Array.isArray(e)&&(e.every(e=>"string"==typeof e)||e.every(e=>"boolean"==typeof e)||e.every(e=>"number"==typeof e))}function Q(e){return"[object Date]"===Object.prototype.toString.call(e)}function J(e,t){const{isOptIn:s,metaMetricsId:r,matomoEvent:n,flushImmediately:i}=t||{};let a="userId",c=this.state.metaMetricsId,l=(null==t?void 0:t.excludeMetaMetricsId)??!1;const d=Boolean(e.event.match(/^send|^confirm/iu));return!1!==(null==t?void 0:t.excludeMetaMetricsId)&&d&&(l=!0),l||s&&!r?(a="anonymousId",c=u.METAMETRICS_ANONYMOUS_ID):s&&r&&(c=r),e[a]=c??undefined,!0===n&&(e.properties.legacy_event=!0),new Promise((t,s)=>{T(D,this,X).call(this,"track",e,e=>{if(e){const t=(0,o.isErrorWithMessage)(e)?e.message:"",r=(0,o.isErrorWithStack)(e)?e.stack:undefined,n=new Error(t);return r&&(n.stack=r),s(n)}return t()}),i&&E(R,this).flush()})}function X(e,t,s){const{metaMetricsId:r,participateInMetaMetrics:n,latestNonAnonymousEventTimestamp:i}=this.state;if(!n||!r)return;const a=t.messageId||(0,m.generateRandomId)();let o=new Date;if(t.timestamp){const e=new Date(t.timestamp);(0,m.isValidDate)(e)&&(o=e)}const c={...t,messageId:a,timestamp:o};this.update(t=>{t.latestNonAnonymousEventTimestamp=c.anonymousId===u.METAMETRICS_ANONYMOUS_ID?i:o.valueOf(),t.segmentApiCalls[a]={eventType:e,payload:{...c,timestamp:c.timestamp.toString()}}});E(R,this)[e](c,e=>(this.update(e=>{delete e.segmentApiCalls[a]}),null==s?void 0:s(e)))}function Z(e){var t;const s=(null===(t=e.names)||void 0===t?void 0:t[a.NameType.ETHEREUM_ADDRESS])??{};return Object.keys(s).reduce((e,t)=>{const r=s[t];return e+Object.keys(r).reduce((e,t)=>{var s;return e+(Boolean(null===(s=r[t].name)||void 0===s?void 0:s.length)?1:0)},0)},0)}s.default=B}).call(this)}).call(this,e("buffer").Buffer)}}},{package:"$root$",file:"app/scripts/controllers/metametrics-controller.ts"}],[151,{"@metamask/base-controller":1203},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,s){Object.defineProperty(s,"__esModule",{value:!0}),s.MetaMetricsDataDeletionController=void 0;var r=e("@metamask/base-controller");function n(e,t){if(t.has(e))throw new TypeError("Cannot initialize the same private elements twice on an object")}function i(e,t){return e.get(a(e,t))}function a(e,t,s){if("function"==typeof e?e===t:e.has(t))return arguments.length<3?t:s;throw new TypeError("Private element is not present on this object")}const o="MetaMetricsDataDeletionController",c={metaMetricsDataDeletionId:{includeInStateLogs:!0,persist:!0,anonymous:!0,usedInUi:!0},metaMetricsDataDeletionTimestamp:{includeInStateLogs:!0,persist:!0,anonymous:!0,usedInUi:!0},metaMetricsDataDeletionStatus:{includeInStateLogs:!0,persist:!0,anonymous:!0,usedInUi:!0}};var l=new WeakMap,u=new WeakSet;class d extends r.BaseController{constructor({dataDeletionService:e,messenger:t,state:s}){var r,i;super({messenger:t,metadata:c,name:o,state:{metaMetricsDataDeletionId:null,metaMetricsDataDeletionTimestamp:0,...s}}),n(r=this,i=u),i.add(r),function(e,t,s){n(e,t),t.set(e,s)}(this,l,void 0),function(e,t,s){e.set(a(e,t),s)}(l,this,e),a(u,this,p).call(this)}async createMetaMetricsDataDeletionTask(){const{metaMetricsId:e}=this.messagingSystem.call("MetaMetricsController:getState");if(!e)throw new Error("MetaMetrics ID not found");const t=await i(l,this).createDataDeletionRegulationTask(e);this.update(e=>{e.metaMetricsDataDeletionId=t??null,e.metaMetricsDataDeletionTimestamp=Date.now()}),await this.updateDataDeletionTaskStatus()}async updateDataDeletionTaskStatus(){const e=this.state.metaMetricsDataDeletionId;if(!e)throw new Error("Delete Regulation id not found");const t=await i(l,this).fetchDeletionRegulationStatus(e);this.update(e=>{e.metaMetricsDataDeletionStatus=t??undefined})}}function p(){this.messagingSystem.registerActionHandler(`${o}:createMetaMetricsDataDeletionTask`,this.createMetaMetricsDataDeletionTask.bind(this)),this.messagingSystem.registerActionHandler(`${o}:updateDataDeletionTaskStatus`,this.updateDataDeletionTaskStatus.bind(this))}s.MetaMetricsDataDeletionController=d}}},{package:"$root$",file:"app/scripts/controllers/metametrics-data-deletion/metametrics-data-deletion.ts"}],[152,{"../../../shared/constants/network":5465,"@metamask/base-controller":1203,"@metamask/keyring-api":2012,"@metamask/multichain-network-controller":2105,"@metamask/utils":2835},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,s){Object.defineProperty(s,"__esModule",{value:!0}),s.NetworkOrderController=void 0;var r=e("@metamask/keyring-api"),n=e("@metamask/base-controller"),i=e("@metamask/utils"),a=e("@metamask/multichain-network-controller"),o=e("../../../shared/constants/network");const c={orderedNetworkList:[],enabledNetworkMap:{[i.KnownCaipNamespace.Eip155]:{[o.CHAIN_IDS.MAINNET]:!0,[o.CHAIN_IDS.LINEA_MAINNET]:!0,[o.CHAIN_IDS.BASE]:!0},[i.KnownCaipNamespace.Solana]:{[r.SolScope.Mainnet]:!0,[r.SolScope.Devnet]:!0},[i.KnownCaipNamespace.Bip122]:{}}},l={orderedNetworkList:{includeInStateLogs:!1,persist:!0,anonymous:!0,usedInUi:!0},enabledNetworkMap:{includeInStateLogs:!0,persist:!0,anonymous:!0,usedInUi:!0}};class u extends n.BaseController{constructor({messenger:e,state:t}){super({messenger:e,metadata:l,name:"NetworkOrderController",state:{...c,...t}}),this.messagingSystem.subscribe("NetworkController:stateChange",e=>{this.onNetworkControllerStateChange(e)}),this.messagingSystem.subscribe("NetworkController:networkRemoved",e=>{this.onNetworkRemoved(e.chainId)})}onNetworkControllerStateChange({networkConfigurationsByChainId:e}){this.update(t=>{const s=Object.keys(e).filter(e=>!o.TEST_CHAINS.includes(e)).map(a.toEvmCaipChainId),n=[r.BtcScope.Mainnet,r.SolScope.Mainnet],i=s.filter(e=>!t.orderedNetworkList.some(({networkId:t})=>t===e)).map(e=>({networkId:e}));t.orderedNetworkList=t.orderedNetworkList.filter(({networkId:e})=>s.includes(e)||n.includes(e)).concat(i)})}onNetworkRemoved(e){const t=(0,i.isCaipChainId)(e)?e:(0,a.toEvmCaipChainId)(e),{namespace:s}=(0,i.parseCaipChainId)(t);s===i.KnownCaipNamespace.Eip155?this.update(t=>{delete t.enabledNetworkMap[s][e],0===Object.keys(t.enabledNetworkMap[s]).length&&(t.enabledNetworkMap[s]["0x1"]=!0)}):this.update(e=>{delete e.enabledNetworkMap[s][t]})}updateNetworksList(e){this.update(t=>{t.orderedNetworkList=e.map(e=>({networkId:e}))})}setEnabledNetworks(e,t){if(!t)throw new Error("namespace is required to set enabled networks");if(!e)throw new Error("chainIds is required to set enabled networks");const s=Array.isArray(e)?e:[e];this.update(e=>{const r=Object.fromEntries(s.map(e=>[e,!0]));e.enabledNetworkMap[t]=r})}setEnabledNetworksMultichain(e,t){if(!t)throw new Error("namespace is required to set enabled networks");if(!e)throw new Error("chainIds is required to set enabled networks");const s=Array.isArray(e)?e:[e];this.update(e=>{const r=Object.fromEntries(s.map(e=>[e,!0])),n=Object.keys(e.enabledNetworkMap).reduce((e,s)=>s!==t?{...e,[s]:{}}:{...e,[s]:r},{});e.enabledNetworkMap=n})}}s.NetworkOrderController=u}}},{package:"$root$",file:"app/scripts/controllers/network-order.ts"}],[153,{"../../../shared/constants/onboarding":5468,"../../../shared/modules/environment":5559,"@metamask/base-controller":1203,loglevel:4573},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,s){Object.defineProperty(s,"__esModule",{value:!0}),s.getDefaultOnboardingControllerState=s.default=void 0;var r,n=e("@metamask/base-controller"),i=(r=e("loglevel"))&&r.__esModule?r:{default:r},a=e("../../../shared/constants/onboarding"),o=e("../../../shared/modules/environment");function c(e,t,s){return(t=function(e){var t=function(e,t){if("object"!=typeof e||!e)return e;var s=e[Symbol.toPrimitive];if(void 0!==s){var r=s.call(e,t||"default");if("object"!=typeof r)return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==typeof t?t:t+""}(t))in e?Object.defineProperty(e,t,{value:s,enumerable:!0,configurable:!0,writable:!0}):e[t]=s,e}const l=()=>({seedPhraseBackedUp:null,firstTimeFlowType:null,completedOnboarding:!1});s.getDefaultOnboardingControllerState=l;const u={onboardingTabs:{}},d={seedPhraseBackedUp:{includeInStateLogs:!0,persist:!0,anonymous:!0,usedInUi:!0},firstTimeFlowType:{includeInStateLogs:!0,persist:!0,anonymous:!0,usedInUi:!0},completedOnboarding:{includeInStateLogs:!0,persist:!0,anonymous:!0,usedInUi:!0},onboardingTabs:{includeInStateLogs:!0,persist:!1,anonymous:!1,usedInUi:!0}};class p extends n.BaseController{constructor({messenger:e,state:t}){super({messenger:e,metadata:d,name:"OnboardingController",state:{seedPhraseBackedUp:null,firstTimeFlowType:null,completedOnboarding:!1,...t,...u}}),c(this,"registerOnboarding",async(e,t)=>{if(this.state.completedOnboarding)return void i.default.debug("Ignoring registerOnboarding; user already onboarded");const{onboardingTabs:s}={...this.state??{}};s&&(s[e]&&s[e]===t||(i.default.debug(`Registering onboarding tab at location '${e}' with tabId '${t}'`),this.update(r=>{r.onboardingTabs={...s,[e]:t}})))})}setSeedPhraseBackedUp(e){this.update(t=>{t.seedPhraseBackedUp=e})}completeOnboarding(){return this.update(e=>{e.completedOnboarding=!0}),!0}setFirstTimeFlowType(e){this.update(t=>{t.firstTimeFlowType=e})}getIsSocialLoginFlow(){if(!(0,o.getIsSeedlessOnboardingFeatureEnabled)())return!1;const{firstTimeFlowType:e}=this.state;return e===a.FirstTimeFlowType.socialCreate||e===a.FirstTimeFlowType.socialImport}}s.default=p}}},{package:"$root$",file:"app/scripts/controllers/onboarding.ts"}],[159,{"../../../../../shared/constants/keyring":5458,"../../../../../shared/constants/snaps/permissions":5475,"@metamask/keyring-controller":2022,"@metamask/snaps-rpc-methods":2543,"@metamask/utils":2835},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,s){Object.defineProperty(s,"__esModule",{value:!0}),s.getSnapPermissionSpecifications=function(e,t){return{...(0,r.buildSnapEndowmentSpecifications)(Object.keys(a.ExcludedSnapEndowments)),...(0,r.buildSnapRestrictedMethodSpecifications)(Object.keys(a.ExcludedSnapPermissions),{getPreferences:()=>{const t=e.call("CurrencyRateController:getState").currentCurrency,{currentLocale:s,openSeaEnabled:r,preferences:{privacyMode:n,showTestNetworks:i},securityAlertsEnabled:a,useCurrencyRateCheck:o,useTransactionSimulations:c,useTokenDetection:l,useMultiAccountBalanceChecker:u,useNftDetection:d}=e.call("PreferencesController:getState");return{locale:s,currency:t,hideBalances:n,useSecurityAlerts:a,useExternalPricingData:o,simulateOnChainActions:c,useTokenDetection:l,batchCheckBalances:u,displayNftMedia:r,useNftDetection:d,showTestnets:i}},clearSnapState:e.call.bind(e,"SnapController:clearSnapState"),getMnemonic:async t=>{if(!t){const[t]=e.call("KeyringController:getKeyringsByType",o.KeyringType.hdKeyTree);if(!t.mnemonic)throw new Error("Primary keyring mnemonic unavailable.");return t.mnemonic}try{const{type:s,mnemonic:r}=await e.call("KeyringController:withKeyring",{id:t},async({keyring:e})=>({type:e.type,mnemonic:(0,i.hasProperty)(e,"mnemonic")?e.mnemonic:undefined}));if(s!==n.KeyringTypes.hd||!r)throw new Error(`Entropy source with ID "${t}" not found.`);return r}catch{throw new Error(`Entropy source with ID "${t}" not found.`)}},getMnemonicSeed:async t=>{if(!t){const[t]=e.call("KeyringController:getKeyringsByType",o.KeyringType.hdKeyTree);if(!t.seed)throw new Error("Primary keyring mnemonic unavailable.");return t.seed}try{const{type:s,seed:r}=await e.call("KeyringController:withKeyring",{id:t},async({keyring:e})=>({type:e.type,seed:(0,i.hasProperty)(e,"seed")?e.seed:undefined}));if(s!==n.KeyringTypes.hd||!r)throw new Error(`Entropy source with ID "${t}" not found.`);return r}catch{throw new Error(`Entropy source with ID "${t}" not found.`)}},getUnlockPromise:e.call.bind(e,"AppStateController:getUnlockPromise"),getSnap:e.call.bind(e,"SnapController:get"),handleSnapRpcRequest:e.call.bind(e,"SnapController:handleRequest"),getSnapState:e.call.bind(e,"SnapController:getSnapState"),requestUserApproval:t.addAndShowApprovalRequest,showNativeNotification:(t,s)=>e.call("RateLimitController:call",t,"showNativeNotification",t,s.message),showInAppNotification:(t,s)=>{const{content:r,message:n,title:i,footerLink:a}=s,o={interfaceId:r,message:n,title:i,footerLink:a};return e.call("RateLimitController:call",t,"showInAppNotification",t,o)},updateSnapState:e.call.bind(e,"SnapController:updateSnapState"),maybeUpdatePhishingList:()=>{const{usePhishDetect:t}=e.call("PreferencesController:getState");t&&e.call("PhishingController:maybeUpdateState")},isOnPhishingList:t=>{const{usePhishDetect:s}=e.call("PreferencesController:getState");return!!s&&e.call("PhishingController:testOrigin",t).result},createInterface:e.call.bind(e,"SnapInterfaceController:createInterface"),getInterface:e.call.bind(e,"SnapInterfaceController:getInterface"),getClientCryptography:()=>({}),getSnapKeyring:async()=>{const[s]=e.call("KeyringController:getKeyringsByType",o.KeyringType.snap);return s||(await t.addNewKeyring(o.KeyringType.snap),e.call("KeyringController:getKeyringsByType",o.KeyringType.snap)[0])}})}};var r=e("@metamask/snaps-rpc-methods"),n=e("@metamask/keyring-controller"),i=e("@metamask/utils"),a=e("../../../../../shared/constants/snaps/permissions"),o=e("../../../../../shared/constants/keyring")}}},{package:"$root$",file:"app/scripts/controllers/permissions/snaps/specifications.ts"}],[16,{"../../../../shared/constants/metametrics":5462,"@metamask/assets-controllers":1138,"@metamask/bridge-controller":1210},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,s){Object.defineProperty(s,"__esModule",{value:!0}),s.NftControllerInit=void 0;var r=e("@metamask/assets-controllers"),n=e("@metamask/bridge-controller"),i=e("../../../../shared/constants/metametrics");s.NftControllerInit=({controllerMessenger:e,initMessenger:t,persistedState:s})=>({controller:new r.NftController({state:s.NftController,messenger:e,onNftAdded:({address:e,symbol:s,tokenId:r,standard:a,source:o})=>t.call("MetaMetricsController:trackEvent",{event:i.MetaMetricsEventName.NftAdded,category:i.MetaMetricsEventCategory.Wallet,sensitiveProperties:{token_contract_address:e,token_symbol:s??null,token_id:r,token_standard:a,asset_type:n.AssetType.NFT,source:o}})})})}}},{package:"$root$",file:"app/scripts/controller-init/assets/nft-controller-init.ts"}],[161,{"../../../shared/constants/hardware-wallets":5456,"../../../shared/constants/network":5465,"../../../shared/constants/preferences":5470,"@metamask/base-controller":1203,"@metamask/preferences-controller":2330},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,s){Object.defineProperty(s,"__esModule",{value:!0}),s.getDefaultPreferencesControllerState=s.PreferencesController=void 0;var r=e("@metamask/base-controller"),n=e("@metamask/preferences-controller"),i=e("../../../shared/constants/network"),a=e("../../../shared/constants/hardware-wallets"),o=e("../../../shared/constants/preferences");function c(e,t){(function(e,t){if(t.has(e))throw new TypeError("Cannot initialize the same private elements twice on an object")})(e,t),t.add(e)}const l=()=>({addSnapAccountEnabled:!1,advancedGasFee:{},currentLocale:"",dismissSeedBackUpReminder:!1,enableMV3TimestampSave:!0,featureFlags:{},forgottenPassword:!1,identities:{},ipfsGateway:i.IPFS_DEFAULT_GATEWAY_URL,isIpfsGatewayEnabled:!0,isMultiAccountBalancesEnabled:!0,knownMethodData:{},ledgerTransportType:window.navigator.hid?a.LedgerTransportTypes.webhid:a.LedgerTransportTypes.u2f,lostIdentities:{},manageInstitutionalWallets:!1,openSeaEnabled:!0,overrideContentSecurityPolicyHeader:!0,preferences:{autoLockTimeLimit:undefined,avatarType:"maskicon",dismissSmartAccountSuggestionEnabled:!1,featureNotificationsEnabled:!1,hideZeroBalanceTokens:!1,petnamesEnabled:!0,privacyMode:!1,showConfirmationAdvancedDetails:!1,showExtensionInFullSizeView:!1,showFiatInTestnets:!1,showMultiRpcModal:!1,showNativeTokenAsMainBalance:!1,showTestNetworks:!1,skipDeepLinkInterstitial:!1,smartAccountOptIn:!0,smartTransactionsOptInStatus:!0,smartTransactionsMigrationApplied:!1,tokenNetworkFilter:{},tokenSortConfig:{key:"tokenFiatAmount",order:"dsc",sortCallback:"stringNumeric"},useNativeCurrencyAsPrimaryCurrency:!0},securityAlertsEnabled:!0,selectedAddress:"",showIncomingTransactions:{[n.ETHERSCAN_SUPPORTED_CHAIN_IDS.MAINNET]:!0,[n.ETHERSCAN_SUPPORTED_CHAIN_IDS.GOERLI]:!0,[n.ETHERSCAN_SUPPORTED_CHAIN_IDS.BSC]:!0,[n.ETHERSCAN_SUPPORTED_CHAIN_IDS.BSC_TESTNET]:!0,[n.ETHERSCAN_SUPPORTED_CHAIN_IDS.OPTIMISM]:!0,[n.ETHERSCAN_SUPPORTED_CHAIN_IDS.OPTIMISM_SEPOLIA]:!0,[n.ETHERSCAN_SUPPORTED_CHAIN_IDS.POLYGON]:!0,[n.ETHERSCAN_SUPPORTED_CHAIN_IDS.POLYGON_TESTNET]:!0,[n.ETHERSCAN_SUPPORTED_CHAIN_IDS.AVALANCHE]:!0,[n.ETHERSCAN_SUPPORTED_CHAIN_IDS.AVALANCHE_TESTNET]:!0,[n.ETHERSCAN_SUPPORTED_CHAIN_IDS.FANTOM]:!0,[n.ETHERSCAN_SUPPORTED_CHAIN_IDS.FANTOM_TESTNET]:!0,[n.ETHERSCAN_SUPPORTED_CHAIN_IDS.SEPOLIA]:!0,[n.ETHERSCAN_SUPPORTED_CHAIN_IDS.LINEA_GOERLI]:!0,[n.ETHERSCAN_SUPPORTED_CHAIN_IDS.LINEA_SEPOLIA]:!0,[n.ETHERSCAN_SUPPORTED_CHAIN_IDS.LINEA_MAINNET]:!0,[n.ETHERSCAN_SUPPORTED_CHAIN_IDS.MOONBEAM]:!0,[n.ETHERSCAN_SUPPORTED_CHAIN_IDS.MOONBEAM_TESTNET]:!0,[n.ETHERSCAN_SUPPORTED_CHAIN_IDS.MOONRIVER]:!0,[n.ETHERSCAN_SUPPORTED_CHAIN_IDS.GNOSIS]:!0},snapRegistryList:{},snapsAddSnapAccountModalDismissed:!1,theme:o.ThemeType.os,use4ByteResolution:!0,useAddressBarEnsResolution:!0,useBlockie:!1,useCurrencyRateCheck:!0,useExternalNameSources:!0,useExternalServices:!0,useMultiAccountBalanceChecker:!0,useNftDetection:!0,usePhishDetect:!0,useSafeChainsListValidation:!0,useTokenDetection:!0,useTransactionSimulations:!0,watchEthereumAccountEnabled:!1});s.getDefaultPreferencesControllerState=l;const u={addSnapAccountEnabled:{includeInStateLogs:!0,persist:!0,anonymous:!1,usedInUi:!0},advancedGasFee:{persist:!0,includeInStateLogs:!0,anonymous:!0,usedInUi:!0},currentLocale:{includeInStateLogs:!0,persist:!0,anonymous:!0,usedInUi:!0},dismissSeedBackUpReminder:{includeInStateLogs:!0,persist:!0,anonymous:!0,usedInUi:!0},enableMV3TimestampSave:{includeInStateLogs:!0,persist:!0,anonymous:!0,usedInUi:!0},featureFlags:{includeInStateLogs:!0,persist:!0,anonymous:!0,usedInUi:!0},forgottenPassword:{includeInStateLogs:!0,persist:!0,anonymous:!0,usedInUi:!0},identities:{includeInStateLogs:!0,persist:!0,anonymous:!1,usedInUi:!0},ipfsGateway:{includeInStateLogs:!0,persist:!0,anonymous:!1,usedInUi:!0},isIpfsGatewayEnabled:{includeInStateLogs:!0,persist:!0,anonymous:!1,usedInUi:!0},isMultiAccountBalancesEnabled:{includeInStateLogs:!0,persist:!0,anonymous:!0,usedInUi:!0},knownMethodData:{includeInStateLogs:!0,persist:!0,anonymous:!1,usedInUi:!0},ledgerTransportType:{includeInStateLogs:!0,persist:!0,anonymous:!0,usedInUi:!0},lostIdentities:{includeInStateLogs:!0,persist:!0,anonymous:!1,usedInUi:!0},manageInstitutionalWallets:{includeInStateLogs:!0,persist:!0,anonymous:!1,usedInUi:!0},openSeaEnabled:{includeInStateLogs:!0,persist:!0,anonymous:!0,usedInUi:!0},overrideContentSecurityPolicyHeader:{includeInStateLogs:!0,persist:!0,anonymous:!0,usedInUi:!0},preferences:{includeInStateLogs:!0,persist:!0,anonymous:!0,usedInUi:!0},securityAlertsEnabled:{includeInStateLogs:!0,persist:!0,anonymous:!1,usedInUi:!0},selectedAddress:{includeInStateLogs:!0,persist:!0,anonymous:!1,usedInUi:!0},showIncomingTransactions:{includeInStateLogs:!0,persist:!0,anonymous:!0,usedInUi:!0},snapRegistryList:{includeInStateLogs:!0,persist:!0,anonymous:!1,usedInUi:!0},snapsAddSnapAccountModalDismissed:{includeInStateLogs:!0,persist:!0,anonymous:!1,usedInUi:!0},textDirection:{includeInStateLogs:!0,persist:!0,anonymous:!1,usedInUi:!0},theme:{includeInStateLogs:!0,persist:!0,anonymous:!0,usedInUi:!0},use4ByteResolution:{includeInStateLogs:!0,persist:!0,anonymous:!0,usedInUi:!0},useAddressBarEnsResolution:{includeInStateLogs:!0,persist:!0,anonymous:!0,usedInUi:!0},useBlockie:{includeInStateLogs:!0,persist:!0,anonymous:!0,usedInUi:!0},useCurrencyRateCheck:{includeInStateLogs:!0,persist:!0,anonymous:!0,usedInUi:!0},useExternalNameSources:{includeInStateLogs:!0,persist:!0,anonymous:!1,usedInUi:!0},useExternalServices:{includeInStateLogs:!0,persist:!0,anonymous:!1,usedInUi:!0},useMultiAccountBalanceChecker:{includeInStateLogs:!0,persist:!0,anonymous:!0,usedInUi:!0},useNftDetection:{includeInStateLogs:!0,persist:!0,anonymous:!0,usedInUi:!0},usePhishDetect:{includeInStateLogs:!0,persist:!0,anonymous:!0,usedInUi:!0},useSafeChainsListValidation:{includeInStateLogs:!0,persist:!0,anonymous:!1,usedInUi:!0},useTokenDetection:{includeInStateLogs:!0,persist:!0,anonymous:!0,usedInUi:!0},useTransactionSimulations:{includeInStateLogs:!0,persist:!0,anonymous:!0,usedInUi:!0},watchEthereumAccountEnabled:{includeInStateLogs:!0,persist:!0,anonymous:!1,usedInUi:!0}};var d=new WeakSet;class p extends r.BaseController{constructor({messenger:e,state:t}){super({messenger:e,metadata:u,name:"PreferencesController",state:{...l(),...t}}),c(this,d),this.messagingSystem.subscribe("AccountsController:stateChange",function(e,t,s){if("function"==typeof e?e===t:e.has(t))return arguments.length<3?t:s;throw new TypeError("Private element is not present on this object")}(d,this,h).bind(this)),globalThis.setPreference=(e,t)=>this.setFeatureFlag(e,t)}setPasswordForgotten(e){this.update(t=>{t.forgottenPassword=e})}setUseBlockie(e){this.update(t=>{t.useBlockie=e})}setUsePhishDetect(e){this.update(t=>{t.usePhishDetect=e})}setUseMultiAccountBalanceChecker(e){this.update(t=>{t.useMultiAccountBalanceChecker=e})}setUseSafeChainsListValidation(e){this.update(t=>{t.useSafeChainsListValidation=e})}toggleExternalServices(e){this.update(t=>{t.useExternalServices=e}),this.setUseTokenDetection(e),this.setUseCurrencyRateCheck(e),this.setUsePhishDetect(e),this.setUseAddressBarEnsResolution(e),this.setOpenSeaEnabled(e),this.setUseNftDetection(e),this.setUseSafeChainsListValidation(e)}setUseTokenDetection(e){this.update(t=>{t.useTokenDetection=e})}setUseNftDetection(e){this.update(t=>{t.useNftDetection=e})}setUse4ByteResolution(e){this.update(t=>{t.use4ByteResolution=e})}setUseCurrencyRateCheck(e){this.update(t=>{t.useCurrencyRateCheck=e})}setOpenSeaEnabled(e){this.update(t=>{t.openSeaEnabled=e})}setSecurityAlertsEnabled(e){this.update(t=>{t.securityAlertsEnabled=e})}setAddSnapAccountEnabled(e){this.update(t=>{t.addSnapAccountEnabled=e})}setUseExternalNameSources(e){this.update(t=>{t.useExternalNameSources=e})}setUseTransactionSimulations(e){this.update(t=>{t.useTransactionSimulations=e})}setAdvancedGasFee({chainId:e,gasFeePreferences:t}){const{advancedGasFee:s}=this.state;this.update(r=>{r.advancedGasFee={...s,[e]:t}})}setTheme(e){this.update(t=>{t.theme=e})}addKnownMethodData(e,t){const{knownMethodData:s}=this.state,r={...s};r[e]=t,this.update(e=>{e.knownMethodData=r})}setCurrentLocale(e){const t=["ar","dv","fa","he","ku"].includes(e)?"rtl":"auto";return this.update(s=>{s.currentLocale=e,s.textDirection=t}),t}setSelectedAddress(e){const t=this.messagingSystem.call("AccountsController:getAccountByAddress",e);if(!t)throw new Error(`Identity for '${e} not found`);this.messagingSystem.call("AccountsController:setSelectedAccount",t.id)}getSelectedAddress(){return this.messagingSystem.call("AccountsController:getSelectedAccount").address}setAccountLabel(e,t){if(!e)throw new Error(`setAccountLabel requires a valid address, got ${String(e)}`);const s=this.messagingSystem.call("AccountsController:getAccountByAddress",e);return s?(this.messagingSystem.call("AccountsController:setAccountName",s.id,t),t):undefined}setFeatureFlag(e,t){const s={...this.state.featureFlags,[e]:t};return this.update(e=>{e.featureFlags=s}),s}setPreference(e,t){const s={...this.getPreferences(),[e]:t};return this.update(e=>{e.preferences=s}),s}getPreferences(){return this.state.preferences}getIpfsGateway(){return this.state.ipfsGateway}setIpfsGateway(e){return this.update(t=>{t.ipfsGateway=e}),e}setIsIpfsGatewayEnabled(e){this.update(t=>{t.isIpfsGatewayEnabled=e})}setUseAddressBarEnsResolution(e){this.update(t=>{t.useAddressBarEnsResolution=e})}setLedgerTransportPreference(e){return this.update(t=>{t.ledgerTransportType=e}),e}setDismissSeedBackUpReminder(e){this.update(t=>{t.dismissSeedBackUpReminder=e})}setOverrideContentSecurityPolicyHeader(e){this.update(t=>{t.overrideContentSecurityPolicyHeader=e})}setManageInstitutionalWallets(e){this.update(t=>{t.manageInstitutionalWallets=e})}setServiceWorkerKeepAlivePreference(e){this.update(t=>{t.enableMV3TimestampSave=e})}setSnapsAddSnapAccountModalDismissed(e){this.update(t=>{t.snapsAddSnapAccountModalDismissed=e})}}function h(e){const{accounts:t,selectedAccount:s}=e.internalAccounts,r=t[s],{identities:n,lostIdentities:i}=this.state,a=Object.values(t).map(e=>e.address.toLowerCase()),o=Object.keys(n).reduce((e,t)=>(a.includes(t.toLowerCase())&&(e[t]=n[t]),e),{...i??{}}),c=Object.values(t).reduce((e,t)=>(e[t.address]={address:t.address,name:t.metadata.name,lastSelected:t.metadata.lastSelected},e),{});this.update(e=>{e.identities=c,e.lostIdentities=o,e.selectedAddress=(null==r?void 0:r.address)||""})}s.PreferencesController=p}}},{package:"$root$",file:"app/scripts/controllers/preferences-controller.ts"}],[162,{"webextension-polyfill":5430},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,s){Object.defineProperty(s,"__esModule",{value:!0}),s.getNotificationImage=async function(){return await n.default.runtime.getURL("../../images/icon-64.png")};var r,n=(r=e("webextension-polyfill"))&&r.__esModule?r:{default:r}}}},{package:"$root$",file:"app/scripts/controllers/push-notifications/get-notification-image.ts"}],[163,{"../../../../shared/lib/translate":5551,"@metamask/notification-services-controller":2277},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,s){Object.defineProperty(s,"__esModule",{value:!0}),s.createNotificationMessage=function(e){return r.NotificationServicesPushController.Utils.createOnChainPushNotificationMessage(e,a)};var r=e("@metamask/notification-services-controller"),n=e("../../../../shared/lib/translate");const i=(...e)=>(0,n.t)(...e)??"",a={...{pushPlatformNotificationsFundsSentTitle:()=>i("pushPlatformNotificationsFundsSentTitle"),pushPlatformNotificationsFundsSentDescriptionDefault:()=>i("pushPlatformNotificationsFundsSentDescriptionDefault"),pushPlatformNotificationsFundsSentDescription:(e,t)=>i("pushPlatformNotificationsFundsSentDescription",e,t),pushPlatformNotificationsFundsReceivedTitle:()=>i("pushPlatformNotificationsFundsReceivedTitle"),pushPlatformNotificationsFundsReceivedDescriptionDefault:()=>i("pushPlatformNotificationsFundsReceivedDescriptionDefault"),pushPlatformNotificationsFundsReceivedDescription:(e,t)=>i("pushPlatformNotificationsFundsReceivedDescription",e,t),pushPlatformNotificationsSwapCompletedTitle:()=>i("pushPlatformNotificationsSwapCompletedTitle"),pushPlatformNotificationsSwapCompletedDescription:()=>i("pushPlatformNotificationsSwapCompletedDescription"),pushPlatformNotificationsNftSentTitle:()=>i("pushPlatformNotificationsNftSentTitle"),pushPlatformNotificationsNftSentDescription:()=>i("pushPlatformNotificationsNftSentDescription"),pushPlatformNotificationsNftReceivedTitle:()=>i("pushPlatformNotificationsNftReceivedTitle"),pushPlatformNotificationsNftReceivedDescription:()=>i("pushPlatformNotificationsNftReceivedDescription"),pushPlatformNotificationsStakingRocketpoolStakeCompletedTitle:()=>i("pushPlatformNotificationsStakingRocketpoolStakeCompletedTitle"),pushPlatformNotificationsStakingRocketpoolStakeCompletedDescription:()=>i("pushPlatformNotificationsStakingRocketpoolStakeCompletedDescription"),pushPlatformNotificationsStakingRocketpoolUnstakeCompletedTitle:()=>i("pushPlatformNotificationsStakingRocketpoolUnstakeCompletedTitle"),pushPlatformNotificationsStakingRocketpoolUnstakeCompletedDescription:()=>i("pushPlatformNotificationsStakingRocketpoolUnstakeCompletedDescription"),pushPlatformNotificationsStakingLidoStakeCompletedTitle:()=>i("pushPlatformNotificationsStakingLidoStakeCompletedTitle"),pushPlatformNotificationsStakingLidoStakeCompletedDescription:()=>i("pushPlatformNotificationsStakingLidoStakeCompletedDescription"),pushPlatformNotificationsStakingLidoStakeReadyToBeWithdrawnTitle:()=>i("pushPlatformNotificationsStakingLidoStakeReadyToBeWithdrawnTitle"),pushPlatformNotificationsStakingLidoStakeReadyToBeWithdrawnDescription:()=>i("pushPlatformNotificationsStakingLidoStakeReadyToBeWithdrawnDescription"),pushPlatformNotificationsStakingLidoWithdrawalRequestedTitle:()=>i("pushPlatformNotificationsStakingLidoWithdrawalRequestedTitle"),pushPlatformNotificationsStakingLidoWithdrawalRequestedDescription:()=>i("pushPlatformNotificationsStakingLidoWithdrawalRequestedDescription"),pushPlatformNotificationsStakingLidoWithdrawalCompletedTitle:()=>i("pushPlatformNotificationsStakingLidoWithdrawalCompletedTitle"),pushPlatformNotificationsStakingLidoWithdrawalCompletedDescription:()=>i("pushPlatformNotificationsStakingLidoWithdrawalCompletedDescription")},...{PositionLiquidatedTitle:()=>i("pushNotificationPositionLiquidatedTitle"),PositionLiquidatedDescriptionLong:e=>i("pushNotificationPositionLiquidatedDescriptionLong",e),PositionLiquidatedDescriptionShort:e=>i("pushNotificationPositionLiquidatedDescriptionShort",e),StopLossTriggeredTitle:()=>i("pushNotificationStopLossTriggeredTitle"),StopLossTriggeredDescriptionLong:e=>i("pushNotificationStopLossTriggeredDescriptionLong",e),StopLossTriggeredDescriptionShort:e=>i("pushNotificationStopLossTriggeredDescriptionShort",e),TakeProfitTriggeredTitle:()=>i("pushNotificationTakeProfitTriggeredTitle"),TakeProfitTriggeredDescriptionLong:e=>i("pushNotificationTakeProfitTriggeredDescriptionLong",e),TakeProfitTriggeredDescriptionShort:e=>i("pushNotificationTakeProfitTriggeredDescriptionShort",e),LimitOrderFilledTitle:()=>i("pushNotificationLimitOrderFilledTitle"),LimitOrderFilledDescriptionLong:e=>i("pushNotificationLimitOrderFilledDescriptionLong",e),LimitOrderFilledDescriptionShort:e=>i("pushNotificationLimitOrderFilledDescriptionShort",e)}}}}},{package:"$root$",file:"app/scripts/controllers/push-notifications/get-notification-message.ts"}],[164,{"../../platforms/extension":487,"./get-notification-image":162,"./get-notification-message":163},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,s){Object.defineProperty(s,"__esModule",{value:!0}),s.onPushNotificationClicked=async function(e,t){var s;e.notification.close();const r=t??(null==e||null===(s=e.notification)||void 0===s?void 0:s.data),n=`${c.getExtensionURL(null,null)}#notifications/${r.id}`;e.waitUntil(o.clients.openWindow(n))},s.onPushNotificationReceived=async function(e){const t=(0,a.createNotificationMessage)(e);if(!t)return;const s=null==o?void 0:o.registration;if(!s)return;const r=await(0,i.getNotificationImage)();await s.showNotification(t.title,{body:t.description,icon:r,tag:null==e?void 0:e.id,data:e})};var r,n=(r=e("../../platforms/extension"))&&r.__esModule?r:{default:r},i=e("./get-notification-image"),a=e("./get-notification-message");const o=self,c=new n.default}}},{package:"$root$",file:"app/scripts/controllers/push-notifications/index.ts"}],[165,{"../../../../shared/constants/common":5450,"../../../../shared/constants/gas":5455,"../../../../shared/constants/metametrics":5462,"../../../../shared/constants/network":5465,"../../../../shared/constants/smartTransactions":5474,"../../../../shared/constants/swaps":5478,"../../../../shared/constants/time":5480,"../../../../shared/lib/fetch-with-cache":5527,"../../../../shared/lib/sentry":5540,"../../../../shared/lib/swaps-utils":5543,"../../../../shared/lib/transactions-controller-utils":5548,"../../../../shared/modules/Numeric":5553,"../../../../shared/modules/conversion.utils":5558,"../../../../shared/modules/string-utils":5579,"../../../../shared/modules/swaps.utils":5580,"./swaps.constants":166,"./swaps.utils":167,"@ethersproject/contracts":635,"@ethersproject/providers":673,"@metamask/base-controller":1203,"bignumber.js":3684,"human-standard-token-abi":4351,lodash:4565},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,s){Object.defineProperty(s,"__esModule",{value:!0}),s.default=void 0;var r=e("@ethersproject/contracts"),n=e("@ethersproject/providers"),i=e("@metamask/base-controller"),a=e("bignumber.js"),o=C(e("human-standard-token-abi")),c=e("lodash"),l=e("../../../../shared/lib/sentry"),u=e("../../../../shared/constants/common"),d=e("../../../../shared/constants/gas"),p=e("../../../../shared/constants/metametrics"),h=e("../../../../shared/constants/network"),m=e("../../../../shared/constants/smartTransactions"),g=e("../../../../shared/constants/swaps"),f=e("../../../../shared/constants/time"),y=C(e("../../../../shared/lib/fetch-with-cache")),w=e("../../../../shared/lib/swaps-utils"),v=e("../../../../shared/lib/transactions-controller-utils"),b=e("../../../../shared/modules/conversion.utils"),S=e("../../../../shared/modules/Numeric"),E=e("../../../../shared/modules/string-utils"),k=e("../../../../shared/modules/swaps.utils"),T=e("./swaps.constants"),M=e("./swaps.utils");function C(e){return e&&e.__esModule?e:{default:e}}function I(e,t,s){A(e,t),t.set(e,s)}function A(e,t){if(t.has(e))throw new TypeError("Cannot initialize the same private elements twice on an object")}function _(e,t,s){return(t=function(e){var t=function(e,t){if("object"!=typeof e||!e)return e;var s=e[Symbol.toPrimitive];if(void 0!==s){var r=s.call(e,t||"default");if("object"!=typeof r)return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==typeof t?t:t+""}(t))in e?Object.defineProperty(e,t,{value:s,enumerable:!0,configurable:!0,writable:!0}):e[t]=s,e}function P(e,t){return e.get(O(e,t))}function N(e,t,s){return e.set(O(e,t),s),s}function O(e,t,s){if("function"==typeof e?e===t:e.has(t))return arguments.length<3?t:s;throw new TypeError("Private element is not present on this object")}const j={swapsState:{includeInStateLogs:!0,persist:!1,anonymous:!1,usedInUi:!0}};var R=new WeakMap,D=new WeakMap,L=new WeakMap,B=new WeakMap,x=new WeakMap,F=new WeakMap,U=new WeakSet;class G extends i.BaseController{constructor(e,t){var s,r,n;super({name:T.controllerName,metadata:j,messenger:e.messenger,state:{swapsState:{...(0,T.getDefaultSwapsControllerState)().swapsState,swapsFeatureFlags:(null==t||null===(s=t.swapsState)||void 0===s?void 0:s.swapsFeatureFlags)||{}}}}),A(r=this,n=U),n.add(r),_(this,"getBufferedGasLimit",void 0),_(this,"resetState",void 0),_(this,"trackMetaMetricsEvent",void 0),I(this,R,void 0),I(this,D,void 0),I(this,L,null),I(this,B,void 0),I(this,x,void 0),I(this,F,void 0),_(this,"_fetchTradesInfo",w.fetchTradesInfo),_(this,"__test__updateState",e=>{this.update(t=>({swapsState:{...t.swapsState,...e.swapsState}}))}),this.messagingSystem.registerActionHandler("SwapsController:fetchAndSetQuotes",this.fetchAndSetQuotes.bind(this)),this.messagingSystem.registerActionHandler("SwapsController:setSelectedQuoteAggId",this.setSelectedQuoteAggId.bind(this)),this.messagingSystem.registerActionHandler("SwapsController:resetSwapsState",this.resetSwapsState.bind(this)),this.messagingSystem.registerActionHandler("SwapsController:setSwapsTokens",this.setSwapsTokens.bind(this)),this.messagingSystem.registerActionHandler("SwapsController:clearSwapsQuotes",this.clearSwapsQuotes.bind(this)),this.messagingSystem.registerActionHandler("SwapsController:setApproveTxId",this.setApproveTxId.bind(this)),this.messagingSystem.registerActionHandler("SwapsController:setTradeTxId",this.setTradeTxId.bind(this)),this.messagingSystem.registerActionHandler("SwapsController:setSwapsTxGasPrice",this.setSwapsTxGasPrice.bind(this)),this.messagingSystem.registerActionHandler("SwapsController:setSwapsTxGasLimit",this.setSwapsTxGasLimit.bind(this)),this.messagingSystem.registerActionHandler("SwapsController:setSwapsTxMaxFeePerGas",this.setSwapsTxMaxFeePerGas.bind(this)),this.messagingSystem.registerActionHandler("SwapsController:setSwapsTxMaxFeePriorityPerGas",this.setSwapsTxMaxFeePriorityPerGas.bind(this)),this.messagingSystem.registerActionHandler("SwapsController:safeRefetchQuotes",this.safeRefetchQuotes.bind(this)),this.messagingSystem.registerActionHandler("SwapsController:stopPollingForQuotes",this.stopPollingForQuotes.bind(this)),this.messagingSystem.registerActionHandler("SwapsController:setBackgroundSwapRouteState",this.setBackgroundSwapRouteState.bind(this)),this.messagingSystem.registerActionHandler("SwapsController:resetPostFetchState",this.resetPostFetchState.bind(this)),this.messagingSystem.registerActionHandler("SwapsController:setSwapsErrorKey",this.setSwapsErrorKey.bind(this)),this.messagingSystem.registerActionHandler("SwapsController:setInitialGasEstimate",this.setInitialGasEstimate.bind(this)),this.messagingSystem.registerActionHandler("SwapsController:setCustomApproveTxData",this.setCustomApproveTxData.bind(this)),this.messagingSystem.registerActionHandler("SwapsController:setSwapsLiveness",this.setSwapsLiveness.bind(this)),this.messagingSystem.registerActionHandler("SwapsController:setSwapsFeatureFlags",this.setSwapsFeatureFlags.bind(this)),this.messagingSystem.registerActionHandler("SwapsController:setSwapsUserFeeLevel",this.setSwapsUserFeeLevel.bind(this)),this.messagingSystem.registerActionHandler("SwapsController:setSwapsQuotesPollingLimitEnabled",this.setSwapsQuotesPollingLimitEnabled.bind(this)),this.getBufferedGasLimit=e.getBufferedGasLimit,this.trackMetaMetricsEvent=e.trackMetaMetricsEvent,this.resetState=()=>{this.update(e=>{e.swapsState={...(0,T.getDefaultSwapsControllerState)().swapsState,swapsFeatureFlags:null==e?void 0:e.swapsState.swapsFeatureFlags}})},N(B,this,e.getEIP1559GasFeeEstimates),N(x,this,e.getLayer1GasFee),N(R,this,0),N(D,this,0),this._fetchTradesInfo=e.fetchTradesInfo||w.fetchTradesInfo}clearSwapsQuotes(){this.update(e=>{e.swapsState.quotes={},e.swapsState.selectedAggId=null,e.swapsState.topAggId=null})}async fetchAndSetQuotes(e,t,s=!1){var r;if(!e)return null;let n;n=(null===(r=P(F,this))||void 0===r?void 0:r.clientId)===t.networkClientId?P(F,this):O(U,this,$).call(this,t.networkClientId);const{quotesPollingLimitEnabled:i,saveFetchedQuotes:a}=this.state.swapsState;s||N(D,this,0),P(L,this)&&clearTimeout(P(L,this)),s||this.setSwapsErrorKey("");const o=P(R,this)+1;N(R,this,o),a||this._setSaveFetchedQuotes(!0);let[l]=await Promise.all([this._fetchTradesInfo(e,{chainId:n.chainId}),this._setSwapsNetworkConfig(n)]);const{saveFetchedQuotes:u}=this.state.swapsState;if(!u)return[{},null];l=(0,c.mapValues)(l,e=>({...e,sourceTokenInfo:null==t?void 0:t.sourceTokenInfo,destinationTokenInfo:null==t?void 0:t.destinationTokenInfo}));const d=n.chainId===h.CHAIN_IDS.OPTIMISM.toString(),p=n.chainId===h.CHAIN_IDS.BASE.toString();(d||p)&&Object.values(l).length>0&&await Promise.all(Object.values(l).map(async e=>{if(e.trade){const t=await P(x,this).call(this,{transactionParams:e.trade,networkClientId:n.clientId});e.multiLayerL1TradeFeeTotal=t}return e}));const m=Date.now();let f=!1;if(!(0,k.isSwapsDefaultTokenAddress)(e.sourceToken,n.chainId)&&Object.values(l).length){const t=await this._getERC20Allowance(e.sourceToken,e.fromAddress,n),[r]=Object.values(l);if(f=r.approvalNeeded&&(t.eq(0)||t.lt(r.sourceAmount))&&"wrappedNative"!==r.aggregator,f){if(!s&&r.approvalNeeded){const{gasLimit:e}=await this._timedoutGasReturn(r.approvalNeeded,r.aggregator);l=(0,c.mapValues)(l,t=>t.approvalNeeded?{...t,approvalNeeded:{...t.approvalNeeded,gas:e||g.DEFAULT_ERC20_APPROVE_GAS}}:t)}}else l=(0,c.mapValues)(l,e=>({...e,approvalNeeded:null}))}let y=null;if(f||null!=e&&e.balanceError||(l=await this._getAllQuotesWithGasEstimates(l)),0===Object.values(l).length)this.setSwapsErrorKey(g.QUOTES_NOT_AVAILABLE_ERROR);else{const e=await this.getTopQuoteWithCalculatedSavings({quotes:l});Array.isArray(e)&&(y=e[0],l=e[1])}if(P(R,this)!==o)throw new Error(g.SWAPS_FETCH_ORDER_CONFLICT);let{selectedAggId:w}=this.state.swapsState;return w&&l[w]||(w=null),this.update(s=>{s.swapsState.quotes=l,s.swapsState.fetchParams={...e,metaData:t},s.swapsState.quotesLastFetched=m,s.swapsState.selectedAggId=w,s.swapsState.topAggId=y}),i&&N(D,this,P(D,this)+1),!i||P(D,this)<T.POLL_COUNT_LIMIT+1?(this._pollForNewQuotes(),[l,y]):(this.resetPostFetchState(),this.setSwapsErrorKey(g.QUOTES_EXPIRED_ERROR),null)}async getTopQuoteWithCalculatedSavings({quotes:e,networkClientId:t}){var s;let r;if(t){const e=this.messagingSystem.call("NetworkController:getNetworkClientById",t);r=e.configuration.chainId}else{if(P(F,this)===undefined)throw new Error("There is no network set");r=P(F,this).chainId}const{marketData:n}=this._getTokenRatesState(),i=(null==n?void 0:n[r])??{},{customGasPrice:o,customMaxPriorityFeePerGas:l}=this.state.swapsState;if(0===Object.keys(e).length)return{};const p=(0,c.cloneDeep)(e),{gasFeeEstimates:h,gasEstimateType:m}=await P(B,this).call(this,{networkClientId:t});let g="0x0";if(m===d.GasEstimateTypes.feeMarket){const{high:{suggestedMaxPriorityFeePerGas:e},estimatedBaseFee:t}=h,s=(0,b.decGWEIToHexWEI)(Number(e)),r=new S.Numeric(t,10,u.EtherDenomination.GWEI).toDenomination(u.EtherDenomination.WEI);g=new S.Numeric(l||s,16).add(r).round(6).toString()}else m===d.GasEstimateTypes.legacy?g=o||(0,b.decGWEIToHexWEI)(Number(h.high)):m===d.GasEstimateTypes.ethGasPrice&&(g=o||(0,b.decGWEIToHexWEI)(Number(h.gasPrice)));let f,y="";Object.values(p).forEach(e=>{const{aggregator:t,approvalNeeded:s,averageGas:n,destinationAmount:o,destinationToken:c,destinationTokenInfo:l,gasEstimateWithRefund:d,sourceAmount:p,sourceToken:h,trade:m,fee:w,multiLayerL1TradeFeeTotal:M}=e;if(!m||!c)return;const C=(d?new a.BigNumber(d,16):new a.BigNumber(n||T.MAX_GAS_LIMIT,10)).plus((null==s?void 0:s.gas)||"0x0",16).toString(16);let I=(0,v.calcGasTotal)(C,g);null!==M&&(I=(0,b.sumHexes)(I||"0x0",M||"0x0"));const A=new S.Numeric(I,16,u.EtherDenomination.WEI).add(new S.Numeric(m.value,16,u.EtherDenomination.WEI)),_=A.toDenomination(u.EtherDenomination.ETH).round(6).value,P=(0,k.isSwapsDefaultTokenAddress)(h,r)?A.minus(new S.Numeric(p,10)).toDenomination(u.EtherDenomination.ETH).round(6).value:_,N=(0,v.calcTokenAmount)(o??"0",l.decimals),O=new a.BigNumber(100,10).minus(w,10).div(100),j=N.div(O).minus(N),R=Object.keys(i).find(e=>(0,E.isEqualCaseInsensitive)(e,c)),D=R?i[R]:null,L=(null==D?void 0:D.price)||1,B=N.times(L.toString(10),10),x=(0,k.isSwapsDefaultTokenAddress)(c,r)?1:null==D?void 0:D.price,F=x?B.minus(P,10):B;e.ethFee=P.toString(10),x&&(e.ethValueOfTokens=B.toString(10),e.overallValueOfQuote=F.toString(10),e.metaMaskFeeInEth=j.times(x.toString(10)).toString(10)),f&&!F.gt(f||0)||(y=t,f=F)});const w=Object.keys(i).find(e=>{var t;return(0,E.isEqualCaseInsensitive)(e,null===(t=p[y])||void 0===t?void 0:t.destinationToken)}),C=w?i[w]:null;if((0,k.isSwapsDefaultTokenAddress)(null===(s=p[y])||void 0===s?void 0:s.destinationToken,r)||Boolean(null==C?void 0:C.price)){const e=p[y],{ethFee:t,metaMaskFeeInEth:s,ethValueOfTokens:r}=(0,M.getMedianEthValueQuote)(Object.values(p)),n=new a.BigNumber(e.ethValueOfTokens,10).minus(r,10).toString(10),i=new a.BigNumber(t).minus(e.ethFee,10).toString(10),o=e.metaMaskFeeInEth,c={performance:n,fee:i,total:new a.BigNumber(n).plus(i).minus(o).toString(10),metaMaskFee:o,medianMetaMaskFee:s};p[y].isBestQuote=!0,p[y].savings=c}return[y,p]}resetPostFetchState(){this.update(e=>{e.swapsState={...(0,T.getDefaultSwapsControllerState)().swapsState,tokens:e.swapsState.tokens,fetchParams:e.swapsState.fetchParams,swapsFeatureIsLive:e.swapsState.swapsFeatureIsLive,swapsQuoteRefreshTime:e.swapsState.swapsQuoteRefreshTime,swapsQuotePrefetchingRefreshTime:e.swapsState.swapsQuotePrefetchingRefreshTime,swapsFeatureFlags:e.swapsState.swapsFeatureFlags}}),P(L,this)&&clearTimeout(P(L,this))}resetSwapsState(){this.update(e=>{e.swapsState={...(0,T.getDefaultSwapsControllerState)().swapsState,swapsQuoteRefreshTime:e.swapsState.swapsQuoteRefreshTime,swapsQuotePrefetchingRefreshTime:e.swapsState.swapsQuotePrefetchingRefreshTime,swapsFeatureFlags:e.swapsState.swapsFeatureFlags}}),P(L,this)&&clearTimeout(P(L,this))}safeRefetchQuotes(){!P(L,this)&&this.state.swapsState.fetchParams&&this.fetchAndSetQuotes(this.state.swapsState.fetchParams,{...this.state.swapsState.fetchParams.metaData})}setApproveTxId(e){this.update(t=>{t.swapsState.approveTxId=e})}setBackgroundSwapRouteState(e){this.update(t=>{t.swapsState.routeState=e})}setCustomApproveTxData(e){this.update(t=>{t.swapsState.customApproveTxData=e})}async setInitialGasEstimate(e){const t={...this.state.swapsState.quotes[e]},{gasLimit:s,simulationFails:r}=t.trade?await this._timedoutGasReturn(t.trade,t.aggregator):{gasLimit:null,simulationFails:!0};if(s&&!r){const e=(0,M.calculateGasEstimateWithRefund)(t.maxGas,t.estimatedRefund,s);t.gasEstimate=s,t.gasEstimateWithRefund=e}this.update(s=>{s.swapsState.quotes={...s.swapsState.quotes,[e]:t}})}setSelectedQuoteAggId(e){this.update(t=>{t.swapsState.selectedAggId=e})}setSwapsFeatureFlags(e){this.update(t=>{t.swapsState.swapsFeatureFlags=e})}setSwapsErrorKey(e){this.update(t=>{t.swapsState.errorKey=e})}setSwapsLiveness(e){const{swapsFeatureIsLive:t}=e;this.update(e=>{e.swapsState.swapsFeatureIsLive=t})}setSwapsQuotesPollingLimitEnabled(e){this.update(t=>{t.swapsState.quotesPollingLimitEnabled=e})}setSwapsTokens(e){this.update(t=>{t.swapsState.tokens=e})}setSwapsTxGasLimit(e){this.update(t=>{t.swapsState.customMaxGas=e})}setSwapsTxGasPrice(e){this.update(t=>{t.swapsState.customGasPrice=e})}setSwapsTxMaxFeePerGas(e){this.update(t=>{t.swapsState.customMaxFeePerGas=e})}setSwapsTxMaxFeePriorityPerGas(e){this.update(t=>{t.swapsState.customMaxPriorityFeePerGas=e})}setSwapsUserFeeLevel(e){this.update(t=>{t.swapsState.swapsUserFeeLevel=e})}setTradeTxId(e){this.update(t=>{t.swapsState.tradeTxId=e})}stopPollingForQuotes(){P(L,this)&&clearTimeout(P(L,this))}async _fetchSwapsNetworkConfig(e){const t=await(0,y.default)({url:(0,w.getBaseApi)("network",e.chainId),fetchOptions:{method:"GET"},cacheOptions:{cacheRefreshTime:6e5},functionName:"_fetchSwapsNetworkConfig"}),{refreshRates:s,parameters:r={}}=t||{};if(!s||"number"!=typeof s.quotes||"number"!=typeof s.quotesPrefetching)throw new Error(`MetaMask - invalid response for refreshRates: ${t}`);return{quotes:1e3*s.quotes,quotesPrefetching:1e3*s.quotesPrefetching,stxGetTransactions:1e3*s.stxGetTransactions,stxBatchStatus:1e3*s.stxBatchStatus,stxStatusDeadline:s.stxStatusDeadline,stxMaxFeeMultiplier:r.stxMaxFeeMultiplier}}async _getAllQuotesWithGasEstimates(e){const t=await Promise.all(Object.values(e).map(async e=>{if(!e.trade)return{gasLimit:null,simulationFails:!0,aggId:e.aggregator};const{gasLimit:t,simulationFails:s}=await this._timedoutGasReturn(e.trade,e.aggregator);return{gasLimit:t,simulationFails:s,aggId:e.aggregator}})),s={};return t.forEach(({gasLimit:t,simulationFails:r,aggId:n})=>{if(t&&!r){const r=(0,M.calculateGasEstimateWithRefund)(e[n].maxGas,e[n].estimatedRefund,t);s[n]={...e[n],gasEstimate:t,gasEstimateWithRefund:r}}else e[n].approvalNeeded&&(s[n]=e[n])}),s}async _getERC20Allowance(e,t,s){const n=new r.Contract(e,o.default,s.ethersProvider);return await n.allowance(t,g.SWAPS_CHAINID_CONTRACT_ADDRESS_MAP[s.chainId])}_getTokenRatesState(){const{marketData:e}=this.messagingSystem.call("TokenRatesController:getState");return{marketData:e}}_pollForNewQuotes(){const{swapsQuoteRefreshTime:e,swapsQuotePrefetchingRefreshTime:t,quotesPollingLimitEnabled:s}=this.state.swapsState;N(L,this,setTimeout(()=>{var e;this.fetchAndSetQuotes(this.state.swapsState.fetchParams,null===(e=this.state.swapsState.fetchParams)||void 0===e?void 0:e.metaData,!0)},s?e:t))}_setSaveFetchedQuotes(e){this.update(t=>{t.swapsState.saveFetchedQuotes=e})}async _setSwapsNetworkConfig(e){let t=null;try{t=await this._fetchSwapsNetworkConfig(e)}catch(e){console.error("Request for Swaps network config failed: ",e)}this.update(e=>{var s,r,n,i,a,o;e.swapsState.swapsQuoteRefreshTime=(null===(s=t)||void 0===s?void 0:s.quotes)||T.FALLBACK_QUOTE_REFRESH_TIME,e.swapsState.swapsQuotePrefetchingRefreshTime=(null===(r=t)||void 0===r?void 0:r.quotesPrefetching)||T.FALLBACK_QUOTE_REFRESH_TIME,e.swapsState.swapsStxGetTransactionsRefreshTime=(null===(n=t)||void 0===n?void 0:n.stxGetTransactions)||m.FALLBACK_SMART_TRANSACTIONS_REFRESH_TIME,e.swapsState.swapsStxBatchStatusRefreshTime=(null===(i=t)||void 0===i?void 0:i.stxBatchStatus)||m.FALLBACK_SMART_TRANSACTIONS_REFRESH_TIME,e.swapsState.swapsStxMaxFeeMultiplier=(null===(a=t)||void 0===a?void 0:a.stxMaxFeeMultiplier)||m.FALLBACK_SMART_TRANSACTIONS_MAX_FEE_MULTIPLIER,e.swapsState.swapsStxStatusDeadline=(null===(o=t)||void 0===o?void 0:o.stxStatusDeadline)||m.FALLBACK_SMART_TRANSACTIONS_DEADLINE})}_timedoutGasReturn(e,t=""){return new Promise(s=>{let r=!1;const n=setTimeout(()=>{r=!0,this.trackMetaMetricsEvent({event:p.MetaMetricsEventName.QuoteError,category:p.MetaMetricsEventCategory.Swaps,properties:{error_type:p.MetaMetricsEventErrorType.GasTimeout,aggregator:t}}),s({gasLimit:null,simulationFails:!0})},5*f.SECOND),i={data:e.data,from:e.from,to:e.to,value:e.value};this.getBufferedGasLimit({txParams:i},1).then(({gasLimit:e,simulationFails:t})=>{r||(clearTimeout(n),s({gasLimit:e,simulationFails:t}))}).catch(e=>{(0,l.captureException)(e,{extra:{aggregator:t}}),r||(clearTimeout(n),s({gasLimit:null,simulationFails:!0}))})})}}function $(e){const t=this.messagingSystem.call("NetworkController:getNetworkClientById",e),{chainId:s}=t.configuration,r={client:t,clientId:e,chainId:s,ethersProvider:new n.Web3Provider(t.provider)};return N(F,this,r),r}s.default=G}}},{package:"$root$",file:"app/scripts/controllers/swaps/index.ts"}],[166,{"../../../../shared/constants/smartTransactions":5474,"../../../../shared/constants/time":5480},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,s){Object.defineProperty(s,"__esModule",{value:!0}),s.controllerName=s.POLL_COUNT_LIMIT=s.MAX_GAS_LIMIT=s.FALLBACK_QUOTE_REFRESH_TIME=void 0,s.getDefaultSwapsControllerState=function(){return{swapsState:{quotes:{},quotesPollingLimitEnabled:!1,fetchParams:null,tokens:null,tradeTxId:null,approveTxId:null,quotesLastFetched:null,customMaxGas:"",customGasPrice:null,customMaxFeePerGas:null,customMaxPriorityFeePerGas:null,swapsUserFeeLevel:"",selectedAggId:null,customApproveTxData:"",errorKey:"",topAggId:null,routeState:"",swapsFeatureIsLive:!0,saveFetchedQuotes:!1,swapsQuoteRefreshTime:i,swapsQuotePrefetchingRefreshTime:i,swapsStxBatchStatusRefreshTime:r.FALLBACK_SMART_TRANSACTIONS_REFRESH_TIME,swapsStxStatusDeadline:r.FALLBACK_SMART_TRANSACTIONS_DEADLINE,swapsStxGetTransactionsRefreshTime:r.FALLBACK_SMART_TRANSACTIONS_REFRESH_TIME,swapsStxMaxFeeMultiplier:r.FALLBACK_SMART_TRANSACTIONS_MAX_FEE_MULTIPLIER,swapsFeatureFlags:{}}}};var r=e("../../../../shared/constants/smartTransactions"),n=e("../../../../shared/constants/time");s.controllerName="SwapsController",s.MAX_GAS_LIMIT=25e5,s.POLL_COUNT_LIMIT=3;const i=s.FALLBACK_QUOTE_REFRESH_TIME=n.MINUTE}}},{package:"$root$",file:"app/scripts/controllers/swaps/swaps.constants.ts"}],[167,{"./swaps.constants":166,"bignumber.js":3684},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,s){Object.defineProperty(s,"__esModule",{value:!0}),s.calculateGasEstimateWithRefund=function(e=n.MAX_GAS_LIMIT,t="0",s="0"){const i=new r.BigNumber(e,10).minus(t,10),a=i.lt(0);return!a&&i.lt(s,16)?`0x${i.toString(16)}`:s},s.getMedianEthValueQuote=function(e){if(!Array.isArray(e)||0===e.length)throw new Error("Expected non-empty array param.");const t=[...e];if(t.sort((e,t)=>{const s=new r.BigNumber(e.overallValueOfQuote,10),n=new r.BigNumber(t.overallValueOfQuote,10);return s.equals(n)?0:s.lessThan(n)?-1:1}),t.length%2==1){const e=t[(t.length-1)/2].overallValueOfQuote;return i(t.filter(t=>e===t.overallValueOfQuote))}const s=t.length/2,n=s-1,a=t[s].overallValueOfQuote,o=t[n].overallValueOfQuote,c=t.filter(e=>a===e.overallValueOfQuote),l=t.filter(e=>o===e.overallValueOfQuote),u=i(c),d=i(l);return{ethFee:new r.BigNumber(u.ethFee,10).plus(d.ethFee,10).dividedBy(2).toString(10),metaMaskFeeInEth:new r.BigNumber(u.metaMaskFeeInEth,10).plus(d.metaMaskFeeInEth,10).dividedBy(2).toString(10),ethValueOfTokens:new r.BigNumber(u.ethValueOfTokens,10).plus(d.ethValueOfTokens,10).dividedBy(2).toString(10)}},s.meansOfQuotesFeesAndValue=i;var r=e("bignumber.js"),n=e("./swaps.constants");function i(e){const t=e.reduce((e,t)=>({ethFee:e.ethFee.plus(t.ethFee,10),metaMaskFeeInEth:e.metaMaskFeeInEth.plus(t.metaMaskFeeInEth,10),ethValueOfTokens:e.ethValueOfTokens.plus(t.ethValueOfTokens,10)}),{ethFee:new r.BigNumber(0,10),metaMaskFeeInEth:new r.BigNumber(0,10),ethValueOfTokens:new r.BigNumber(0,10)});return{ethFee:t.ethFee.div(e.length,10).toString(10),metaMaskFeeInEth:t.metaMaskFeeInEth.div(e.length,10).toString(10),ethValueOfTokens:t.ethValueOfTokens.div(e.length,10).toString(10)}}}}},{package:"$root$",file:"app/scripts/controllers/swaps/swaps.utils.ts"}],[168,{"../../shared/constants/app":5447,"./lib/util":276,"webextension-polyfill":5430},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,s){Object.defineProperty(s,"__esModule",{value:!0}),s.onMessageReceived=s.checkForMultipleVersionsRunning=void 0;var r,n=(r=e("webextension-polyfill"))&&r.__esModule?r:{default:r},i=e("../../shared/constants/app"),a=e("./lib/util");const o="isRunning";s.onMessageReceived=e=>{e===o&&console.warn("Warning! You have multiple instances of MetaMask running!")};s.checkForMultipleVersionsRunning=async()=>{if((0,a.getPlatform)()!==i.PLATFORM_CHROME&&(0,a.getPlatform)()!==i.PLATFORM_FIREFOX)return;const e=(0,a.getPlatform)()===i.PLATFORM_CHROME?i.CHROME_BUILD_IDS:i.FIREFOX_BUILD_IDS,t=n.default.runtime.id;for(const s of e)if(s!==t)try{await n.default.runtime.sendMessage(s,o)}catch(e){}}}}},{package:"$root$",file:"app/scripts/detect-multiple-instances.js"}],[169,{},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,s){Object.defineProperty(s,"__esModule",{value:!0}),s.default=void 0;s.default={config:{}}}}},{package:"$root$",file:"app/scripts/first-time-state.js"}],[17,{"@metamask/assets-controllers":1138},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,s){Object.defineProperty(s,"__esModule",{value:!0}),s.NftDetectionControllerInit=void 0;var r=e("@metamask/assets-controllers");s.NftDetectionControllerInit=e=>{const{controllerMessenger:t,getController:s}=e,n=()=>s("NftController");return{controller:new r.NftDetectionController({messenger:t,addNft:(...e)=>n().addNft(...e),getNftState:()=>n().state,disabled:!s("PreferencesController").state.useNftDetection})}}}}},{package:"$root$",file:"app/scripts/controller-init/assets/nft-detection-controller-init.ts"}],[170,{"@metamask/name-controller":2199},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,s){Object.defineProperty(s,"__esModule",{value:!0}),s.ChangeType=s.AbstractPetnamesBridge=void 0;var r=e("@metamask/name-controller");function n(e,t,s){return(t=function(e){var t=function(e,t){if("object"!=typeof e||!e)return e;var s=e[Symbol.toPrimitive];if(void 0!==s){var r=s.call(e,t||"default");if("object"!=typeof r)return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==typeof t?t:t+""}(t))in e?Object.defineProperty(e,t,{value:s,enumerable:!0,configurable:!0,writable:!0}):e[t]=s,e}function i(e,t,s){a(e,t),t.set(e,s)}function a(e,t){if(t.has(e))throw new TypeError("Cannot initialize the same private elements twice on an object")}function o(e,t){return e.get(l(e,t))}function c(e,t,s){return e.set(l(e,t),s),s}function l(e,t,s){if("function"==typeof e?e===t:e.has(t))return arguments.length<3?t:s;throw new TypeError("Private element is not present on this object")}let u=s.ChangeType=function(e){return e.ADDED="ADDED",e.UPDATED="UPDATED",e.DELETED="DELETED",e}({});var d=function(e){return e.SOURCE_TO_PETNAMES="Source->Petnames",e.PETNAMES_TO_SOURCE="Petnames->Source",e}(d||{});function p({type:e,variation:t,value:s}){return`${e}/${t}/${e===r.NameType.ETHEREUM_ADDRESS?s.toLowerCase():s}`}var h=new WeakMap,m=new WeakMap,g=new WeakMap,f=new WeakSet;function y(e){if(o(g,this)===e)throw new Error(`Attempted to synchronize recursively in same direction: ${e}`);if(null!==o(g,this))return;c(g,this,e);const[t,s]="Source->Petnames"===e?[this.getSourceEntries(),l(f,this,w).call(this)]:[l(f,this,w).call(this),this.getSourceEntries()],r=l(f,this,b).call(this,s,t);l(f,this,S).call(this,r),c(g,this,null)}function w(){const{names:e}=o(m,this).state,t=[];for(const s of Object.values(r.NameType))for(const r of Object.keys(e[s]))for(const n of Object.keys(e[s][r])){const{name:i,sourceId:a,origin:o}=e[s][r][n];if(!i)continue;const c={value:r,type:s,name:i,variation:n,sourceId:a??undefined,origin:o??undefined};this.shouldSyncPetname(c)&&t.push(c)}return t}function v(e,t){e===u.DELETED?(delete t.sourceId,delete t.origin,o(m,this).setName({...t,name:null})):o(m,this).setName(t)}function b(e,t){const s=[],r=[],n=[],i=new Map(e.map(e=>[p(e),e])),a=new Map(t.map(e=>[p(e),e]));return a.forEach((e,t)=>{const n=i.get(t);n?e.name!==n.name&&r.push(e):s.push(e)}),i.forEach((e,t)=>{a.has(t)||n.push(e)}),{[u.ADDED]:s,[u.UPDATED]:r,[u.DELETED]:n}}function S(e){const t=o(g,this)===d.SOURCE_TO_PETNAMES?l(f,this,v).bind(this):this.updateSourceEntry.bind(this);for(const s of Object.values(u))for(const r of e[s])t(s,r)}s.AbstractPetnamesBridge=class{constructor({isTwoWay:e,nameController:t,messenger:s}){var r,o;a(r=this,o=f),o.add(r),i(this,h,void 0),i(this,m,void 0),i(this,g,null),n(this,"messenger",void 0),c(h,this,e),c(m,this,t),this.messenger=s}init(){o(h,this)&&this.messenger.subscribe("NameController:stateChange",()=>l(f,this,y).call(this,d.PETNAMES_TO_SOURCE)),this.onSourceChange(()=>l(f,this,y).call(this,d.SOURCE_TO_PETNAMES))}updateSourceEntry(e,t){throw new Error("updateSourceEntry must be overridden for two-way bridges")}shouldSyncPetname(e){return!0}}}}},{package:"$root$",file:"app/scripts/lib/AbstractPetnamesBridge.ts"}],[1708,{"@metamask/keyring-controller":2022},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,s){Object.defineProperty(s,"__esModule",{value:!0}),s.GetCallsStatusCode=s.EIP5792ErrorCode=s.MessageType=s.KEYRING_TYPES_SUPPORTING_7702=s.VERSION=void 0;const r=e("@metamask/keyring-controller");var n,i,a;s.VERSION="2.0.0",s.KEYRING_TYPES_SUPPORTING_7702=[r.KeyringTypes.hd,r.KeyringTypes.simple],function(e){e.SendTransaction="eth_sendTransaction"}(n||(s.MessageType=n={})),function(e){e[e.UnsupportedNonOptionalCapability=5700]="UnsupportedNonOptionalCapability",e[e.UnsupportedChainId=5710]="UnsupportedChainId",e[e.UnknownBundleId=5730]="UnknownBundleId",e[e.RejectedUpgrade=5750]="RejectedUpgrade"}(i||(s.EIP5792ErrorCode=i={})),function(e){e[e.PENDING=100]="PENDING",e[e.CONFIRMED=200]="CONFIRMED",e[e.FAILED_OFFCHAIN=400]="FAILED_OFFCHAIN",e[e.REVERTED=500]="REVERTED",e[e.REVERTED_PARTIAL=600]="REVERTED_PARTIAL"}(a||(s.GetCallsStatusCode=a={}))}}},{package:"@metamask/eip-5792-middleware",file:"node_modules/@metamask/eip-5792-middleware/dist/constants.cjs"}],[1709,{"../constants.cjs":1708,"@metamask/rpc-errors":2421,"@metamask/transaction-controller":2790},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,s){Object.defineProperty(s,"__esModule",{value:!0}),s.getCallsStatus=void 0;const r=e("@metamask/rpc-errors"),n=e("@metamask/transaction-controller"),i=e("../constants.cjs");s.getCallsStatus=function(e,t){const s=e.call("TransactionController:getState").transactions.filter(e=>e.batchId===t);if(!s?.length)throw new r.JsonRpcError(i.EIP5792ErrorCode.UnknownBundleId,"No matching bundle found");const a=s[0],{chainId:o,txReceipt:c}=a,l=function(e){const{hash:t,status:s}=e;if(s===n.TransactionStatus.confirmed)return i.GetCallsStatusCode.CONFIRMED;if(s===n.TransactionStatus.failed)return t?i.GetCallsStatusCode.REVERTED:i.GetCallsStatusCode.FAILED_OFFCHAIN;if(s===n.TransactionStatus.dropped)return i.GetCallsStatusCode.REVERTED;return i.GetCallsStatusCode.PENDING}(a),u=c,d=u?.logs??[],p=u&&[{blockHash:u.blockHash,blockNumber:u.blockNumber,gasUsed:u.gasUsed,logs:d.map(e=>({address:e.address,data:e.data,topics:e.topics})),status:u.status,transactionHash:u.transactionHash}];return{version:i.VERSION,id:t,chainId:o,atomic:!0,status:l,receipts:p}}}}},{package:"@metamask/eip-5792-middleware",file:"node_modules/@metamask/eip-5792-middleware/dist/hooks/getCallsStatus.cjs"}],[171,{"./AbstractPetnamesBridge":170,"@metamask/name-controller":2199},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,s){Object.defineProperty(s,"__esModule",{value:!0}),s.AccountIdentitiesPetnamesBridge=void 0;var r=e("@metamask/name-controller"),n=e("./AbstractPetnamesBridge");class i extends n.AbstractPetnamesBridge{constructor({nameController:e,messenger:t}){super({isTwoWay:!1,nameController:e,messenger:t})}getSourceEntries(){return this.messenger.call("AccountsController:listAccounts").map(e=>({value:e.address,type:r.NameType.ETHEREUM_ADDRESS,name:e.metadata.name,sourceId:undefined,variation:r.FALLBACK_VARIATION,origin:r.NameOrigin.ACCOUNT_IDENTITY}))}onSourceChange(e){this.messenger.subscribe("AccountsController:stateChange",e)}shouldSyncPetname(e){return e.origin===r.NameOrigin.ACCOUNT_IDENTITY}}s.AccountIdentitiesPetnamesBridge=i}}},{package:"$root$",file:"app/scripts/lib/AccountIdentitiesPetnamesBridge.ts"}],[1710,{"../constants.cjs":1708,"../utils.cjs":1717},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,s){Object.defineProperty(s,"__esModule",{value:!0}),s.getCapabilities=void 0;const r=e("../constants.cjs"),n=e("../utils.cjs");s.getCapabilities=async function(e,t,s,i){const{getDismissSmartAccountSuggestionEnabled:a,getIsSmartTransaction:o,isAtomicBatchSupported:c,isRelaySupported:l,getSendBundleSupportedChains:u}=e;let d=i?.map(e=>e.toLowerCase());if(!d?.length){const e=t.call("NetworkController:getState").networkConfigurationsByChainId;d=Object.keys(e)}const p=await c({address:s,chainIds:d}),h=await async function(e,t,s,r,n,i){const a=i.call("PreferencesController:getState").useTransactionSimulations,o=await Promise.all(t.map(({chainId:e})=>e).map(e=>r(e))),c=await n(e),l=t.map((e,t)=>({...e,relaySupportedForChain:o[t]}));return e.reduce((e,t)=>{const r=l.find(({chainId:e})=>e===t)??{},{isSupported:n=!1,relaySupportedForChain:i}=r,o=s(t),u=c[t]??!1;return a&&(o&&u||n&&i)&&(e[t]={alternateGasFees:{supported:!0}}),e},{})}(d,p,o,l,u,t);return d.reduce((e,i)=>{const o=p.find(({chainId:e})=>e===i)??{},{delegationAddress:c,isSupported:l,upgradeContractAddress:u}=o,d=a();let h=!1;try{const e=(0,n.getAccountKeyringType)(s,t);h=r.KEYRING_TYPES_SUPPORTING_7702.includes(e)}catch{}if(!l&&!(!d&&u&&!c&&h))return e;const m=l?"supported":"ready";return e[i]===undefined&&(e[i]={}),e[i].atomic={status:m},e},h)}}}},{package:"@metamask/eip-5792-middleware",file:"node_modules/@metamask/eip-5792-middleware/dist/hooks/getCapabilities.cjs"}],[1711,{"../constants.cjs":1708,"../utils.cjs":1717,"@metamask/rpc-errors":2421,"@metamask/transaction-controller":2790,"@metamask/utils":2835,uuid:5398},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,s){Object.defineProperty(s,"__esModule",{value:!0}),s.processSendCalls=void 0;const r=e("@metamask/rpc-errors"),n=e("@metamask/transaction-controller"),i=e("@metamask/utils"),a=e("uuid"),o=e("../constants.cjs"),c=e("../utils.cjs");function l(e){const{version:t}=e;if(t!==o.VERSION)throw r.rpcErrors.invalidInput(`Version not supported: Got ${t}, expected ${o.VERSION}`)}function u(e,t){const{chainId:s}=e;if(s&&s.toLowerCase()!==t.toLowerCase())throw r.rpcErrors.invalidParams(`Chain ID must match the dApp selected network: Got ${s}, expected ${t}`)}function d(e){const{calls:t,capabilities:s}=e,n=[...Object.keys(s??{}).filter(e=>!0!==s?.[e].optional),...t.flatMap(e=>Object.keys(e.capabilities??{}).filter(t=>!0!==e.capabilities?.[t].optional))];if(n?.length)throw new r.JsonRpcError(o.EIP5792ErrorCode.UnsupportedNonOptionalCapability,`Unsupported non-optional capabilities: ${n.join(", ")}`)}s.processSendCalls=async function(e,t,s,p){const{addTransactionBatch:h,addTransaction:m,getDismissSmartAccountSuggestionEnabled:g,isAtomicBatchSupported:f,validateSecurity:y}=e,{calls:w,from:v}=s,{networkClientId:b,origin:S}=p,E=w.map(e=>({params:e})),{chainId:k}=t.call("NetworkController:getNetworkClientById",b).configuration,T=v??t.call("AccountsController:getSelectedAccount").address,M=(0,a.v4)(),C=y.bind(null,M);let I;return I=1===Object.keys(E).length?await async function({addTransaction:e,chainId:t,from:s,networkClientId:r,origin:c,securityAlertId:p,sendCalls:h,transactions:m,validateSecurity:g}){!function(e,t){l(e),d(e),u(e,t)}(h,t);const f={from:s,...m[0].params,type:n.TransactionEnvelopeType.feeMarket},y={method:o.MessageType.SendTransaction,params:[f],origin:c};g(y,t);const w=function(){const e=(0,a.v4)(),t=new Uint8Array((0,a.parse)(e));return(0,i.bytesToHex)(t)}();return await e(f,{networkClientId:r,origin:c,securityAlertResponse:{securityAlertId:p},batchId:w}),w}({addTransaction:m,chainId:k,from:T,networkClientId:b,origin:S,securityAlertId:M,sendCalls:s,transactions:E,validateSecurity:C}):await async function({addTransactionBatch:e,isAtomicBatchSupported:t,chainId:s,from:n,getDismissSmartAccountSuggestionEnabled:i,networkClientId:a,messenger:p,origin:h,sendCalls:m,securityAlertId:g,transactions:f,validateSecurity:y}){const w=await t({address:n,chainIds:[s]}),v=w?.[0],b=(0,c.getAccountKeyringType)(n,p),S=i();!function(e,t,s,n,i){l(e),function(e,t,s){if(u(e,t),!s)throw new r.JsonRpcError(o.EIP5792ErrorCode.UnsupportedChainId,`EIP-7702 not supported on chain: ${t}`)}(e,t,n),d(e),function(e,t,s){if(t?.delegationAddress)return;if(e)throw new r.JsonRpcError(o.EIP5792ErrorCode.RejectedUpgrade,"EIP-7702 upgrade disabled by the user");if(!o.KEYRING_TYPES_SUPPORTING_7702.includes(s))throw new r.JsonRpcError(o.EIP5792ErrorCode.RejectedUpgrade,"EIP-7702 upgrade not supported on account")}(s,n,i)}(m,s,S,v,b);const E=await e({from:n,networkClientId:a,origin:h,securityAlertId:g,transactions:f,validateSecurity:y});return E.batchId}({addTransactionBatch:h,isAtomicBatchSupported:f,chainId:k,from:T,getDismissSmartAccountSuggestionEnabled:g,messenger:t,networkClientId:b,origin:S,sendCalls:s,securityAlertId:M,transactions:E,validateSecurity:C}),{id:I}}}}},{package:"@metamask/eip-5792-middleware",file:"node_modules/@metamask/eip-5792-middleware/dist/hooks/processSendCalls.cjs"}],[1712,{"./hooks/getCallsStatus.cjs":1709,"./hooks/getCapabilities.cjs":1710,"./hooks/processSendCalls.cjs":1711,"./methods/wallet_getCallsStatus.cjs":1713,"./methods/wallet_getCapabilities.cjs":1714,"./methods/wallet_sendCalls.cjs":1715},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,s){Object.defineProperty(s,"__esModule",{value:!0}),s.walletGetCapabilities=s.walletGetCallsStatus=s.walletSendCalls=s.getCapabilities=s.getCallsStatus=s.processSendCalls=void 0;var r=e("./hooks/processSendCalls.cjs");Object.defineProperty(s,"processSendCalls",{enumerable:!0,get:function(){return r.processSendCalls}});var n=e("./hooks/getCallsStatus.cjs");Object.defineProperty(s,"getCallsStatus",{enumerable:!0,get:function(){return n.getCallsStatus}});var i=e("./hooks/getCapabilities.cjs");Object.defineProperty(s,"getCapabilities",{enumerable:!0,get:function(){return i.getCapabilities}});var a=e("./methods/wallet_sendCalls.cjs");Object.defineProperty(s,"walletSendCalls",{enumerable:!0,get:function(){return a.walletSendCalls}});var o=e("./methods/wallet_getCallsStatus.cjs");Object.defineProperty(s,"walletGetCallsStatus",{enumerable:!0,get:function(){return o.walletGetCallsStatus}});var c=e("./methods/wallet_getCapabilities.cjs");Object.defineProperty(s,"walletGetCapabilities",{enumerable:!0,get:function(){return c.walletGetCapabilities}})}}},{package:"@metamask/eip-5792-middleware",file:"node_modules/@metamask/eip-5792-middleware/dist/index.cjs"}],[1713,{"../types.cjs":1716,"../utils.cjs":1717,"@metamask/rpc-errors":2421},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,s){Object.defineProperty(s,"__esModule",{value:!0}),s.walletGetCallsStatus=void 0;const r=e("@metamask/rpc-errors"),n=e("../types.cjs"),i=e("../utils.cjs");s.walletGetCallsStatus=async function(e,t,{getCallsStatus:s}){if(!s)throw r.rpcErrors.methodNotSupported();(0,i.validateParams)(e.params,n.GetCallsStatusStruct);const a=e.params[0];t.result=await s(a,e)}}}},{package:"@metamask/eip-5792-middleware",file:"node_modules/@metamask/eip-5792-middleware/dist/methods/wallet_getCallsStatus.cjs"}],[1714,{"../types.cjs":1716,"../utils.cjs":1717,"@metamask/rpc-errors":2421},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,s){Object.defineProperty(s,"__esModule",{value:!0}),s.walletGetCapabilities=void 0;const r=e("@metamask/rpc-errors"),n=e("../types.cjs"),i=e("../utils.cjs");s.walletGetCapabilities=async function(e,t,{getAccounts:s,getCapabilities:a}){if(!a)throw r.rpcErrors.methodNotSupported();(0,i.validateParams)(e.params,n.GetCapabilitiesStruct);const o=e.params[0],c=e.params[1];await(0,i.validateAndNormalizeKeyholder)(o,e,{getAccounts:s});const l=await a(o,c,e);t.result=l}}}},{package:"@metamask/eip-5792-middleware",file:"node_modules/@metamask/eip-5792-middleware/dist/methods/wallet_getCapabilities.cjs"}],[1715,{"../types.cjs":1716,"../utils.cjs":1717,"@metamask/rpc-errors":2421},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,s){Object.defineProperty(s,"__esModule",{value:!0}),s.walletSendCalls=void 0;const r=e("@metamask/rpc-errors"),n=e("../types.cjs"),i=e("../utils.cjs");s.walletSendCalls=async function(e,t,{getAccounts:s,processSendCalls:a}){if(!a)throw r.rpcErrors.methodNotSupported();(0,i.validateParams)(e.params,n.SendCallsStruct);const o=e.params[0],c=o.from?await(0,i.validateAndNormalizeKeyholder)(o.from,e,{getAccounts:s}):undefined,l={...o,from:c};t.result=await a(l,e)}}}},{package:"@metamask/eip-5792-middleware",file:"node_modules/@metamask/eip-5792-middleware/dist/methods/wallet_sendCalls.cjs"}],[1716,{"@metamask/superstruct":2741,"@metamask/utils":2835},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,s){Object.defineProperty(s,"__esModule",{value:!0}),s.SendCallsStruct=s.CapabilitiesStruct=s.GetCapabilitiesStruct=s.GetCallsStatusStruct=void 0;const r=e("@metamask/superstruct"),n=e("@metamask/utils");s.GetCallsStatusStruct=(0,r.tuple)([n.StrictHexStruct]),s.GetCapabilitiesStruct=(0,r.tuple)([n.HexChecksumAddressStruct,(0,r.optional)((0,r.array)(n.StrictHexStruct))]),s.CapabilitiesStruct=(0,r.record)((0,r.string)(),(0,r.type)({optional:(0,r.optional)((0,r.boolean)())})),s.SendCallsStruct=(0,r.tuple)([(0,r.object)({version:(0,r.nonempty)((0,r.string)()),id:(0,r.optional)(n.StrictHexStruct),from:(0,r.optional)(n.HexChecksumAddressStruct),chainId:n.StrictHexStruct,atomicRequired:(0,r.boolean)(),calls:(0,r.array)((0,r.object)({to:(0,r.optional)(n.HexChecksumAddressStruct),data:(0,r.optional)(n.StrictHexStruct),value:(0,r.optional)(n.StrictHexStruct),capabilities:(0,r.optional)(s.CapabilitiesStruct)})),capabilities:(0,r.optional)(s.CapabilitiesStruct)})])}}},{package:"@metamask/eip-5792-middleware",file:"node_modules/@metamask/eip-5792-middleware/dist/types.cjs"}],[1717,{"./constants.cjs":1708,"@metamask/rpc-errors":2421,"@metamask/superstruct":2741},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,s){Object.defineProperty(s,"__esModule",{value:!0}),s.resemblesAddress=s.validateParams=s.validateAndNormalizeKeyholder=s.getAccountKeyringType=void 0;const r=e("@metamask/rpc-errors"),n=e("@metamask/superstruct"),i=e("./constants.cjs");function a(e){return 42===e.length}s.getAccountKeyringType=function(e,t){const{accounts:s}=t.call("AccountsController:getState").internalAccounts,n=Object.values(s).find(t=>t.address.toLowerCase()===e.toLowerCase()),a=n?.metadata?.keyring?.type;if(!a)throw new r.JsonRpcError(i.EIP5792ErrorCode.RejectedUpgrade,"EIP-7702 upgrade not supported as account type is unknown");return a},s.validateAndNormalizeKeyholder=async function(e,t,{getAccounts:s}){if("string"==typeof e&&e.length>0&&a(e)){const n=(await s(t)).map(e=>e.toLowerCase()),i=e.toLowerCase();if(n.includes(i))return i;throw r.providerErrors.unauthorized()}throw r.rpcErrors.invalidParams({message:"Invalid parameters: must provide an Ethereum address."})},s.validateParams=function(e,t){const[s]=(0,n.validate)(e,t);if(s)throw r.rpcErrors.invalidParams(function(e,t){return`${t}\n\n${e.failures().map(e=>`${e.path.join(" > ")}${e.path.length?" - ":""}${e.message}`).join("\n")}`}(s,"Invalid params"))},s.resemblesAddress=a}}},{package:"@metamask/eip-5792-middleware",file:"node_modules/@metamask/eip-5792-middleware/dist/utils.cjs"}],[1718,{"@ethersproject/providers":673,"@metamask/base-controller":1203,"@metamask/controller-utils":1321,"@metamask/utils":2835,"punycode/punycode.js":4869},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,s){var r,n,i,a,o,c=this&&this.__classPrivateFieldGet||function(e,t,s,r){if("a"===s&&!r)throw new TypeError("Private accessor was defined without a getter");if("function"==typeof t?e!==t||!r:!t.has(e))throw new TypeError("Cannot read private member from an object whose class did not declare it");return"m"===s?r:"a"===s?r.call(e):r?r.value:t.get(e)},l=this&&this.__classPrivateFieldSet||function(e,t,s,r,n){if("m"===r)throw new TypeError("Private method is not writable");if("a"===r&&!n)throw new TypeError("Private accessor was defined without a setter");if("function"==typeof t?e!==t||!n:!t.has(e))throw new TypeError("Cannot write private member to an object whose class did not declare it");return"a"===r?n.call(e,s):n?n.value=s:t.set(e,s),s};Object.defineProperty(s,"__esModule",{value:!0}),s.EnsController=s.DEFAULT_ENS_NETWORK_MAP=void 0;const u=e("@ethersproject/providers"),d=e("@metamask/base-controller"),p=e("@metamask/controller-utils"),h=e("@metamask/utils"),m=e("punycode/punycode.js"),g=(0,h.createProjectLogger)("ens-controller");s.DEFAULT_ENS_NETWORK_MAP={1:"0x00000000000C2E074eC69A0dFb2997BA6C7d2e1e",3:"0x00000000000C2E074eC69A0dFb2997BA6C7d2e1e",4:"0x00000000000C2E074eC69A0dFb2997BA6C7d2e1e",5:"0x00000000000C2E074eC69A0dFb2997BA6C7d2e1e",17e3:"0x00000000000C2E074eC69A0dFb2997BA6C7d2e1e",11155111:"0x00000000000C2E074eC69A0dFb2997BA6C7d2e1e"};const f={ensEntries:{persist:!0,anonymous:!1},ensResolutionsByAddress:{persist:!0,anonymous:!1}},y={ensEntries:{},ensResolutionsByAddress:{}};class w extends d.BaseController{constructor({registriesByChainId:e=s.DEFAULT_ENS_NETWORK_MAP,messenger:t,state:o={},onNetworkDidChange:l}){super({name:"EnsController",metadata:f,messenger:t,state:{...y,ensEntries:Object.fromEntries(Object.entries(e).map(([e,t])=>[(0,p.toHex)(e),{".":{address:t,chainId:(0,p.toHex)(e),ensName:"."}}])),...o}}),r.add(this),n.set(this,null),c(this,r,"m",i).call(this,e),l&&l(({selectedNetworkClientId:t})=>{this.resetState(),c(this,r,"m",a).call(this,t,e)})}resetState(){this.update(e=>{e.ensResolutionsByAddress={}})}clear(){this.update(e=>{e.ensEntries={}})}delete(e,t){const s=(0,p.normalizeEnsName)(t);return!!((0,p.isSafeDynamicKey)(e)&&s&&this.state.ensEntries[e]&&this.state.ensEntries[e][s])&&(this.update(t=>{delete t.ensEntries[e][s],0===Object.keys(t.ensEntries[e]).length&&delete t.ensEntries[e]}),!0)}get(e,t){const s=(0,p.normalizeEnsName)(t);return s&&this.state.ensEntries[e]&&this.state.ensEntries[e][s]||null}set(e,t,s){if(!Number.isInteger(Number.parseInt(e,10))||!t||"string"!=typeof t||s&&!(0,p.isValidHexAddress)(s))throw new Error(`Invalid ENS entry: { chainId:${e}, ensName:${t}, address:${s}}`);const r=(0,p.normalizeEnsName)(t);if(!r)throw new Error(`Invalid ENS name: ${t}`);const n=s?(0,p.toChecksumHexAddress)(s):null,i=this.state.ensEntries[e];return(!i?.[r]||i[r].address!==n)&&(this.update(t=>{t.ensEntries={...this.state.ensEntries,[e]:{...this.state.ensEntries[e],[r]:{address:n,chainId:e,ensName:r}}}}),!0)}async reverseResolveAddress(e){if(!c(this,n,"f"))return undefined;const t=(0,p.toChecksumHexAddress)(e);if(this.state.ensResolutionsByAddress[t])return this.state.ensResolutionsByAddress[t];let s,r;try{s=await c(this,n,"f").lookupAddress(t)}catch(e){return g(e),undefined}if(!s)return undefined;try{r=await c(this,n,"f").resolveName(s)}catch(e){return g(e),undefined}return r?"0x0000000000000000000000000000000000000000"===r||"0x"===r||(0,p.toChecksumHexAddress)(r)!==t?undefined:(this.update(e=>{e.ensResolutionsByAddress[t]=(0,m.toASCII)(s)}),s):undefined}}s.EnsController=w,n=new WeakMap,r=new WeakSet,i=function(e){const{selectedNetworkClientId:t}=this.messagingSystem.call("NetworkController:getState");c(this,r,"m",a).call(this,t,e)},a=function(e,t){const{configuration:{chainId:s},provider:i}=this.messagingSystem.call("NetworkController:getNetworkClientById",e);t&&t[parseInt(s,16)]&&c(this,r,"m",o).call(this,s)?l(this,n,new u.Web3Provider(i,{chainId:(0,p.convertHexToDecimal)(s),name:p.CHAIN_ID_TO_ETHERS_NETWORK_NAME_MAP[s],ensAddress:t[parseInt(s,16)]}),"f"):l(this,n,null,"f")},o=function(e){return Boolean(this.state.ensEntries[e])},s.default=w}}},{package:"@metamask/ens-controller",file:"node_modules/@metamask/ens-controller/dist/EnsController.cjs"}],[1719,{"./EnsController.cjs":1718},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,s){var r=this&&this.__createBinding||(Object.create?function(e,t,s,r){r===undefined&&(r=s);var n=Object.getOwnPropertyDescriptor(t,s);n&&!("get"in n?!t.__esModule:n.writable||n.configurable)||(n={enumerable:!0,get:function(){return t[s]}}),Object.defineProperty(e,r,n)}:function(e,t,s,r){r===undefined&&(r=s),e[r]=t[s]}),n=this&&this.__exportStar||function(e,t){for(var s in e)"default"===s||Object.prototype.hasOwnProperty.call(t,s)||r(t,e,s)};Object.defineProperty(s,"__esModule",{value:!0}),n(e("./EnsController.cjs"),s)}}},{package:"@metamask/ens-controller",file:"node_modules/@metamask/ens-controller/dist/index.cjs"}],[172,{"./AbstractPetnamesBridge":170,"@metamask/name-controller":2199,"@metamask/utils":2835},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,s){Object.defineProperty(s,"__esModule",{value:!0}),s.AddressBookPetnamesBridge=void 0;var r=e("@metamask/name-controller"),n=e("@metamask/utils"),i=e("./AbstractPetnamesBridge");function a(e,t,s){(function(e,t){if(t.has(e))throw new TypeError("Cannot initialize the same private elements twice on an object")})(e,t),t.set(e,s)}function o(e,t){return e.get(c(e,t))}function c(e,t,s){if("function"==typeof e?e===t:e.has(t))return arguments.length<3?t:s;throw new TypeError("Private element is not present on this object")}var l=new WeakMap;class u extends i.AbstractPetnamesBridge{constructor({addressBookController:e,nameController:t,messenger:s}){var r,n,i;super({isTwoWay:!0,nameController:t,messenger:s}),a(this,l,void 0),n=this,i=e,(r=l).set(c(r,n),i)}getSourceEntries(){const e=[],{state:t}=o(l,this);for(const s of Object.keys(t.addressBook)){if(!(0,n.isStrictHexString)(s))continue;const i=t.addressBook[s];for(const n of Object.keys(i)){const i=t.addressBook[s][n],a=s.toLowerCase(),{name:o,isEns:c}=i;null!=o&&o.length&&null!=n&&n.length&&e.push({value:n,name:o,variation:a,type:r.NameType.ETHEREUM_ADDRESS,sourceId:c?"ens":undefined,origin:r.NameOrigin.ADDRESS_BOOK})}}return e}updateSourceEntry(e,t){e===i.ChangeType.DELETED?o(l,this).delete(t.variation,t.value):o(l,this).set(t.value,t.name,t.variation)}onSourceChange(e){this.messenger.subscribe("AddressBookController:stateChange",e)}}s.AddressBookPetnamesBridge=u}}},{package:"$root$",file:"app/scripts/lib/AddressBookPetnamesBridge.ts"}],[1720,{},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,s){var r,n,i=this&&this.__classPrivateFieldSet||function(e,t,s,r,n){if("m"===r)throw new TypeError("Private method is not writable");if("a"===r&&!n)throw new TypeError("Private accessor was defined without a setter");if("function"==typeof t?e!==t||!n:!t.has(e))throw new TypeError("Cannot write private member to an object whose class did not declare it");return"a"===r?n.call(e,s):n?n.value=s:t.set(e,s),s},a=this&&this.__classPrivateFieldGet||function(e,t,s,r){if("a"===s&&!r)throw new TypeError("Private accessor was defined without a getter");if("function"==typeof t?e!==t||!r:!t.has(e))throw new TypeError("Cannot read private member from an object whose class did not declare it");return"m"===s?r:"a"===s?r.call(e):r?r.value:t.get(e)};Object.defineProperty(s,"__esModule",{value:!0}),s.ErrorReportingService=void 0;s.ErrorReportingService=class{constructor({messenger:e,captureException:t}){r.set(this,void 0),n.set(this,void 0),i(this,n,e,"f"),i(this,r,t,"f"),a(this,n,"f").registerActionHandler("ErrorReportingService:captureException",a(this,r,"f").bind(this))}captureException(e){a(this,r,"f").call(this,e)}},r=new WeakMap,n=new WeakMap}}},{package:"@metamask/error-reporting-service",file:"node_modules/@metamask/error-reporting-service/dist/error-reporting-service.cjs"}],[1721,{"./error-reporting-service.cjs":1720},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,s){Object.defineProperty(s,"__esModule",{value:!0}),s.ErrorReportingService=void 0;var r=e("./error-reporting-service.cjs");Object.defineProperty(s,"ErrorReportingService",{enumerable:!0,get:function(){return r.ErrorReportingService}})}}},{package:"@metamask/error-reporting-service",file:"node_modules/@metamask/error-reporting-service/dist/index.cjs"}],[1728,{"./base-filter":1729},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,s){const r=e("./base-filter");t.exports=class extends r{constructor(){super(),this.allResults=[]}async update(){throw new Error("BaseFilterWithHistory - no update method specified")}addResults(e){this.allResults=this.allResults.concat(e),super.addResults(e)}addInitialResults(e){this.allResults=this.allResults.concat(e),super.addInitialResults(e)}getAllResults(){return this.allResults}}}}},{package:"@metamask/eth-json-rpc-filters",file:"node_modules/@metamask/eth-json-rpc-filters/base-filter-history.js"}],[1729,{"@metamask/safe-event-emitter":2423},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,s){const r=e("@metamask/safe-event-emitter").default;t.exports=class extends r{constructor(){super(),this.updates=[]}async initialize(){}async update(){throw new Error("BaseFilter - no update method specified")}addResults(e){this.updates=this.updates.concat(e),e.forEach(e=>this.emit("update",e))}addInitialResults(e){}getChangesAndClear(){const e=this.updates;return this.updates=[],e}}}}},{package:"@metamask/eth-json-rpc-filters",file:"node_modules/@metamask/eth-json-rpc-filters/base-filter.js"}],[173,{"@metamask/base-controller":1203,"@metamask/obs-store":2290},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,s){Object.defineProperty(s,"__esModule",{value:!0}),s.default=void 0;var r=e("@metamask/obs-store"),n=e("@metamask/base-controller");function i(e,t){(function(e,t){if(t.has(e))throw new TypeError("Cannot initialize the same private elements twice on an object")})(e,t),t.add(e)}function a(e,t,s){return(t=function(e){var t=function(e,t){if("object"!=typeof e||!e)return e;var s=e[Symbol.toPrimitive];if(void 0!==s){var r=s.call(e,t||"default");if("object"!=typeof r)return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==typeof t?t:t+""}(t))in e?Object.defineProperty(e,t,{value:s,enumerable:!0,configurable:!0,writable:!0}):e[t]=s,e}function o(e,t,s){if("function"==typeof e?e===t:e.has(t))return arguments.length<3?t:s;throw new TypeError("Private element is not present on this object")}var c=new WeakSet;class l extends r.ObservableStore{constructor({config:e,controllerMessenger:t,state:s,persist:r}){super(s),i(this,c),a(this,"config",{}),this.persist=r,this.controllerMessenger=t,e&&this.updateStructure(e)}updateStructure(e){this.config=e,this.removeAllListeners();const t={};for(const r of Object.keys(e)){var s;if(!e[r])throw new Error(`Undefined '${r}'`);const i=e[r];i.subscribe?e[r].subscribe(e=>{o(c,this,u).call(this,r,e)}):this.persist?this.controllerMessenger.subscribe(`${i.name}:stateChange`,(t,s)=>{o(c,this,d).call(this,e[r].metadata,s)&&o(c,this,u).call(this,r,(0,n.getPersistentState)(t,e[r].metadata))}):this.controllerMessenger.subscribe(`${i.name}:stateChange`,e=>o(c,this,u).call(this,r,e));const a=i.state??(null===(s=i.getState)||void 0===s?void 0:s.call(i));t[r]=this.persist&&e[r].metadata?(0,n.getPersistentState)(a,e[r].metadata):a}this.updateState(t)}getFlatState(){if(!this.config)return{};let e={};for(const t of Object.keys(this.config)){const s=this.config[t],r=s.getState?s.getState():s.state;e={...e,...r}}return e}}function u(e,t){const s=this.getState()[e];this.updateState({[e]:t}),this.emit("stateChange",{oldState:s,newState:t,controllerKey:e})}function d(e,t){return t.some(t=>{if(0===t.path.length)return!0;const s=t.path[0];return!e[s]||e[s].persist})}s.default=l}}},{package:"$root$",file:"app/scripts/lib/ComposableObservableStore.js"}],[1730,{"./base-filter":1729,"./getBlocksForRange":1731,"./hexUtils":1732},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,s){const r=e("./base-filter"),n=e("./getBlocksForRange"),{incrementHexInt:i}=e("./hexUtils");t.exports=class extends r{constructor({provider:e,params:t}){super(),this.type="block",this.provider=e}async update({oldBlock:e,newBlock:t}){const s=t,r=i(e),a=(await n({provider:this.provider,fromBlock:r,toBlock:s})).map(e=>e.hash);this.addResults(a)}}}}},{package:"@metamask/eth-json-rpc-filters",file:"node_modules/@metamask/eth-json-rpc-filters/block-filter.js"}],[1731,{},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,s){function r(e){return e===undefined||null===e?e:Number.parseInt(e,16)}function n(e){if(e===undefined||null===e)return e;return"0x"+e.toString(16)}t.exports=async function({provider:e,fromBlock:t,toBlock:s}){t||(t=s);const i=r(t),a=r(s),o=Array(a-i+1).fill().map((e,t)=>i+t).map(n);let c=await Promise.all(o.map(t=>async function(e,t,s){for(let r=0;r<3;r++)try{return e.request({id:1,jsonrpc:"2.0",method:t,params:s})}catch(e){console.error(`provider.request failed: ${e.stack||e.message||e}`)}return null}(e,"eth_getBlockByNumber",[t,!1])));return c=c.filter(e=>null!==e),c}}}},{package:"@metamask/eth-json-rpc-filters",file:"node_modules/@metamask/eth-json-rpc-filters/getBlocksForRange.js"}],[1732,{},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,s){function r(e){return e.sort((e,t)=>"latest"===e||"earliest"===t?1:"latest"===t||"earliest"===e?-1:n(e)-n(t))}function n(e){return e===undefined||null===e?e:Number.parseInt(e,16)}function i(e){if(e===undefined||null===e)return e;let t=e.toString(16);return t.length%2&&(t="0"+t),"0x"+t}function a(){return Math.floor(16*Math.random()).toString(16)}t.exports={minBlockRef:function(...e){return r(e)[0]},maxBlockRef:function(...e){const t=r(e);return t[t.length-1]},sortBlockRefs:r,bnToHex:function(e){return"0x"+e.toString(16)},blockRefIsNumber:function(e){return e&&!["earliest","latest","pending"].includes(e)},hexToInt:n,incrementHexInt:function(e){if(e===undefined||null===e)return e;return i(n(e)+1)},intToHex:i,unsafeRandomBytes:function(e){let t="0x";for(let s=0;s<e;s++)t+=a(),t+=a();return t}}}}},{package:"@metamask/eth-json-rpc-filters",file:"node_modules/@metamask/eth-json-rpc-filters/hexUtils.js"}],[1733,{"./block-filter.js":1730,"./hexUtils":1732,"./log-filter.js":1734,"./tx-filter.js":1736,"@metamask/json-rpc-engine":1961,"async-mutex":3618},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,s){const r=e("async-mutex").Mutex,{createAsyncMiddleware:n,createScaffoldMiddleware:i}=e("@metamask/json-rpc-engine"),a=e("./log-filter.js"),o=e("./block-filter.js"),c=e("./tx-filter.js"),{intToHex:l,hexToInt:u}=e("./hexUtils");function d(e){return p(async(...t)=>{const s=await e(...t);return l(s.id)})}function p(e){return n(async(t,s)=>{const r=await e.apply(null,t.params);s.result=r})}function h(e,t){const s=[];for(let t in e)s.push(e[t]);return s}t.exports=function({blockTracker:e,provider:t}){let s=0,n={};const m=new r,g=function({mutex:e}){return t=>async(s,r,n,i)=>{(await e.acquire())(),t(s,r,n,i)}}({mutex:m}),f=i({eth_newFilter:g(d(w)),eth_newBlockFilter:g(d(v)),eth_newPendingTransactionFilter:g(d(b)),eth_uninstallFilter:g(p(k)),eth_getFilterChanges:g(p(S)),eth_getFilterLogs:g(p(E))}),y=async({oldBlock:e,newBlock:t})=>{if(0===n.length)return;const s=await m.acquire();try{await Promise.all(h(n).map(async s=>{try{await s.update({oldBlock:e,newBlock:t})}catch(e){console.error(e)}}))}catch(e){console.error(e)}s()};return f.newLogFilter=w,f.newBlockFilter=v,f.newPendingTransactionFilter=b,f.uninstallFilter=k,f.getFilterChanges=S,f.getFilterLogs=E,f.destroy=()=>{!async function(){const e=h(n).length;n={},M({prevFilterCount:e,newFilterCount:0})}()},f;async function w(e){const s=new a({provider:t,params:e});await T(s);return s}async function v(){const e=new o({provider:t});await T(e);return e}async function b(){const e=new c({provider:t});await T(e);return e}async function S(e){const t=u(e),s=n[t];if(!s)throw new Error(`No filter for index "${t}"`);return s.getChangesAndClear()}async function E(e){const t=u(e),s=n[t];if(!s)throw new Error(`No filter for index "${t}"`);let r=[];return"log"===s.type&&(r=s.getAllResults()),r}async function k(e){const t=u(e),s=n[t],r=Boolean(s);return r&&await async function(e){const t=h(n).length;delete n[e];const s=h(n).length;M({prevFilterCount:t,newFilterCount:s})}(t),r}async function T(t){const r=h(n).length,i=await e.getLatestBlock();await t.initialize({currentBlock:i}),s++,n[s]=t,t.id=s,t.idHex=l(s);return M({prevFilterCount:r,newFilterCount:h(n).length}),s}function M({prevFilterCount:t,newFilterCount:s}){0===t&&s>0?e.on("sync",y):t>0&&0===s&&e.removeListener("sync",y)}}}}},{package:"@metamask/eth-json-rpc-filters",file:"node_modules/@metamask/eth-json-rpc-filters/index.js"}],[1734,{"./base-filter-history":1728,"./hexUtils":1732,"@metamask/eth-query":1854,pify:4796},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,s){const r=e("@metamask/eth-query"),n=e("pify"),i=e("./base-filter-history"),{bnToHex:a,hexToInt:o,incrementHexInt:c,minBlockRef:l,blockRefIsNumber:u}=e("./hexUtils");t.exports=class extends i{constructor({provider:e,params:t}){super(),this.type="log",this.ethQuery=new r(e),this.params=Object.assign({fromBlock:"latest",toBlock:"latest",address:undefined,topics:[]},t),this.params.address&&(Array.isArray(this.params.address)||(this.params.address=[this.params.address]),this.params.address=this.params.address.map(e=>e.toLowerCase()))}async initialize({currentBlock:e}){let t=this.params.fromBlock;["latest","pending"].includes(t)&&(t=e),"earliest"===t&&(t="0x0"),this.params.fromBlock=t;const s=l(this.params.toBlock,e),r=Object.assign({},this.params,{toBlock:s}),n=await this._fetchLogs(r);this.addInitialResults(n)}async update({oldBlock:e,newBlock:t}){const s=t;let r;r=e?c(e):t;const n=Object.assign({},this.params,{fromBlock:r,toBlock:s}),i=(await this._fetchLogs(n)).filter(e=>this.matchLog(e));this.addResults(i)}async _fetchLogs(e){return await n(t=>this.ethQuery.getLogs(e,t))()}matchLog(e){if(o(this.params.fromBlock)>=o(e.blockNumber))return!1;if(u(this.params.toBlock)&&o(this.params.toBlock)<=o(e.blockNumber))return!1;const t=e.address&&e.address.toLowerCase();if(this.params.address&&t&&!this.params.address.includes(t))return!1;return this.params.topics.every((t,s)=>{let r=e.topics[s];if(!r)return!1;r=r.toLowerCase();let n=Array.isArray(t)?t:[t];if(n.includes(null))return!0;n=n.map(e=>e.toLowerCase());return n.includes(r)})}}}}},{package:"@metamask/eth-json-rpc-filters",file:"node_modules/@metamask/eth-json-rpc-filters/log-filter.js"}],[1735,{"./getBlocksForRange.js":1731,"./hexUtils.js":1732,"./index.js":1733,"@metamask/json-rpc-engine":1961,"@metamask/safe-event-emitter":2423},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,s){const r=e("@metamask/safe-event-emitter").default,{createAsyncMiddleware:n,createScaffoldMiddleware:i}=e("@metamask/json-rpc-engine"),a=e("./index.js"),{unsafeRandomBytes:o,incrementHexInt:c}=e("./hexUtils.js"),l=e("./getBlocksForRange.js");function u(e){return null===e||e===undefined?null:{hash:e.hash,parentHash:e.parentHash,sha3Uncles:e.sha3Uncles,miner:e.miner,stateRoot:e.stateRoot,transactionsRoot:e.transactionsRoot,receiptsRoot:e.receiptsRoot,logsBloom:e.logsBloom,difficulty:e.difficulty,number:e.number,gasLimit:e.gasLimit,gasUsed:e.gasUsed,nonce:e.nonce,mixHash:e.mixHash,timestamp:e.timestamp,extraData:e.extraData}}t.exports=function({blockTracker:e,provider:t}){const s={},d=a({blockTracker:e,provider:t});let p=!1;const h=new r,m=i({eth_subscribe:n(async function(r,n){if(p)throw new Error("SubscriptionManager - attempting to use after destroying");const i=r.params[0],a=o(16);let h;switch(i){case"newHeads":h=m({subId:a});break;case"logs":const e=r.params[1];h=f({subId:a,filter:await d.newLogFilter(e)});break;default:throw new Error(`SubscriptionManager - unsupported subscription type "${i}"`)}return s[a]=h,void(n.result=a);function m({subId:s}){const r={type:i,destroy:async()=>{e.removeListener("sync",r.update)},update:async({oldBlock:e,newBlock:r})=>{const n=r,i=c(e);(await l({provider:t,fromBlock:i,toBlock:n})).map(u).filter(e=>null!==e).forEach(e=>{g(s,e)})}};return e.on("sync",r.update),r}function f({subId:e,filter:t}){t.on("update",t=>g(e,t));return{type:i,destroy:async()=>await d.uninstallFilter(t.idHex)}}}),eth_unsubscribe:n(async function(e,t){if(p)throw new Error("SubscriptionManager - attempting to use after destroying");const r=e.params[0],n=s[r];if(!n)return void(t.result=!1);delete s[r],await n.destroy(),t.result=!0})});return m.destroy=function(){h.removeAllListeners();for(const e in s)s[e].destroy(),delete s[e];p=!0},{events:h,middleware:m};function g(e,t){h.emit("notification",{jsonrpc:"2.0",method:"eth_subscription",params:{subscription:e,result:t}})}}}}},{package:"@metamask/eth-json-rpc-filters",file:"node_modules/@metamask/eth-json-rpc-filters/subscriptionManager.js"}],[1736,{"./base-filter":1729,"./getBlocksForRange":1731,"./hexUtils":1732},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,s){const r=e("./base-filter"),n=e("./getBlocksForRange"),{incrementHexInt:i}=e("./hexUtils");t.exports=class extends r{constructor({provider:e}){super(),this.type="tx",this.provider=e}async update({oldBlock:e}){const t=e,s=i(e),r=await n({provider:this.provider,fromBlock:s,toBlock:t}),a=[];for(const e of r)a.push(...e.transactions);this.addResults(a)}}}}},{package:"@metamask/eth-json-rpc-filters",file:"node_modules/@metamask/eth-json-rpc-filters/tx-filter.js"}],[174,{"webextension-polyfill":5430},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,s){Object.defineProperty(s,"__esModule",{value:!0}),s.CronjobControllerStorageManager=s.CronjobControllerStorageKey=void 0;var r,n=(r=e("webextension-polyfill"))&&r.__esModule?r:{default:r};function i(e,t,s){(function(e,t){if(t.has(e))throw new TypeError("Cannot initialize the same private elements twice on an object")})(e,t),t.set(e,s)}function a(e,t){return e.get(c(e,t))}function o(e,t,s){return e.set(c(e,t),s),s}function c(e,t,s){if("function"==typeof e?e===t:e.has(t))return arguments.length<3?t:s;throw new TypeError("Private element is not present on this object")}const l=s.CronjobControllerStorageKey="temp-cronjob-storage";var u=new WeakMap,d=new WeakMap;s.CronjobControllerStorageManager=class{constructor(){i(this,u,null),i(this,d,!1)}async init(){o(u,this,(await n.default.storage.local.get(l))[l]),o(d,this,!0)}getInitialState(){if(!a(d,this))throw new Error("CronjobControllerStorageManager not yet initialized");return a(u,this)}set(e){if(!a(d,this))throw new Error("CronjobControllerStorageManager not yet initialized");n.default.storage.local.set({[l]:e}).catch(console.error)}}}}},{package:"$root$",file:"app/scripts/lib/CronjobControllerStorageManager.ts"}],[1742,{"./logging-utils":1749,"./utils/cache":1754,"@metamask/json-rpc-engine":1961},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,s){Object.defineProperty(s,"__esModule",{value:!0}),s.createBlockCacheMiddleware=void 0;const r=e("@metamask/json-rpc-engine"),n=e("./logging-utils"),i=e("./utils/cache"),a=(0,n.createModuleLogger)(n.projectLogger,"block-cache"),o=[undefined,null,"<nil>"];class c{constructor(){this.cache={}}getBlockCache(e){const t=Number.parseInt(e,16);let s=this.cache[t];if(!s){const e={};this.cache[t]=e,s=e}return s}async get(e,t){const s=this.getBlockCache(t),r=(0,i.cacheIdentifierForRequest)(e,!0);return r?s[r]:undefined}async set(e,t,s){if(!this.canCacheResult(e,s))return;const r=(0,i.cacheIdentifierForRequest)(e,!0);if(!r)return;this.getBlockCache(t)[r]=s}canCacheRequest(e){if(!(0,i.canCache)(e.method))return!1;return"pending"!==(0,i.blockTagForRequest)(e)}canCacheResult(e,t){return!o.includes(t)&&!(e.method&&["eth_getTransactionByHash","eth_getTransactionReceipt"].includes(e.method)&&(!t||!t.blockHash||"0x0000000000000000000000000000000000000000000000000000000000000000"===t.blockHash))}clearBefore(e){const t=Number.parseInt(e,16);Object.keys(this.cache).map(Number).filter(e=>e<t).forEach(e=>delete this.cache[e])}}s.createBlockCacheMiddleware=function({blockTracker:e}={}){if(!e)throw new Error("createBlockCacheMiddleware - No PollingBlockTracker specified");const t=new c,s={[i.CacheStrategy.Permanent]:t,[i.CacheStrategy.Block]:t,[i.CacheStrategy.Fork]:t,[i.CacheStrategy.Never]:undefined};return(0,r.createAsyncMiddleware)(async(r,n,o)=>{if(r.skipCache)return o();const c=(0,i.cacheTypeForMethod)(r.method),l=s[c];if(!l)return o();if(!l.canCacheRequest(r))return o();const u=(0,i.blockTagForRequest)(r),d=u&&"string"==typeof u?u:"latest";let p;if(a("blockTag = %o, req = %o",d,r),"earliest"===d)p="0x00";else if("latest"===d){a("Fetching latest block number to determine cache key");const s=await e.getLatestBlock();a("Clearing values stored under block numbers before %o",s),t.clearBefore(s),p=s}else p=d;const h=await l.get(r,p);return h===undefined?(a("No cache stored under block number %o, carrying request forward",p),await o(),a("Populating cache with",n),await l.set(r,p,n.result)):(a("Cache hit, reusing cache result stored under block number %o",p),n.result=h),undefined})}}}},{package:"@metamask/eth-json-rpc-middleware",file:"node_modules/@metamask/eth-json-rpc-middleware/dist/block-cache.js"}],[1743,{"./utils/cache":1754,"@metamask/json-rpc-engine":1961},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,s){Object.defineProperty(s,"__esModule",{value:!0}),s.createBlockRefRewriteMiddleware=void 0;const r=e("@metamask/json-rpc-engine"),n=e("./utils/cache");s.createBlockRefRewriteMiddleware=function({blockTracker:e}={}){if(!e)throw Error('BlockRefRewriteMiddleware - mandatory "blockTracker" option is missing.');return(0,r.createAsyncMiddleware)(async(t,s,r)=>{const i=(0,n.blockTagParamIndex)(t.method);if(i===undefined)return r();if("latest"!==(Array.isArray(t.params)&&t.params[i]?t.params[i]:"latest"))return r();const a=await e.getLatestBlock();return Array.isArray(t.params)&&(t.params[i]=a),r()})}}}},{package:"@metamask/eth-json-rpc-middleware",file:"node_modules/@metamask/eth-json-rpc-middleware/dist/block-ref-rewrite.js"}],[1744,{"./logging-utils":1749,"./utils/cache":1754,"@metamask/json-rpc-engine":1961,"klona/full":4417},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,s){Object.defineProperty(s,"__esModule",{value:!0}),s.createBlockRefMiddleware=void 0;const r=e("@metamask/json-rpc-engine"),n=e("klona/full"),i=e("./logging-utils"),a=e("./utils/cache"),o=(0,i.createModuleLogger)(i.projectLogger,"block-ref");s.createBlockRefMiddleware=function({provider:e,blockTracker:t}={}){if(!e)throw Error('BlockRefMiddleware - mandatory "provider" option is missing.');if(!t)throw Error('BlockRefMiddleware - mandatory "blockTracker" option is missing.');return(0,r.createAsyncMiddleware)(async(s,r,i)=>{var c;const l=(0,a.blockTagParamIndex)(s.method);if(l===undefined)return i();if("latest"!==(Array.isArray(s.params)&&null!==(c=s.params[l])&&void 0!==c?c:"latest"))return o('blockRef is not "latest", carrying request forward'),i();const u=await t.getLatestBlock();o(`blockRef is "latest", setting param ${l} to latest block ${u}`);const d=(0,n.klona)(s);return Array.isArray(d.params)&&(d.params[l]=u),o("Performing another request %o",d),r.result=await e.request(d),undefined})}}}},{package:"@metamask/eth-json-rpc-middleware",file:"node_modules/@metamask/eth-json-rpc-middleware/dist/block-ref.js"}],[1745,{"./logging-utils":1749,"@metamask/json-rpc-engine":1961},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,s){Object.defineProperty(s,"__esModule",{value:!0}),s.createBlockTrackerInspectorMiddleware=void 0;const r=e("@metamask/json-rpc-engine"),n=e("./logging-utils"),i=(0,n.createModuleLogger)(n.projectLogger,"block-tracker-inspector"),a=["eth_getTransactionByHash","eth_getTransactionReceipt"];function o(e){const{result:t}=e;return t&&"object"==typeof t&&(s=t,r="blockNumber",Object.hasOwnProperty.call(s,r))&&"string"==typeof t.blockNumber?t.blockNumber:undefined;var s,r}s.createBlockTrackerInspectorMiddleware=function({blockTracker:e}){return(0,r.createAsyncMiddleware)(async(t,s,r)=>{if(!a.includes(t.method))return r();await r();const n=o(s);if(!n)return undefined;i("res.result.blockNumber exists, proceeding. res = %o",s);return Number.parseInt(n,16)>Number.parseInt(e.getCurrentBlock(),16)&&(i("blockNumber from response is greater than current block number, refreshing current block number"),await e.checkForLatestBlock()),undefined})}}}},{package:"@metamask/eth-json-rpc-middleware",file:"node_modules/@metamask/eth-json-rpc-middleware/dist/block-tracker-inspector.js"}],[1746,{"@metamask/json-rpc-engine":1961,"@metamask/rpc-errors":2421},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,s){Object.defineProperty(s,"__esModule",{value:!0}),s.createFetchMiddleware=void 0;const r=e("@metamask/json-rpc-engine"),n=e("@metamask/rpc-errors");s.createFetchMiddleware=function({rpcService:e,options:t={}}){return(0,r.createAsyncMiddleware)(async(s,r)=>{const i="originHttpHeaderKey"in t&&t.originHttpHeaderKey!==undefined&&s.origin!==undefined?{[t.originHttpHeaderKey]:s.origin}:{},a=await e.request({id:s.id,jsonrpc:s.jsonrpc,method:s.method,params:s.params},{headers:i});if("error"in a)throw n.rpcErrors.internal({data:a.error});r.result=a.result})}}}},{package:"@metamask/eth-json-rpc-middleware",file:"node_modules/@metamask/eth-json-rpc-middleware/dist/fetch.js"}],[1747,{"./block-cache":1742,"./block-ref":1744,"./block-ref-rewrite":1743,"./block-tracker-inspector":1745,"./fetch":1746,"./inflight-cache":1748,"./providerAsMiddleware":1752,"./retryOnEmpty":1753,"./wallet":1760},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,s){var r=this&&this.__createBinding||(Object.create?function(e,t,s,r){r===undefined&&(r=s);var n=Object.getOwnPropertyDescriptor(t,s);n&&!("get"in n?!t.__esModule:n.writable||n.configurable)||(n={enumerable:!0,get:function(){return t[s]}}),Object.defineProperty(e,r,n)}:function(e,t,s,r){r===undefined&&(r=s),e[r]=t[s]}),n=this&&this.__exportStar||function(e,t){for(var s in e)"default"===s||Object.prototype.hasOwnProperty.call(t,s)||r(t,e,s)};Object.defineProperty(s,"__esModule",{value:!0}),s.createFetchMiddleware=void 0,n(e("./block-cache"),s),n(e("./block-ref-rewrite"),s),n(e("./block-ref"),s),n(e("./block-tracker-inspector"),s);var i=e("./fetch");Object.defineProperty(s,"createFetchMiddleware",{enumerable:!0,get:function(){return i.createFetchMiddleware}}),n(e("./inflight-cache"),s),n(e("./providerAsMiddleware"),s),n(e("./retryOnEmpty"),s),n(e("./wallet"),s)}}},{package:"@metamask/eth-json-rpc-middleware",file:"node_modules/@metamask/eth-json-rpc-middleware/dist/index.js"}],[1748,{"./logging-utils":1749,"./utils/cache":1754,"@metamask/json-rpc-engine":1961,"klona/full":4417},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,s){Object.defineProperty(s,"__esModule",{value:!0}),s.createInflightCacheMiddleware=void 0;const r=e("@metamask/json-rpc-engine"),n=e("klona/full"),i=e("./logging-utils"),a=e("./utils/cache"),o=(0,i.createModuleLogger)(i.projectLogger,"inflight-cache");s.createInflightCacheMiddleware=function(){const e={};return(0,r.createAsyncMiddleware)(async(t,s,r)=>{if(t.skipCache)return r();const i=(0,a.cacheIdentifierForRequest)(t);if(!i)return o("Request is not cacheable, proceeding. req = %o",t),r();let c=e[i];return c?(o("Running %i handler(s) for request %o",c.length,t),await async function(e,t){const{resolve:s,promise:r}=function(){let e;const t=new Promise(t=>{e=t});return{resolve:e,promise:t}}();return t.push(t=>{e.result=(0,n.klona)(t.result),e.error=(0,n.klona)(t.error),s()}),r}(s,c),undefined):(c=[],e[i]=c,o("Carrying original request forward %o",t),await r(),delete e[i],o("Running %i collected handler(s) for request %o",c.length,t),function(e,t){setTimeout(()=>{t.forEach(t=>{try{t(e)}catch(e){console.error(e)}})})}(s,c),undefined)})}}}},{package:"@metamask/eth-json-rpc-middleware",file:"node_modules/@metamask/eth-json-rpc-middleware/dist/inflight-cache.js"}],[1749,{"@metamask/utils":2835},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,s){Object.defineProperty(s,"__esModule",{value:!0}),s.createModuleLogger=s.projectLogger=void 0;const r=e("@metamask/utils");Object.defineProperty(s,"createModuleLogger",{enumerable:!0,get:function(){return r.createModuleLogger}}),s.projectLogger=(0,r.createProjectLogger)("eth-json-rpc-middleware")}}},{package:"@metamask/eth-json-rpc-middleware",file:"node_modules/@metamask/eth-json-rpc-middleware/dist/logging-utils.js"}],[175,{"./state-utils":251,"@metamask/utils":2835,uuid:5398},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,s){Object.defineProperty(s,"__esModule",{value:!0}),s.PatchStore=void 0;var r=e("@metamask/utils"),n=e("uuid"),i=e("./state-utils");function a(e,t,s){return(t=function(e){var t=function(e,t){if("object"!=typeof e||!e)return e;var s=e[Symbol.toPrimitive];if(void 0!==s){var r=s.call(e,t||"default");if("object"!=typeof r)return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==typeof t?t:t+""}(t))in e?Object.defineProperty(e,t,{value:s,enumerable:!0,configurable:!0,writable:!0}):e[t]=s,e}const o=(0,r.createProjectLogger)("patch-store");s.PatchStore=class{constructor(e){a(this,"id",void 0),a(this,"observableStore",void 0),a(this,"pendingPatches",new Map),a(this,"listener",void 0),this.id=(0,n.v4)(),this.observableStore=e,this.listener=this._onStateChange.bind(this),this.observableStore.on("stateChange",this.listener),o("Created",this.id)}flushPendingPatches(){const e=[...this.pendingPatches.values()];this.pendingPatches.clear();for(const t of e)o("Flushed",t.path.join("."),this.id,t);return e}destroy(){this.observableStore.removeListener("stateChange",this.listener),o("Destroyed",this.id)}_onStateChange({oldState:e,newState:t}){const s=(0,i.sanitizeUIState)(t),r=this._generatePatches(e,s),n=Boolean(t.vault);if(n&&r.push({op:"replace",path:["isInitialized"],value:n}),r.length)for(const e of r){const t=e.path.join(".");this.pendingPatches.set(t,e),o("Updated",t,this.id,e)}}_generatePatches(e,t){return Object.keys(t).map(s=>{const r=e[s],n=t[s];return r===n?null:{op:"replace",path:[s],value:n}}).filter(Boolean)}}}}},{package:"$root$",file:"app/scripts/lib/PatchStore.ts"}],[1750,{"../utils/validation":1759,"@metamask/rpc-errors":2421,"@metamask/superstruct":2741,"@metamask/utils":2835},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,s){Object.defineProperty(s,"__esModule",{value:!0}),s.walletRequestExecutionPermissions=s.RequestExecutionPermissionsStruct=void 0;const r=e("@metamask/rpc-errors"),n=e("@metamask/superstruct"),i=e("@metamask/utils"),a=e("../utils/validation"),o=(0,n.object)({type:(0,n.string)(),isAdjustmentAllowed:(0,n.boolean)(),data:(0,n.record)((0,n.string)(),(0,n.unknown)())}),c=(0,n.object)({type:(0,n.string)(),isAdjustmentAllowed:(0,n.boolean)(),data:(0,n.record)((0,n.string)(),(0,n.unknown)())}),l=(0,n.object)({type:(0,n.literal)("account"),data:(0,n.object)({address:i.HexChecksumAddressStruct})}),u=(0,n.object)({chainId:i.StrictHexStruct,address:(0,n.optional)(i.HexChecksumAddressStruct),signer:l,permission:o,rules:(0,n.optional)((0,n.union)([(0,n.array)(c),(0,n.literal)(null)]))});s.RequestExecutionPermissionsStruct=(0,n.array)(u),s.walletRequestExecutionPermissions=async function(e,t,{processRequestExecutionPermissions:n}){if(!n)throw r.rpcErrors.methodNotSupported("wallet_requestExecutionPermissions - no middleware configured");const{params:i}=e;(0,a.validateParams)(i,s.RequestExecutionPermissionsStruct),t.result=await n(i,e)}}}},{package:"@metamask/eth-json-rpc-middleware",file:"node_modules/@metamask/eth-json-rpc-middleware/dist/methods/wallet-request-execution-permissions.js"}],[1751,{"../utils/validation":1759,"@metamask/rpc-errors":2421,"@metamask/utils":2835},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,s){Object.defineProperty(s,"__esModule",{value:!0}),s.walletRevokeExecutionPermission=s.RevokeExecutionPermissionRequestParamsStruct=s.RevokeExecutionPermissionResultStruct=void 0;const r=e("@metamask/rpc-errors"),n=e("@metamask/utils"),i=e("../utils/validation");s.RevokeExecutionPermissionResultStruct=(0,n.object)({}),s.RevokeExecutionPermissionRequestParamsStruct=(0,n.object)({permissionContext:n.StrictHexStruct}),s.walletRevokeExecutionPermission=async function(e,t,{processRevokeExecutionPermission:n}){if(!n)throw r.rpcErrors.methodNotSupported("wallet_revokeExecutionPermission - no middleware configured");const{params:a}=e;(0,i.validateParams)(a,s.RevokeExecutionPermissionRequestParamsStruct),t.result=await n(a,e)}}}},{package:"@metamask/eth-json-rpc-middleware",file:"node_modules/@metamask/eth-json-rpc-middleware/dist/methods/wallet-revoke-execution-permission.js"}],[1752,{"@metamask/json-rpc-engine":1961},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,s){Object.defineProperty(s,"__esModule",{value:!0}),s.ethersProviderAsMiddleware=s.providerAsMiddleware=void 0;const r=e("@metamask/json-rpc-engine");s.providerAsMiddleware=function(e){return(0,r.createAsyncMiddleware)(async(t,s)=>{s.result=await e.request(t)})},s.ethersProviderAsMiddleware=function(e){return(t,s,r,n)=>{e.send(t,(e,t)=>e?n(e):(Object.assign(s,t),n()))}}}}},{package:"@metamask/eth-json-rpc-middleware",file:"node_modules/@metamask/eth-json-rpc-middleware/dist/providerAsMiddleware.js"}],[1753,{"./logging-utils":1749,"./utils/cache":1754,"./utils/error":1756,"./utils/timeout":1758,"@metamask/json-rpc-engine":1961,"klona/full":4417},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,s){Object.defineProperty(s,"__esModule",{value:!0}),s.createRetryOnEmptyMiddleware=void 0;const r=e("@metamask/json-rpc-engine"),n=e("klona/full"),i=e("./logging-utils"),a=e("./utils/cache"),o=e("./utils/error"),c=e("./utils/timeout"),l=(0,i.createModuleLogger)(i.projectLogger,"retry-on-empty"),u=[undefined,null,"<nil>"];s.createRetryOnEmptyMiddleware=function({provider:e,blockTracker:t}={}){if(!e)throw Error('RetryOnEmptyMiddleware - mandatory "provider" option is missing.');if(!t)throw Error('RetryOnEmptyMiddleware - mandatory "blockTracker" option is missing.');return(0,r.createAsyncMiddleware)(async(s,r,i)=>{const d=(0,a.blockTagParamIndex)(s.method);if(d===undefined)return i();let p=Array.isArray(s.params)&&s.params[d]?s.params[d]:undefined;if(p===undefined&&(p="latest"),["latest","pending"].includes(p))return i();const h=Number.parseInt(p.slice(2),16);if(Number.isNaN(h))return i();const m=await t.getLatestBlock(),g=Number.parseInt(m.slice(2),16);if(h>g)return l("Requested block number %o is higher than latest block number %o, falling through to original request",h,g),i();l("Requested block number %o is not higher than latest block number %o, trying request until non-empty response is received",h,g);const f=(0,n.klona)(s),y=await async function(e,t){for(let s=0;s<e;s++)try{return await t()}catch(e){if((0,o.isExecutionRevertedError)(e))throw e;l("(call %i) Request failed, waiting 1s to retry again...",s+1),await(0,c.timeout)(1e3)}throw l("Retries exhausted"),new Error("RetryOnEmptyMiddleware - retries exhausted")}(10,async()=>{l("Performing request %o",f);const t=await e.request(f);l("Result is %o",t);if(u.includes(t))throw new Error(`RetryOnEmptyMiddleware - empty result "${JSON.stringify(t)}" for request "${JSON.stringify(f)}"`);return t});return l("Copying result %o",y),r.result=y,undefined})}}}},{package:"@metamask/eth-json-rpc-middleware",file:"node_modules/@metamask/eth-json-rpc-middleware/dist/retryOnEmpty.js"}],[1754,{"safe-stable-stringify":5251},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,s){Object.defineProperty(s,"__esModule",{value:!0}),s.cacheTypeForMethod=s.blockTagParamIndex=s.blockTagForRequest=s.canCache=s.cacheIdentifierForRequest=s.CacheStrategy=void 0;const r=(0,e("safe-stable-stringify").configure)({bigint:!1,circularValue:Error});var n;function i(e){return o(e)!==n.Never}function a(e){switch(e){case"eth_getStorageAt":return 2;case"eth_getBalance":case"eth_getCode":case"eth_getTransactionCount":case"eth_call":return 1;case"eth_getBlockByNumber":return 0;default:return undefined}}function o(e){switch(e){case"web3_clientVersion":case"web3_sha3":case"eth_protocolVersion":case"eth_getBlockTransactionCountByHash":case"eth_getUncleCountByBlockHash":case"eth_getCode":case"eth_getBlockByHash":case"eth_getTransactionByHash":case"eth_getTransactionByBlockHashAndIndex":case"eth_getTransactionReceipt":case"eth_getUncleByBlockHashAndIndex":case"eth_getCompilers":case"eth_compileLLL":case"eth_compileSolidity":case"eth_compileSerpent":case"shh_version":case"test_permaCache":return n.Permanent;case"eth_getBlockByNumber":case"eth_getBlockTransactionCountByNumber":case"eth_getUncleCountByBlockNumber":case"eth_getTransactionByBlockNumberAndIndex":case"eth_getUncleByBlockNumberAndIndex":case"test_forkCache":return n.Fork;case"eth_gasPrice":case"eth_blockNumber":case"eth_getBalance":case"eth_getStorageAt":case"eth_getTransactionCount":case"eth_call":case"eth_estimateGas":case"eth_getFilterLogs":case"eth_getLogs":case"test_blockCache":return n.Block;default:return n.Never}}!function(e){e.Block="block",e.Fork="fork",e.Never="never",e.Permanent="perma"}(n=s.CacheStrategy||(s.CacheStrategy={})),s.cacheIdentifierForRequest=function(e,t){var s;const n=t?function(e){if(!e.params)return[];const t=a(e.method);if(t===undefined||!Array.isArray(e.params)||t>=e.params.length)return e.params;if("eth_getBlockByNumber"===e.method)return e.params.slice(1);return e.params.slice(0,t)}(e):null!==(s=e.params)&&void 0!==s?s:[];return i(e.method)?`${e.method}:${r(n)}`:null},s.canCache=i,s.blockTagForRequest=function(e){if(!e.params)return undefined;const t=a(e.method);return t===undefined||!Array.isArray(e.params)||t>=e.params.length?undefined:e.params[t]},s.blockTagParamIndex=a,s.cacheTypeForMethod=o}}},{package:"@metamask/eth-json-rpc-middleware",file:"node_modules/@metamask/eth-json-rpc-middleware/dist/utils/cache.js"}],[1755,{},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,s){Object.defineProperty(s,"__esModule",{value:!0}),s.stripArrayTypeIfPresent=void 0;s.stripArrayTypeIfPresent=e=>(null==e?void 0:e.match(/\S\[\d*\]$/u))?e.replace(/\[\d*\]$/gu,"").trim():e}}},{package:"@metamask/eth-json-rpc-middleware",file:"node_modules/@metamask/eth-json-rpc-middleware/dist/utils/common.js"}],[1756,{"@metamask/rpc-errors":2421,"@metamask/utils":2835},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,s){Object.defineProperty(s,"__esModule",{value:!0}),s.isExecutionRevertedError=void 0;const r=e("@metamask/rpc-errors"),n=e("@metamask/utils");s.isExecutionRevertedError=function(e){return(0,n.isJsonRpcError)(e)&&e.code===r.errorCodes.rpc.invalidInput&&"execution reverted"===e.message}}}},{package:"@metamask/eth-json-rpc-middleware",file:"node_modules/@metamask/eth-json-rpc-middleware/dist/utils/error.js"}],[1757,{},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,s){function r(e){return"string"!=typeof e?e:JSON.parse(e)}Object.defineProperty(s,"__esModule",{value:!0}),s.parseTypedMessage=s.normalizeTypedMessage=void 0,s.normalizeTypedMessage=function(e){var t;let s;try{s=r(e)}catch(t){return e}const{verifyingContract:n}=null!==(t=s.domain)&&void 0!==t?t:{};return n?(s.domain.verifyingContract=function(e){if(e.startsWith("0X"))return`0x${e.slice(2)}`;return e}(n),JSON.stringify(s)):e},s.parseTypedMessage=r}}},{package:"@metamask/eth-json-rpc-middleware",file:"node_modules/@metamask/eth-json-rpc-middleware/dist/utils/normalize.js"}],[1758,{},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,s){Object.defineProperty(s,"__esModule",{value:!0}),s.timeout=void 0,s.timeout=async function(e){return new Promise(t=>setTimeout(t,e))}}}},{package:"@metamask/eth-json-rpc-middleware",file:"node_modules/@metamask/eth-json-rpc-middleware/dist/utils/timeout.js"}],[1759,{"@metamask/rpc-errors":2421,"@metamask/superstruct":2741},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,s){Object.defineProperty(s,"__esModule",{value:!0}),s.resemblesAddress=s.validateParams=s.validateAndNormalizeKeyholder=void 0;const r=e("@metamask/rpc-errors"),n=e("@metamask/superstruct");function i(e){return 42===e.length}s.validateAndNormalizeKeyholder=async function(e,t,{getAccounts:s}){if("string"==typeof e&&e.length>0&&i(e)){const n=(await s(t)).map(e=>e.toLowerCase()),i=e.toLowerCase();if(n.includes(i))return i;throw r.providerErrors.unauthorized()}throw r.rpcErrors.invalidParams({message:"Invalid parameters: must provide an Ethereum address."})},s.validateParams=function(e,t){const[s]=(0,n.validate)(e,t);if(s)throw r.rpcErrors.invalidParams(function(e,t){return`${t}\n\n${e.failures().map(e=>`${e.path.join(" > ")}${e.path.length?" - ":""}${e.message}`).join("\n")}`}(s,"Invalid params"))},s.resemblesAddress=i}}},{package:"@metamask/eth-json-rpc-middleware",file:"node_modules/@metamask/eth-json-rpc-middleware/dist/utils/validation.js"}],[176,{"@metamask/name-controller":2199,"@metamask/snaps-rpc-methods":2543,"@metamask/snaps-utils":2713,loglevel:4573},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,s){Object.defineProperty(s,"__esModule",{value:!0}),s.SnapsNameProvider=void 0;var r,n=e("@metamask/name-controller"),i=e("@metamask/snaps-utils"),a=(r=e("loglevel"))&&r.__esModule?r:{default:r},o=e("@metamask/snaps-rpc-methods");function c(e,t){if(t.has(e))throw new TypeError("Cannot initialize the same private elements twice on an object")}function l(e,t,s){return(t=function(e){var t=function(e,t){if("object"!=typeof e||!e)return e;var s=e[Symbol.toPrimitive];if(void 0!==s){var r=s.call(e,t||"default");if("object"!=typeof r)return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==typeof t?t:t+""}(t))in e?Object.defineProperty(e,t,{value:s,enumerable:!0,configurable:!0,writable:!0}):e[t]=s,e}function u(e,t){return e.get(d(e,t))}function d(e,t,s){if("function"==typeof e?e===t:e.has(t))return arguments.length<3?t:s;throw new TypeError("Private element is not present on this object")}var p=new WeakMap,h=new WeakSet;function m(e){const t=u(p,this).call("PermissionController:getState").subjects;return u(p,this).call("SnapController:getAll").filter(({id:s})=>{var r;const n=null===(r=t[s])||void 0===r?void 0:r.permissions["endowment:name-lookup"];if(!n)return!1;const i=(0,o.getChainIdsCaveat)(n);return!(e&&i&&!i.includes(e))})}async function g(e,t,s){const r=e,n={chainId:t,address:s};let o,c;try{const t=await u(p,this).call("SnapController:handleRequest",{snapId:e,origin:"metamask",handler:i.HandlerType.OnNameLookup,request:{jsonrpc:"2.0",method:" ",params:n}}),s=null==t?void 0:t.resolvedDomains;o=s?[...new Set(s.map(e=>e.resolvedDomain))]:[]}catch(t){a.default.error("Snap name provider request failed",{snapId:e,request:n,error:t}),c=t}return{sourceId:r,result:{proposedNames:o,error:c}}}s.SnapsNameProvider=class{constructor({messenger:e}){var t,s,r;!function(e,t){c(e,t),t.add(e)}(this,h),l(this,"name","SnapsNameProvider"),l(this,"state",null),function(e,t,s){c(e,t),t.set(e,s)}(this,p,void 0),s=this,r=e,(t=p).set(d(t,s),r)}getMetadata(){const e=d(h,this,m).call(this);return{sourceIds:{[n.NameType.ETHEREUM_ADDRESS]:e.map(e=>e.id)},sourceLabels:e.reduce((e,t)=>{const s=u(p,this).call("SnapController:get",t.id),r=null==s?void 0:s.manifest.proposedName;return{...e,[t.id]:r||t.id}},{})}}async getProposedNames(e){const{variation:t,value:s}=e,r=`eip155:${parseInt(t,16)}`,n=d(h,this,m).call(this,r);return{results:(await Promise.all(n.map(e=>d(h,this,g).call(this,e.id,r,s)))).reduce((e,t)=>{const{sourceId:s,result:r}=t;return{...e,[s]:r}},{})}}}}}},{package:"$root$",file:"app/scripts/lib/SnapsNameProvider.ts"}],[1760,{"./methods/wallet-request-execution-permissions":1750,"./methods/wallet-revoke-execution-permission":1751,"./utils/common":1755,"./utils/normalize":1757,"./utils/validation":1759,"@metamask/eth-sig-util":1856,"@metamask/json-rpc-engine":1961,"@metamask/rpc-errors":2421,"@metamask/utils":2835},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,s){var r=this&&this.__createBinding||(Object.create?function(e,t,s,r){r===undefined&&(r=s);var n=Object.getOwnPropertyDescriptor(t,s);n&&!("get"in n?!t.__esModule:n.writable||n.configurable)||(n={enumerable:!0,get:function(){return t[s]}}),Object.defineProperty(e,r,n)}:function(e,t,s,r){r===undefined&&(r=s),e[r]=t[s]}),n=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),i=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var s in e)"default"!==s&&Object.prototype.hasOwnProperty.call(e,s)&&r(t,e,s);return n(t,e),t};Object.defineProperty(s,"__esModule",{value:!0}),s.createWalletMiddleware=void 0;const a=i(e("@metamask/eth-sig-util")),o=e("@metamask/json-rpc-engine"),c=e("@metamask/rpc-errors"),l=e("@metamask/utils"),u=e("./methods/wallet-request-execution-permissions"),d=e("./methods/wallet-revoke-execution-permission"),p=e("./utils/common"),h=e("./utils/normalize"),m=e("./utils/validation");function g(e){const{primaryType:t,types:s}=(0,h.parseTypedMessage)(e);if(!s)throw c.rpcErrors.invalidInput();if(!s[(0,p.stripArrayTypeIfPresent)(t)])throw c.rpcErrors.invalidInput()}function f(e){const{domain:{verifyingContract:t}={}}=(0,h.parseTypedMessage)(e);if(t&&"cosmos"!==t&&!(0,l.isValidHexAddress)(t))throw c.rpcErrors.invalidInput()}s.createWalletMiddleware=function({getAccounts:e,processDecryptMessage:t,processEncryptionPublicKey:s,processPersonalMessage:r,processTransaction:n,processSignTransaction:i,processTypedMessage:l,processTypedMessageV3:p,processTypedMessageV4:y,processRequestExecutionPermissions:w,processRevokeExecutionPermission:v}){if(!e)throw new Error("opts.getAccounts is required");return(0,o.createScaffoldMiddleware)({eth_accounts:(0,o.createAsyncMiddleware)(async function(t,s){s.result=await e(t)}),eth_coinbase:(0,o.createAsyncMiddleware)(async function(t,s){const r=await e(t);s.result=r[0]||null}),eth_sendTransaction:(0,o.createAsyncMiddleware)(async function(e,t){if(!n)throw c.rpcErrors.methodNotSupported();if(!(e.params&&Array.isArray(e.params)&&e.params.length>=1))throw c.rpcErrors.invalidInput();const s=e.params[0],r=Object.assign(Object.assign({},s),{from:await b((null==s?void 0:s.from)||"",e)});t.result=await n(r,e)}),eth_signTransaction:(0,o.createAsyncMiddleware)(async function(e,t){if(!i)throw c.rpcErrors.methodNotSupported();if(!(e.params&&Array.isArray(e.params)&&e.params.length>=1))throw c.rpcErrors.invalidInput();const s=e.params[0],r=Object.assign(Object.assign({},s),{from:await b((null==s?void 0:s.from)||"",e)});t.result=await i(r,e)}),eth_signTypedData:(0,o.createAsyncMiddleware)(async function(e,t){if(!l)throw c.rpcErrors.methodNotSupported();if(!((null==e?void 0:e.params)&&Array.isArray(e.params)&&e.params.length>=2))throw c.rpcErrors.invalidInput();const s=e.params,r=s[0],n=await b(s[1],e),i=s[2]||{},a=Object.assign(Object.assign({},i),{from:n,data:r,signatureMethod:"eth_signTypedData",version:"V1"});t.result=await l(a,e,"V1")}),eth_signTypedData_v3:(0,o.createAsyncMiddleware)(async function(e,t){if(!p)throw c.rpcErrors.methodNotSupported();if(!((null==e?void 0:e.params)&&Array.isArray(e.params)&&e.params.length>=2))throw c.rpcErrors.invalidInput();const s=e.params,r=await b(s[0],e),n=(0,h.normalizeTypedMessage)(s[1]);g(n),f(n);const i={data:n,from:r,version:"V3",signatureMethod:"eth_signTypedData_v3"};t.result=await p(i,e,"V3")}),eth_signTypedData_v4:(0,o.createAsyncMiddleware)(async function(e,t){if(!y)throw c.rpcErrors.methodNotSupported();if(!((null==e?void 0:e.params)&&Array.isArray(e.params)&&e.params.length>=2))throw c.rpcErrors.invalidInput();const s=e.params,r=await b(s[0],e),n=(0,h.normalizeTypedMessage)(s[1]);g(n),f(n);const i={data:n,from:r,version:"V4",signatureMethod:"eth_signTypedData_v4"};t.result=await y(i,e,"V4")}),personal_sign:(0,o.createAsyncMiddleware)(async function(e,t){if(!r)throw c.rpcErrors.methodNotSupported();if(!((null==e?void 0:e.params)&&Array.isArray(e.params)&&e.params.length>=2))throw c.rpcErrors.invalidInput();const s=e.params,n=s[0],i=s[1],a=s[2]||{};let o,l;if((0,m.resemblesAddress)(n)&&!(0,m.resemblesAddress)(i)){let e="The eth_personalSign method requires params ordered ";e+="[message, address]. This was previously handled incorrectly, ",e+="and has been corrected automatically. ",e+="Please switch this param order for smooth behavior in the future.",t.warning=e,o=n,l=i}else l=n,o=i;o=await b(o,e);const u=Object.assign(Object.assign({},a),{from:o,data:l,signatureMethod:"personal_sign"});t.result=await r(u,e)}),eth_getEncryptionPublicKey:(0,o.createAsyncMiddleware)(async function(e,t){if(!s)throw c.rpcErrors.methodNotSupported();if(!((null==e?void 0:e.params)&&Array.isArray(e.params)&&e.params.length>=1))throw c.rpcErrors.invalidInput();const r=e.params,n=await b(r[0],e);t.result=await s(n,e)}),eth_decrypt:(0,o.createAsyncMiddleware)(async function(e,s){if(!t)throw c.rpcErrors.methodNotSupported();if(!((null==e?void 0:e.params)&&Array.isArray(e.params)&&e.params.length>=1))throw c.rpcErrors.invalidInput();const r=e.params,n=r[0],i=await b(r[1],e),a=r[2]||{},o=Object.assign(Object.assign({},a),{from:i,data:n});s.result=await t(o,e)}),personal_ecRecover:(0,o.createAsyncMiddleware)(async function(e,t){if(!((null==e?void 0:e.params)&&Array.isArray(e.params)&&e.params.length>=2))throw c.rpcErrors.invalidInput();const s=e.params,r=s[0],n=s[1],i=a.recoverPersonalSignature({data:r,signature:n});t.result=i}),wallet_requestExecutionPermissions:(0,o.createAsyncMiddleware)(async(e,t)=>(0,u.walletRequestExecutionPermissions)(e,t,{processRequestExecutionPermissions:w})),wallet_revokeExecutionPermission:(0,o.createAsyncMiddleware)(async(e,t)=>(0,d.walletRevokeExecutionPermission)(e,t,{processRevokeExecutionPermission:v}))});async function b(t,s){return(0,m.validateAndNormalizeKeyholder)(t,s,{getAccounts:e})}}}}},{package:"@metamask/eth-json-rpc-middleware",file:"node_modules/@metamask/eth-json-rpc-middleware/dist/wallet.js"}],[1765,{"./ledger-hw-app.cjs":1767,"./ledger-iframe-bridge.cjs":1768,"./ledger-keyring.cjs":1769,"./ledger-mobile-bridge.cjs":1770,"./ledger-transport-middleware.cjs":1771},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,s){var r=this&&this.__createBinding||(Object.create?function(e,t,s,r){r===undefined&&(r=s);var n=Object.getOwnPropertyDescriptor(t,s);n&&!("get"in n?!t.__esModule:n.writable||n.configurable)||(n={enumerable:!0,get:function(){return t[s]}}),Object.defineProperty(e,r,n)}:function(e,t,s,r){r===undefined&&(r=s),e[r]=t[s]}),n=this&&this.__exportStar||function(e,t){for(var s in e)"default"===s||Object.prototype.hasOwnProperty.call(t,s)||r(t,e,s)};Object.defineProperty(s,"__esModule",{value:!0}),n(e("./ledger-keyring.cjs"),s),n(e("./ledger-iframe-bridge.cjs"),s),n(e("./ledger-mobile-bridge.cjs"),s),n(e("./ledger-transport-middleware.cjs"),s),n(e("./ledger-hw-app.cjs"),s)}}},{package:"@metamask/eth-ledger-bridge-keyring",file:"node_modules/@metamask/eth-ledger-bridge-keyring/dist/index.cjs"}],[1766,{"./type.cjs":1772,"@ledgerhq/hw-transport":860},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,s){Object.defineProperty(s,"__esModule",{value:!0}),s.handleLedgerTransportError=function(e,t){if(e instanceof r.TransportStatusError){const t=e;throw new n.LedgerStatusError(t.statusCode,function(e){switch(e.statusCode){case 27013:return"Ledger: User rejected the transaction";case 27264:return"Ledger: Blind signing must be enabled";case 21781:return"Ledger: Device is locked. Unlock it to continue";case 25871:return"Ledger: Ethereum app closed. Open it to unlock";default:return e.message}}(t))}throw e instanceof Error?e:new Error(t)};const r=e("@ledgerhq/hw-transport"),n=e("./type.cjs")}}},{package:"@metamask/eth-ledger-bridge-keyring",file:"node_modules/@metamask/eth-ledger-bridge-keyring/dist/ledger-error-handler.cjs"}],[1767,{"@ledgerhq/hw-app-eth":845,buffer:3793},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,s){var r=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(s,"__esModule",{value:!0}),s.MetaMaskLedgerHwAppEth=void 0;const n=r(e("@ledgerhq/hw-app-eth")),i=e("buffer");class a extends n.default{constructor(){super(...arguments),this.mainAppName="BOLOS",this.ethAppName="Ethereum",this.transportEncoding="ascii"}async openEthApp(){await this.transport.send(224,216,0,0,i.Buffer.from(this.ethAppName,this.transportEncoding))}async closeApps(){await this.transport.send(176,167,0,0)}async getAppNameAndVersion(){const e=await this.transport.send(176,1,0,0);if(1!==e[0])throw new Error("Incorrect format return from getAppNameAndVersion.");let t=1;const s=e[t]??0;t+=1;const r=e.slice(t,t+=s).toString(this.transportEncoding),n=e[t]??0;t+=1;return{appName:r,version:e.slice(t,t+=n).toString(this.transportEncoding)}}}s.MetaMaskLedgerHwAppEth=a}}},{package:"@metamask/eth-ledger-bridge-keyring",file:"node_modules/@metamask/eth-ledger-bridge-keyring/dist/ledger-hw-app.cjs"}],[1768,{"@metamask/utils":2835},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,s){var r,n,i,a,o,c,l,u,d,p=this&&this.__classPrivateFieldGet||function(e,t,s,r){if("a"===s&&!r)throw new TypeError("Private accessor was defined without a getter");if("function"==typeof t?e!==t||!r:!t.has(e))throw new TypeError("Cannot read private member from an object whose class did not declare it");return"m"===s?r:"a"===s?r.call(e):r?r.value:t.get(e)},h=this&&this.__classPrivateFieldSet||function(e,t,s,r,n){if("m"===r)throw new TypeError("Private method is not writable");if("a"===r&&!n)throw new TypeError("Private accessor was defined without a setter");if("function"==typeof t?e!==t||!n:!t.has(e))throw new TypeError("Cannot write private member to an object whose class did not declare it");return"a"===r?n.call(e,s):n?n.value=s:t.set(e,s),s};Object.defineProperty(s,"__esModule",{value:!0}),s.LedgerIframeBridge=s.IFrameMessageAction=void 0;const m=e("@metamask/utils");var g;!function(e){e.LedgerIsIframeReady="ledger-is-iframe-ready",e.LedgerConnectionChange="ledger-connection-change",e.LedgerUnlock="ledger-unlock",e.LedgerMakeApp="ledger-make-app",e.LedgerUpdateTransport="ledger-update-transport",e.LedgerSignTransaction="ledger-sign-transaction",e.LedgerSignPersonalMessage="ledger-sign-personal-message",e.LedgerSignTypedData="ledger-sign-typed-data"}(g||(s.IFrameMessageAction=g={}));s.LedgerIframeBridge=class{constructor(e={bridgeUrl:"https://metamask.github.io/eth-ledger-bridge-keyring"}){r.add(this),this.iframeLoaded=!1,n.set(this,void 0),this.isDeviceConnected=!1,this.currentMessageId=0,i.set(this,new Map),p(this,r,"m",d).call(this,e),h(this,n,{bridgeUrl:e?.bridgeUrl},"f")}async init(){await p(this,r,"m",o).call(this,p(this,n,"f").bridgeUrl),this.eventListener=p(this,r,"m",l).bind(this,p(this,n,"f").bridgeUrl),window.addEventListener("message",this.eventListener)}async destroy(){this.eventListener&&window.removeEventListener("message",this.eventListener)}async getOptions(){return p(this,n,"f")}async setOptions(e){p(this,r,"m",d).call(this,e),p(this,n,"f")?.bridgeUrl!==e.bridgeUrl&&(p(this,n,"f").bridgeUrl=e.bridgeUrl,await this.destroy(),await this.init())}async attemptMakeApp(){const e=await p(this,r,"m",u).call(this,{action:g.LedgerMakeApp},{timeout:8e3});if("success"in e&&e.success)return!0;throw"error"in e?e.error:new Error("Unknown error occurred")}async updateTransportMethod(e){if(!this.iframeLoaded)throw new Error("The iframe is not loaded yet");const t=await p(this,r,"m",u).call(this,{action:g.LedgerUpdateTransport,params:{transportType:e}},{timeout:8e3});if("success"in t&&t.success)return!0;throw new Error("Ledger transport could not be updated")}async getPublicKey(e){return p(this,r,"m",a).call(this,g.LedgerUnlock,e)}async deviceSignTransaction(e){return p(this,r,"m",a).call(this,g.LedgerSignTransaction,e)}async deviceSignMessage(e){return p(this,r,"m",a).call(this,g.LedgerSignPersonalMessage,e)}async deviceSignTypedData(e){return p(this,r,"m",a).call(this,g.LedgerSignTypedData,e)}},n=new WeakMap,i=new WeakMap,r=new WeakSet,a=async function(...[e,t]){const s=await p(this,r,"m",u).call(this,{action:e,params:t});if("payload"in s&&s.payload){if("success"in s&&s.success)return s.payload;if("error"in s.payload)throw s.payload.error}throw new Error("Unknown error occurred")},o=async function(e){return new Promise(t=>{this.iframe=document.createElement("iframe"),this.iframe.src=e,this.iframe.allow="hid 'src'",this.iframe.onload=async()=>{this.iframeLoaded=!0,t()},document.head.appendChild(this.iframe)})},c=function(e){const t=e.split("/");return t.splice(-1,1),t.join("/")},l=function(e,t){const{origin:s,data:n}=t;if(s===p(this,r,"m",c).call(this,e)&&n){const e=p(this,i,"f").get(n.messageId);e?(e.resolve(n),p(this,i,"f").delete(n.messageId)):n.action===g.LedgerConnectionChange&&(this.isDeviceConnected=n.payload.connected)}},u=async function(e,{timeout:t}={}){this.currentMessageId+=1;const s={...e,messageId:this.currentMessageId,target:"LEDGER-IFRAME"},r=(0,m.createDeferredPromise)();if(p(this,i,"f").set(this.currentMessageId,r),!this.iframeLoaded||!this.iframe?.contentWindow)throw new Error("The iframe is not loaded yet");return t&&setTimeout(()=>{p(this,i,"f").has(s.messageId)&&(p(this,i,"f").delete(s.messageId),r.reject(new Error("Ledger iframe message timeout")))},t),this.iframe.contentWindow.postMessage(s,"*"),r.promise},d=function(e){if("string"!=typeof e.bridgeUrl||0===e.bridgeUrl.length)throw new Error("bridgeURL is not a valid URL")}}}},{package:"@metamask/eth-ledger-bridge-keyring",file:"node_modules/@metamask/eth-ledger-bridge-keyring/dist/ledger-iframe-bridge.cjs"}],[1769,{"./ledger-error-handler.cjs":1766,"@ethereumjs/rlp":559,"@ethereumjs/tx":572,"@ethereumjs/util":586,"@metamask/eth-sig-util":1856,"@metamask/utils":2835,buffer:3793,hdkey:4340},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,s){var r,n,i,a,o,c,l,u,d,p,h,m,g,f,y=this&&this.__classPrivateFieldGet||function(e,t,s,r){if("a"===s&&!r)throw new TypeError("Private accessor was defined without a getter");if("function"==typeof t?e!==t||!r:!t.has(e))throw new TypeError("Cannot read private member from an object whose class did not declare it");return"m"===s?r:"a"===s?r.call(e):r?r.value:t.get(e)},w=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(s,"__esModule",{value:!0}),s.LedgerKeyring=void 0;const v=e("@ethereumjs/rlp"),b=e("@ethereumjs/tx"),S=e("@ethereumjs/util"),E=e("@metamask/eth-sig-util"),k=e("@metamask/utils"),T=e("buffer"),M=w(e("hdkey")),C=e("./ledger-error-handler.cjs"),I="m",A=`${I}/44'/60'/0'`,_="Ledger Hardware";var P;!function(e){e.Ropsten="https://api-ropsten.etherscan.io",e.Kovan="https://api-kovan.etherscan.io",e.Rinkeby="https://api-rinkeby.etherscan.io",e.Mainnet="https://api.etherscan.io"}(P||(P={}));class N{constructor({bridge:e}){if(r.add(this),this.deviceId="",this.type=_,this.page=0,this.perPage=5,this.unlockedAccount=0,this.accounts=[],this.accountDetails={},this.hdk=new M.default,this.hdPath=A,this.paths={},this.network=P.Mainnet,this.implementFullBIP44=!1,!e)throw new Error("Bridge is a required dependency for the keyring");this.bridge=e}async init(){return this.bridge.init()}async destroy(){return this.bridge.destroy()}async serialize(){return{hdPath:this.hdPath,accounts:this.accounts.slice(),deviceId:this.deviceId,accountDetails:this.accountDetails,implementFullBIP44:!1}}async deserialize(e){this.hdPath=e.hdPath??A,this.accounts=e.accounts??[],this.deviceId=e.deviceId??"",this.accountDetails=e.accountDetails??{},e.accountDetails||y(this,r,"m",n).call(this,e),this.implementFullBIP44=e.implementFullBIP44??!1;const t=new Set(Object.keys(this.accountDetails));return this.accounts=this.accounts.filter(e=>t.has(y(this,r,"m",f).call(this,e))),Promise.resolve()}setDeviceId(e){this.deviceId=e}getDeviceId(){return this.deviceId}isUnlocked(){return Boolean(this.hdk.publicKey)}isConnected(){return this.bridge.isDeviceConnected}setAccountToUnlock(e){this.unlockedAccount=e}setHdPath(e){this.hdPath!==e&&(this.hdk=new M.default),this.hdPath=e}async unlock(e,t=!0){if(this.isUnlocked()&&!e)return y(this,r,"m",f).call(this,(0,k.bytesToHex)((0,S.publicToAddress)(this.hdk.publicKey,!0)));const s=e?y(this,r,"m",h).call(this,e):this.hdPath;let n;try{n=await this.bridge.getPublicKey({hdPath:s})}catch(e){(0,C.handleLedgerTransportError)(e,"Ledger: Unknown error while unlocking account")}return t&&n.chainCode&&(this.hdk.publicKey=T.Buffer.from(n.publicKey,"hex"),this.hdk.chainCode=T.Buffer.from(n.chainCode,"hex")),(0,k.add0x)(n.address)}async addAccounts(e){return new Promise((t,s)=>{this.unlock().then(async s=>{const n=this.unlockedAccount,i=n+e,a=[];for(let e=n;e<i;e++){const t=y(this,r,"m",d).call(this,e);let s;s=y(this,r,"m",p).call(this)?await this.unlock(t):y(this,r,"m",l).call(this,I,e),this.accountDetails[y(this,r,"m",f).call(this,s)]={bip44:y(this,r,"m",p).call(this),hdPath:t},this.accounts.includes(s)||(this.accounts=[...this.accounts,s],a.push(s)),this.page=0}t(a)}).catch(s)})}getName(){return _}async getFirstPage(){return this.page=0,y(this,r,"m",a).call(this,1)}async getNextPage(){return y(this,r,"m",a).call(this,1)}async getPreviousPage(){return y(this,r,"m",a).call(this,-1)}async getAccounts(){return Promise.resolve(this.accounts.slice())}removeAccount(e){const t=this.accounts.filter(t=>t.toLowerCase()!==e.toLowerCase());if(t.length===this.accounts.length)throw new Error(`Address ${e} not found in this keyring`);this.accounts=t,delete this.accountDetails[y(this,r,"m",f).call(this,e)]}async attemptMakeApp(){return this.bridge.attemptMakeApp()}async updateTransportMethod(e){return this.bridge.updateTransportMethod(e)}async signTransaction(e,t){let s;if(function(e){return"getChainId"in e&&"function"==typeof e.getChainId}(t))return t.v=t.getChainId(),t.r="0x00",t.s="0x00",s=t.serialize().toString("hex"),y(this,r,"m",i).call(this,e,s,e=>(t.v=T.Buffer.from(e.v,"hex"),t.r=T.Buffer.from(e.r,"hex"),t.s=T.Buffer.from(e.s,"hex"),t));const n=t.getMessageToSign();return s=Array.isArray(n)?T.Buffer.from(v.RLP.encode(n)).toString("hex"):(0,k.bytesToHex)(n),y(this,r,"m",i).call(this,e,s,e=>{const s=t.toJSON();return s.type=t.type,s.v=(0,k.add0x)(e.v),s.r=(0,k.add0x)(e.r),s.s=(0,k.add0x)(e.s),b.TransactionFactory.fromTxData(s,{common:t.common,freeze:Object.isFrozen(t)})})}async signMessage(e,t){return this.signPersonalMessage(e,t)}async signPersonalMessage(e,t){const s=await this.unlockAccountByAddress(e);if(!s)throw new Error("Ledger: Unknown error while signing message");let n;try{n=await this.bridge.deviceSignMessage({hdPath:s,message:(0,k.remove0x)(t)})}catch(e){(0,C.handleLedgerTransportError)(e,"Ledger: Unknown error while signing message")}let i=parseInt(String(n.v),10).toString(16);i.length<2&&(i=`0${i}`);const a=`0x${n.r}${n.s}${i}`,o=(0,E.recoverPersonalSignature)({data:t,signature:a});if(y(this,r,"m",f).call(this,o)!==y(this,r,"m",f).call(this,e))throw new Error("Ledger: The signature doesnt match the right address");return a}async unlockAccountByAddress(e){const t=y(this,r,"m",f).call(this,e),s=this.accountDetails[t];if(!s)throw new Error(`Ledger: Account for address '${t}' not found`);const{hdPath:n}=s;if((await this.unlock(n,!1)).toLowerCase()!==e.toLowerCase())throw new Error(`Ledger: Account ${e} does not belong to the connected device`);return n}async signTypedData(e,t,s){const{version:n}=s??{};if(!("V4"===n))throw new Error("Ledger: Only version 4 of typed data signing is supported");const{domain:i,types:a,primaryType:o,message:c}=E.TypedDataUtils.sanitizeData(t),l=await this.unlockAccountByAddress(e);if(!l)throw new Error("Ledger: Unknown error while signing message");let u;try{u=await this.bridge.deviceSignTypedData({hdPath:l,message:{domain:{name:i.name,chainId:i.chainId,version:i.version,verifyingContract:i.verifyingContract,salt:i.salt instanceof ArrayBuffer?T.Buffer.from(i.salt).toString("hex"):i.salt},types:a,primaryType:o.toString(),message:c}})}catch(e){(0,C.handleLedgerTransportError)(e,"Ledger: Unknown error while signing message")}let d=parseInt(String(u.v),10).toString(16);d.length<2&&(d=`0${d}`);const p=`0x${u.r}${u.s}${d}`,h=(0,E.recoverTypedSignature)({data:t,signature:p,version:E.SignTypedDataVersion.V4});if(y(this,r,"m",f).call(this,h)!==y(this,r,"m",f).call(this,e))throw new Error("Ledger: The signature doesnt match the right address");return p}forgetDevice(){this.deviceId="",this.accounts=[],this.page=0,this.unlockedAccount=0,this.paths={},this.accountDetails={},this.hdk=new M.default}}s.LedgerKeyring=N,r=new WeakSet,n=function(e){if(y(this,r,"m",p).call(this)&&e.accountIndexes)for(const[t,s]of Object.entries(e.accountIndexes))this.accountDetails[t]={bip44:!0,hdPath:y(this,r,"m",d).call(this,s)};const t=new Set(Object.keys(this.accountDetails));y(this,r,"m",p).call(this)||this.accounts.forEach(e=>{const s=y(this,r,"m",f).call(this,e);t.has(s)||(this.accountDetails[s]={bip44:!1,hdPath:y(this,r,"m",u).call(this,e)})})},i=async function(e,t,s){const r=await this.unlockAccountByAddress(e);if(!r)throw new Error("Ledger: hdPath is empty while signing transaction");let n;try{n=await this.bridge.deviceSignTransaction({tx:(0,k.remove0x)(t),hdPath:r})}catch(e){(0,C.handleLedgerTransportError)(e,"Ledger: Unknown error while signing transaction")}const i=s(n);if(i.verifySignature())return i;throw new Error("Ledger: The transaction signature is not valid")},a=async function(e){this.page+=e,this.page<=0&&(this.page=1);const t=(this.page-1)*this.perPage,s=t+this.perPage;let n;return await this.unlock(),n=y(this,r,"m",p).call(this)?await y(this,r,"m",o).call(this,t,s):y(this,r,"m",c).call(this,t,s),n},o=async function(e,t){const s=[];for(let n=e;n<t;n++){const e=y(this,r,"m",d).call(this,n),t=await this.unlock(e),i=!this.implementFullBIP44||await y(this,r,"m",m).call(this,t);if(s.push({address:t,balance:null,index:n}),!i)break}return s},c=function(e,t){const s=[];for(let n=e;n<t;n++){const e=y(this,r,"m",l).call(this,I,n);s.push({address:e,balance:null,index:n}),this.paths[y(this,r,"m",f).call(this,e)]=n}return s},l=function(e,t){const s=this.hdk.derive(`${e}/${t}`),n=(0,k.bytesToHex)((0,S.publicToAddress)(s.publicKey,!0));return y(this,r,"m",f).call(this,n)},u=function(e){const t=y(this,r,"m",f).call(this,e);let s=this.paths[t];if(void 0===s)for(let e=0;e<1e3;e++)if(t===y(this,r,"m",l).call(this,I,e)){s=e;break}if(void 0===s)throw new Error("Unknown address");return y(this,r,"m",d).call(this,s)},d=function(e){return y(this,r,"m",p).call(this)?`m/44'/60'/${e}'/0/0`:`${this.hdPath}/${e}`},p=function(){return"m/44'/60'/0'/0/0"===this.hdPath},h=function(e){return e.toString().replace("m/","")},m=async function(e){const t=y(this,r,"m",g).call(this),s=await window.fetch(`${t}/api?module=account&action=txlist&address=${e}&tag=latest&page=1&offset=1`),n=await s.json();return"0"!==n.status&&n.result.length>0},g=function(){return this.network},f=function(e){return(0,k.getChecksumAddress)((0,k.add0x)(e))},N.type=_}}},{package:"@metamask/eth-ledger-bridge-keyring",file:"node_modules/@metamask/eth-ledger-bridge-keyring/dist/ledger-keyring.cjs"}],[177,{},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,s){function r(e,t,s){return(t=function(e){var t=function(e,t){if("object"!=typeof e||!e)return e;var s=e[Symbol.toPrimitive];if(void 0!==s){var r=s.call(e,t||"default");if("object"!=typeof r)return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==typeof t?t:t+""}(t))in e?Object.defineProperty(e,t,{value:s,enumerable:!0,configurable:!0,writable:!0}):e[t]=s,e}Object.defineProperty(s,"__esModule",{value:!0}),s.WeakRefObjectMap=void 0;class n{constructor(){r(this,"map",void 0),this.map=new Map}set(e,t){const s={};for(const e in t){if(!Object.prototype.hasOwnProperty.call(t,e))continue;const r=t[e];if("object"!=typeof r||null===r)throw new Error(`Property ${String(e)} is not an object and cannot be weakly referenced.`);s[e]=new WeakRef(r)}return this.map.set(e,s),this}get(e){const t=this.map.get(e);if(!t)return undefined;const s={};for(const r in t){if(!Object.prototype.hasOwnProperty.call(t,r))continue;const n=t[r].deref();if(n===undefined)return this.map.delete(e),undefined;s[r]=n}return s}has(e){return this.get(e)!==undefined}delete(e){return this.get(e)!==undefined&&this.map.delete(e)}clear(){this.map.clear()}get size(){return this.map.size}entries(){const e=[];return this.map.forEach((t,s)=>{const r=this.get(s);r!==undefined&&e.push([s,r])}),e.values()}keys(){return this.map.keys()}values(){const e=[];return this.map.forEach((t,s)=>{const r=this.get(s);r!==undefined&&e.push(r)}),e.values()}[Symbol.iterator](){return this.entries()}get[Symbol.toStringTag](){return"WeakRefObjectMap"}forEach(e,t){this.map.forEach((s,r)=>{const n=this.get(r);n!==undefined&&(t?e.call(t,n,r,this):e(n,r,this))})}}s.WeakRefObjectMap=n}}},{package:"$root$",file:"app/scripts/lib/WeakRefObjectMap.ts"}],[1770,{"./ledger-hw-app.cjs":1767},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,s){var r,n,i,a,o,c=this&&this.__classPrivateFieldSet||function(e,t,s,r,n){if("m"===r)throw new TypeError("Private method is not writable");if("a"===r&&!n)throw new TypeError("Private accessor was defined without a setter");if("function"==typeof t?e!==t||!n:!t.has(e))throw new TypeError("Cannot write private member to an object whose class did not declare it");return"a"===r?n.call(e,s):n?n.value=s:t.set(e,s),s},l=this&&this.__classPrivateFieldGet||function(e,t,s,r){if("a"===s&&!r)throw new TypeError("Private accessor was defined without a getter");if("function"==typeof t?e!==t||!r:!t.has(e))throw new TypeError("Cannot read private member from an object whose class did not declare it");return"m"===s?r:"a"===s?r.call(e):r?r.value:t.get(e)};Object.defineProperty(s,"__esModule",{value:!0}),s.LedgerMobileBridge=void 0;e("./ledger-hw-app.cjs");s.LedgerMobileBridge=class{constructor(e,t={}){r.add(this),n.set(this,void 0),i.set(this,void 0),this.isDeviceConnected=!1,c(this,i,t,"f"),c(this,n,e,"f")}async init(){return Promise.resolve()}async destroy(){try{await l(this,r,"m",a).call(this).dispose()}catch(e){console.error(e)}this.isDeviceConnected=!1}async deviceSignMessage({hdPath:e,message:t}){return l(this,r,"m",o).call(this).signPersonalMessage(e,t)}async deviceSignTypedData({hdPath:e,message:t}){return l(this,r,"m",o).call(this).signEIP712Message(e,t)}async deviceSignTransaction({tx:e,hdPath:t}){return l(this,r,"m",o).call(this).clearSignTransaction(t,e,{externalPlugins:!0,erc20:!0,nft:!0})}async getPublicKey({hdPath:e}){return await l(this,r,"m",o).call(this).getAddress(e,!1,!0)}async getOptions(){return l(this,i,"f")}async setOptions(e){c(this,i,e,"f")}async updateTransportMethod(e){if(!e.deviceModel)throw new Error("Property `deviceModel` is not defined in `transport`.");if(!e.deviceModel.id)throw new Error("Property `deviceModel.id` is not defined in `transport`.");return l(this,r,"m",a).call(this).setTransport(e),this.isDeviceConnected=!0,Promise.resolve(!0)}async attemptMakeApp(){throw new Error("Method not supported.")}async openEthApp(){await l(this,r,"m",o).call(this).openEthApp()}async closeApps(){await l(this,r,"m",o).call(this).closeApps()}async getAppNameAndVersion(){return l(this,r,"m",o).call(this).getAppNameAndVersion()}},n=new WeakMap,i=new WeakMap,r=new WeakSet,a=function(){if(l(this,n,"f"))return l(this,n,"f");throw new Error("Instance `transportMiddleware` is not initialized.")},o=function(){return l(this,r,"m",a).call(this).getEthApp()}}}},{package:"@metamask/eth-ledger-bridge-keyring",file:"node_modules/@metamask/eth-ledger-bridge-keyring/dist/ledger-mobile-bridge.cjs"}],[1771,{"./ledger-hw-app.cjs":1767},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,s){var r,n=this&&this.__classPrivateFieldSet||function(e,t,s,r,n){if("m"===r)throw new TypeError("Private method is not writable");if("a"===r&&!n)throw new TypeError("Private accessor was defined without a setter");if("function"==typeof t?e!==t||!n:!t.has(e))throw new TypeError("Cannot write private member to an object whose class did not declare it");return"a"===r?n.call(e,s):n?n.value=s:t.set(e,s),s},i=this&&this.__classPrivateFieldGet||function(e,t,s,r){if("a"===s&&!r)throw new TypeError("Private accessor was defined without a getter");if("function"==typeof t?e!==t||!r:!t.has(e))throw new TypeError("Cannot read private member from an object whose class did not declare it");return"m"===s?r:"a"===s?r.call(e):r?r.value:t.get(e)};Object.defineProperty(s,"__esModule",{value:!0}),s.LedgerTransportMiddleware=void 0;const a=e("./ledger-hw-app.cjs");s.LedgerTransportMiddleware=class{constructor(){this.mainAppName="BOLOS",this.ethAppName="Ethereum",this.transportEncoding="ascii",r.set(this,void 0)}async dispose(){const e=this.getTransport();await e.close()}setTransport(e){n(this,r,e,"f")}getTransport(){if(!i(this,r,"f"))throw new Error("Instance `transport` is not initialized.");return i(this,r,"f")}getEthApp(){return new a.MetaMaskLedgerHwAppEth(this.getTransport())}},r=new WeakMap}}},{package:"@metamask/eth-ledger-bridge-keyring",file:"node_modules/@metamask/eth-ledger-bridge-keyring/dist/ledger-transport-middleware.cjs"}],[1772,{},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,s){Object.defineProperty(s,"__esModule",{value:!0}),s.LedgerStatusError=void 0;class r extends Error{constructor(e,t){super(t),this.statusCode=e}}s.LedgerStatusError=r}}},{package:"@metamask/eth-ledger-bridge-keyring",file:"node_modules/@metamask/eth-ledger-bridge-keyring/dist/type.cjs"}],[178,{"../../../../shared/constants/app":5447,"@metamask/controller-utils":1321,"@metamask/rpc-errors":2421,"@metamask/snaps-rpc-methods":2543,"@metamask/utils":2835},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,s){Object.defineProperty(s,"__esModule",{value:!0}),s.rejectAllApprovals=function({approvalController:e,deleteInterface:t}){const s=e.state.pendingApprovals,r=Object.values(s);for(const s of r)l({approvalController:e,approvalRequest:s,deleteInterface:t})},s.rejectOriginApprovals=function({approvalController:e,deleteInterface:t,origin:s}){const r=e.state.pendingApprovals,n=Object.values(r).filter(e=>e.origin===s);for(const s of n)l({approvalController:e,approvalRequest:s,deleteInterface:t})};var r=e("@metamask/controller-utils"),n=e("@metamask/snaps-rpc-methods"),i=e("@metamask/rpc-errors"),a=e("@metamask/utils"),o=e("../../../../shared/constants/app");const c=(0,a.createProjectLogger)("approval-utils");function l({approvalController:e,approvalRequest:t,deleteInterface:s}){var a;const{id:l,type:u,origin:d}=t,p=null===(a=t.requestData)||void 0===a?void 0:a.id;switch(u){case r.ApprovalType.SnapDialogAlert:case r.ApprovalType.SnapDialogPrompt:case n.DIALOG_APPROVAL_TYPES.default:c("Rejecting snap dialog",{id:l,interfaceId:p,origin:d,type:u}),e.accept(l,null),null==s||s(p);break;case r.ApprovalType.SnapDialogConfirmation:c("Rejecting snap confirmation",{id:l,interfaceId:p,origin:d,type:u}),e.accept(l,!1),null==s||s(p);break;case o.SNAP_MANAGE_ACCOUNTS_CONFIRMATION_TYPES.confirmAccountCreation:case o.SNAP_MANAGE_ACCOUNTS_CONFIRMATION_TYPES.confirmAccountRemoval:case o.SNAP_MANAGE_ACCOUNTS_CONFIRMATION_TYPES.showSnapAccountRedirect:c("Rejecting snap account confirmation",{id:l,origin:d,type:u}),e.accept(l,!1);break;default:c("Rejecting pending approval",{id:l,origin:d,type:u}),e.reject(l,i.providerErrors.userRejectedRequest({data:{cause:"rejectAllApprovals"}}))}}}}},{package:"$root$",file:"app/scripts/lib/approval/utils.ts"}],[179,{"../../../shared/modules/string-utils":5579},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,s){Object.defineProperty(s,"__esModule",{value:!0}),s.default=void 0;var r=e("../../../shared/modules/string-utils");s.default=class{constructor(e={}){const{preferencesController:t,addressBookController:s,accountsController:r,networkController:n,trackMetaMetricsEvent:i}=e;this.preferencesController=t,this.accountsController=r,this.addressBookController=s,this.networkController=n,this._trackMetaMetricsEvent=i}async restoreUserData(e){const t=this.preferencesController.state,{preferences:s,addressBook:r,network:n,internalAccounts:i}=JSON.parse(e);s&&(s.identities=t.identities,s.lostIdentities=t.lostIdentities,s.selectedAddress=t.selectedAddress,this.preferencesController.update(s)),r&&this.addressBookController.update(r,!0),n&&this.networkController.loadBackup(n),i&&this.accountsController.loadBackup(i),(s||r||n||i)&&this._trackMetaMetricsEvent({event:"User Data Imported",category:"Backup"})}async backupUserData(){const e={preferences:{...this.preferencesController.state},internalAccounts:{internalAccounts:this.accountsController.state.internalAccounts},addressBook:{...this.addressBookController.state},network:{networkConfigurationsByChainId:this.networkController.state.networkConfigurationsByChainId}};delete e.preferences.identities,delete e.preferences.lostIdentities,delete e.preferences.selectedAddress;const t=JSON.stringify(e),s=new Date,n=e=>(0,r.prependZero)(e,2);return{fileName:`MetaMaskUserData.${s.getFullYear()}_${n(s.getMonth()+1)}_${n(s.getDay())}_${n(s.getHours())}_${n(s.getMinutes())}_${n(s.getDay())}.json`,data:t}}}}}},{package:"$root$",file:"app/scripts/lib/backup.js"}],[18,{"../../lib/util":276,"@metamask/assets-controllers":1138},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,s){Object.defineProperty(s,"__esModule",{value:!0}),s.TokenRatesControllerInit=void 0;var r=e("@metamask/assets-controllers"),n=e("../../lib/util");s.TokenRatesControllerInit=e=>{const{controllerMessenger:t,initMessenger:s,persistedState:i}=e,a=s.call("PreferencesController:getState"),o=new r.TokenRatesController({messenger:t,state:i.TokenRatesController,tokenPricesService:new r.CodefiTokenPricesServiceV2,disabled:!a.useCurrencyRateCheck});return s.subscribe("PreferencesController:stateChange",(0,n.previousValueComparator)((e,t)=>{const{useCurrencyRateCheck:s}=e,{useCurrencyRateCheck:r}=t;return r&&!s?o.enable():!r&&s&&o.disable(),!0},a)),{controller:o}}}}},{package:"$root$",file:"app/scripts/controller-init/assets/token-rates-controller-init.ts"}],[180,{"../../../shared/constants/time":5480,loglevel:4573,"readable-stream":5008},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,s){Object.defineProperty(s,"__esModule",{value:!0}),s.THREE_MINUTES=void 0,s.default=function(){const e=c();return new n.Transform({transform(t,s,r){const n=t.id===undefined,a=e.add(t.id);n||a?r(null,t):(i.default.debug(`RPC request with id "${t.id}" already seen.`),r())},objectMode:!0})};var r,n=e("readable-stream"),i=(r=e("loglevel"))&&r.__esModule?r:{default:r},a=e("../../../shared/constants/time");const o=s.THREE_MINUTES=3*a.MINUTE,c=()=>{const e=new Map;return setInterval(()=>{const t=Date.now()-o;for(const[s,r]of e.entries()){if(!(r<=t))break;e.delete(s)}},o),{add:t=>!e.has(t)&&(e.set(t,Date.now()),!0)}}}}},{package:"$root$",file:"app/scripts/lib/createDupeReqFilterStream.ts"}],[181,{"../../../shared/constants/permissions":5469,"../controllers/permissions":157,"@metamask/keyring-api":2012},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,s){Object.defineProperty(s,"__esModule",{value:!0}),s.default=function({messenger:e}){return function(t,s,n,i){const o=e.call("AccountsController:getSelectedAccount");if((0,r.isEvmAccountType)(o.type))return n();if(a.includes(t.method))return i(new Error(`Non-EVM account cannot request this method: ${t.method}`));if("wallet_requestPermissions"===t.method&&null!=t&&t.params&&Array.isArray(t.params)&&t.params.length>0&&t.params[0]){const e=Object.keys(t.params[0]);if(a.some(t=>e.includes(t)))return i(new Error(`Non-EVM account cannot request this method: ${e.toString()}`))}return n()}};var r=e("@metamask/keyring-api"),n=e("../../../shared/constants/permissions"),i=e("../controllers/permissions");const a=[...Object.values(n.RestrictedEthMethods),...i.unrestrictedEthSigningMethods]}}},{package:"$root$",file:"app/scripts/lib/createEvmMethodsToNonEvmAccountReqFilterMiddleware.ts"}],[182,{loglevel:4573},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,s){Object.defineProperty(s,"__esModule",{value:!0}),s.default=function(e){return function(t,s,r){r(r=>{s.error&&n.default.debug("Error in RPC response:\n",s),t.isMetamaskInternal||(n.default.info(`RPC (${e.origin}): ${t.method} -> ${s.error?"error":"success"}`),r())})}};var r,n=(r=e("loglevel"))&&r.__esModule?r:{default:r}}}},{package:"$root$",file:"app/scripts/lib/createLoggerMiddleware.js"}],[183,{},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,s){Object.defineProperty(s,"__esModule",{value:!0}),s.default=function({mainFrameOrigin:e}){return function(t,s,r){t.mainFrameOrigin=e,r()}}}}},{package:"$root$",file:"app/scripts/lib/createMainFrameOriginMiddleware.ts"}],[184,{"./stream-utils":256,"@metamask/rpc-errors":2421},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,s){Object.defineProperty(s,"__esModule",{value:!0}),s.default=void 0;var r=e("@metamask/rpc-errors"),n=e("./stream-utils");s.default=(e,t)=>async s=>{if(!(0,n.isStreamWritable)(t))return;if(!e[s.method])return void t.write({jsonrpc:"2.0",error:r.rpcErrors.methodNotFound({message:`${s.method} not found`}),id:s.id});let i,a;try{i=await e[s.method](...s.params)}catch(e){a=e}(0,n.isStreamWritable)(t)?a?t.write({jsonrpc:"2.0",error:(0,r.serializeError)(a,{shouldIncludeStack:!0}),id:s.id}):t.write({jsonrpc:"2.0",result:i,id:s.id}):a&&console.error(a)}}}},{package:"$root$",file:"app/scripts/lib/createMetaRPCHandler.js"}],[185,{"./middleware/pending":203,"@metamask/eth-json-rpc-middleware":1747,"@metamask/json-rpc-engine":1961},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,s){Object.defineProperty(s,"__esModule",{value:!0}),s.default=function({version:e,getAccounts:t,processTransaction:s,processTypedMessage:a,processTypedMessageV3:o,processTypedMessageV4:c,processPersonalMessage:l,processDecryptMessage:u,processEncryptionPublicKey:d,getPendingNonce:p,getPendingTransactionByHash:h,processRequestExecutionPermissions:m}){return(0,r.mergeMiddleware)([(0,r.createScaffoldMiddleware)({eth_syncing:!1,web3_clientVersion:`MetaMask/v${e}`}),(0,n.createWalletMiddleware)({getAccounts:t,processTransaction:s,processTypedMessage:a,processTypedMessageV3:o,processTypedMessageV4:c,processPersonalMessage:l,processDecryptMessage:u,processEncryptionPublicKey:d,processRequestExecutionPermissions:m}),(0,i.createPendingNonceMiddleware)({getPendingNonce:p}),(0,i.createPendingTxMiddleware)({getPendingTransactionByHash:h})])};var r=e("@metamask/json-rpc-engine"),n=e("@metamask/eth-json-rpc-middleware"),i=e("./middleware/pending")}}},{package:"$root$",file:"app/scripts/lib/createMetamaskMiddleware.js"}],[186,{loglevel:4573,"webextension-polyfill":5430},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,s){Object.defineProperty(s,"__esModule",{value:!0}),s.default=function({location:e,registerOnboarding:t}){return async function(s,i,a,o){try{if("wallet_registerOnboarding"!==s.method)return void a();s.tabId&&s.tabId!==n.default.tabs.TAB_ID_NONE?await t(e,s.tabId):r.default.debug(`'wallet_registerOnboarding' message from ${e} ignored due to missing tabId`),i.result=!0,o()}catch(e){o(e)}}};var r=i(e("loglevel")),n=i(e("webextension-polyfill"));function i(e){return e&&e.__esModule?e:{default:e}}}}},{package:"$root$",file:"app/scripts/lib/createOnboardingMiddleware.js"}],[187,{},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,s){Object.defineProperty(s,"__esModule",{value:!0}),s.default=function(e){return function(t,s,r){t.origin=e.origin,r()}}}}},{package:"$root$",file:"app/scripts/lib/createOriginMiddleware.js"}],[188,{"../../../shared/constants/app":5447,"@metamask/rpc-errors":2421},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,s){Object.defineProperty(s,"__esModule",{value:!0}),s.SPAM_FILTER_ACTIVATED_ERROR=s.REJECTION_THRESHOLD_IN_MS=s.NUMBER_OF_REJECTIONS_THRESHOLD=s.BLOCKING_THRESHOLD_IN_MS=s.BLOCKABLE_METHODS=void 0,s.default=function({getThrottledOriginState:e,updateThrottledOriginState:t}){return function(s,r,n,p){const{method:h,origin:m}=s;if(!c.has(h)||l.includes(m))return void n();!function(e){if(!e)return!1;const t=Date.now(),{rejections:s,lastRejection:r}=e,n=t-r<=o;return s>=i&&n}(e(m))?n(s=>{if("error"in r&&r.error&&d(r.error)){var n;const i=null===(n=r.error)||void 0===n?void 0:n.data;if("rejectAllApprovals"===(null==i?void 0:i.cause))return void s();const o=e(m)||{rejections:0,lastRejection:0},c=Date.now(),l=c-o.lastRejection<a?o.rejections+1:1;t(m,{rejections:l,lastRejection:c})}else{const s=e(m);Boolean(s)&&t(m,{rejections:0,lastRejection:0})}s()}):p(u)}};var r=e("@metamask/rpc-errors"),n=e("../../../shared/constants/app");const i=s.NUMBER_OF_REJECTIONS_THRESHOLD=3,a=s.REJECTION_THRESHOLD_IN_MS=3e4,o=s.BLOCKING_THRESHOLD_IN_MS=6e4,c=s.BLOCKABLE_METHODS=new Set([n.MESSAGE_TYPE.ADD_ETHEREUM_CHAIN,n.MESSAGE_TYPE.ETH_SEND_TRANSACTION,n.MESSAGE_TYPE.ETH_SIGN_TYPED_DATA,n.MESSAGE_TYPE.ETH_SIGN_TYPED_DATA_V1,n.MESSAGE_TYPE.ETH_SIGN_TYPED_DATA_V3,n.MESSAGE_TYPE.ETH_SIGN_TYPED_DATA_V4,n.MESSAGE_TYPE.PERSONAL_SIGN,n.MESSAGE_TYPE.SWITCH_ETHEREUM_CHAIN,n.MESSAGE_TYPE.WALLET_SEND_CALLS,n.MESSAGE_TYPE.WATCH_ASSET]),l=["http://127.0.0.1:8080","http://127.0.0.1:8081","http://127.0.0.1:8082","http://localhost:8080","http://localhost:8081","http://localhost:8082"],u=s.SPAM_FILTER_ACTIVATED_ERROR=r.providerErrors.unauthorized("Request blocked due to spam filter."),d=e=>e.code===r.errorCodes.provider.userRejectedRequest}}},{package:"$root$",file:"app/scripts/lib/createOriginThrottlingMiddleware.ts"}],[189,{"../../../shared/constants/app":5447,"../../../shared/constants/metametrics":5462,"../../../shared/constants/security-provider":5472,"../../../shared/constants/signatures":5473,"../../../shared/constants/transaction":5482,"../../../shared/lib/confirmation.utils":5494,"../../../shared/lib/snaps/snaps":5541,"../../../shared/modules/error":5560,"../../../shared/modules/transaction.utils":5581,"../../../ui/helpers/utils/metrics":6711,"./snap-keyring/metrics":244,"@metamask/controller-utils":1321,"@metamask/rpc-errors":2421,"ethereumjs-util":4052},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,s){Object.defineProperty(s,"__esModule",{value:!0}),s.default=function({rateLimitTimeout:e=3e5,rateLimitSamplePercent:t=.001,globalRateLimitTimeout:s=3e5,globalRateLimitMaxAmount:C=10,getAccountType:I,getDeviceModel:A,getHardwareTypeForMetric:_,snapAndHardwareMessenger:P,appStateController:N,metaMetricsController:O,getHDEntropyIndex:j}){return async function(R,D,L){const{origin:B,method:x,params:F}=R,U=function(e){return[a.MESSAGE_TYPE.WALLET_CREATE_SESSION,a.MESSAGE_TYPE.WALLET_INVOKE_METHOD].includes(e)}(x),G=U?o.MetaMetricsRequestedThrough.MultichainApi:o.MetaMetricsRequestedThrough.EthereumProvider,$=U?o.MetaMetricsEventCategory.MultichainApi:o.MetaMetricsEventCategory.InpageProvider;let H,K=x;var q;x===a.MESSAGE_TYPE.WALLET_INVOKE_METHOD&&(K=null==F||null===(q=F.request)||void 0===q?void 0:q.method,H=null==F?void 0:F.scope);const W=v[K];let V;switch(W){case y.TIMEOUT:V=void 0!==T[K];break;case y.NON_RATE_LIMITED:V=!1;break;case y.BLOCKED:V=!0;break;default:case y.RANDOM_SAMPLE:V=Math.random()>=t}const z=C>0&&M>=C,Y=!0===O.state.participateInMetaMetrics,Q=S[K],J={api_source:G};let X;H&&(J.chain_id_caip=H);const Z=(0,g.isSnapPreinstalled)(B),ee=B!==a.ORIGIN_METAMASK&&!Z&&!V&&!z&&!0===Y;if(ee){var te;const t=Q?Q.REQUESTED:o.MetaMetricsEventName.ProviderMethodCalled;if(t===o.MetaMetricsEventName.SignatureRequested){var se,re,ne,ie,ae;let e;var oe,ce;if(J.signature_type=K,J.hd_entropy_index=j(),(0,i.isValidAddress)(null==R||null===(se=R.params)||void 0===se?void 0:se[1]))e=null==R||null===(oe=R.params)||void 0===oe?void 0:oe[0];else e=null==R||null===(ce=R.params)||void 0===ce?void 0:ce[1];null!==(re=R.securityAlertResponse)&&void 0!==re&&re.providerRequestsCount&&Object.keys(R.securityAlertResponse.providerRequestsCount).forEach(e=>{J[`ppom_${e}_count`]=R.securityAlertResponse.providerRequestsCount[e]}),J.security_alert_response=(null===(ne=R.securityAlertResponse)||void 0===ne?void 0:ne.result_type)??l.BlockaidResultType.NotApplicable,J.security_alert_reason=(null===(ie=R.securityAlertResponse)||void 0===ie?void 0:ie.reason)??l.BlockaidReason.notApplicable,null!==(ae=R.securityAlertResponse)&&void 0!==ae&&ae.description&&(J.security_alert_description=R.securityAlertResponse.description),(0,m.shouldUseRedesignForSignatures)({approvalType:b[K]})&&(J.ui_customizations=[...J.ui_customizations||[],o.MetaMetricsEventUiCustomization.RedesignedConfirmation]);const t=await(0,f.getSnapAndHardwareInfoForMetrics)(I,A,_,P);Object.assign(J,t);try{if(K===a.MESSAGE_TYPE.PERSONAL_SIGN){const{isSIWEMessage:t}=(0,r.detectSIWE)({data:e});t&&(J.ui_customizations=[...J.ui_customizations||[],o.MetaMetricsEventUiCustomization.Siwe])}else if(K===a.MESSAGE_TYPE.ETH_SIGN_TYPED_DATA_V4){const t=(0,c.parseTypedDataMessage)(e);X={},J.eip712_primary_type=t.primaryType,X.eip712_verifyingContract=t.domain.verifyingContract,X.eip712_domain_version=t.domain.version,X.eip712_domain_name=t.domain.name,u.PRIMARY_TYPES_PERMIT.includes(t.primaryType)?J.ui_customizations=[...J.ui_customizations||[],o.MetaMetricsEventUiCustomization.Permit]:u.PRIMARY_TYPES_ORDER.includes(t.primaryType)&&(J.ui_customizations=[...J.ui_customizations||[],o.MetaMetricsEventUiCustomization.Order])}}catch(e){console.warn(`createRPCMethodTrackingMiddleware: Errored - ${e}`)}}else J.method=K;const n=E[K];if(n&&(J.params=n(F)),null===(te=k[K])||void 0===te||te.call(k,R,undefined,w.REQUESTED,J),t===o.MetaMetricsEventName.SignatureRequested){!function(e,t,s,r){e.createEventFragment({category:r,initialEvent:o.MetaMetricsEventName.SignatureRequested,successEvent:o.MetaMetricsEventName.SignatureApproved,failureEvent:o.MetaMetricsEventName.SignatureRejected,uniqueIdentifier:(0,h.generateSignatureUniqueId)(t.id),persist:!0,referrer:{url:t.origin},...s})}(O,R,{properties:J,sensitiveProperties:X},$)}else O.trackEvent({event:t,category:$,referrer:{url:B},properties:J});W===y.TIMEOUT&&(T[K]=setTimeout(()=>{delete T[K]},e)),M+=1,setTimeout(()=>{M-=1},s)}L(async e=>{var t,s,r,i;if(!1===ee||void 0===Q)return e();const a=null===(t=D.error)||void 0===t||null===(t=t.data)||void 0===t?void 0:t.location;let c,l;const u=(0,p.getErrorMessage)(D.error);if((null===(s=D.error)||void 0===s?void 0:s.code)===n.errorCodes.provider.userRejectedRequest?(c=Q.REJECTED,l=w.REJECTED):(null===(r=D.error)||void 0===r?void 0:r.code)===n.errorCodes.rpc.internal&&[u,D.error.message].includes("Request rejected by user or snap.")?(c=Q.REJECTED,l=w.REJECTED,J.status=u):(c=Q.APPROVED,l=w.APPROVED),!c)return e();null===(i=k[K])||void 0===i||i.call(k,R,D,l,J);let m={};if(d.SIGNING_METHODS.includes(K)){var g;const e=N.getSignatureSecurityAlertResponse(null===(g=R.securityAlertResponse)||void 0===g?void 0:g.securityAlertId);m=(0,h.getBlockaidMetricsProps)({securityAlertResponse:e})}const f={...J,...m,location:a};if(c===o.MetaMetricsEventName.SignatureRejected||c===o.MetaMetricsEventName.SignatureApproved){const e={abandoned:c===Q.REJECTED},t={properties:{...f,hd_entropy_index:j()},sensitiveProperties:X};!function(e,t,s,r){const n=(0,h.generateSignatureUniqueId)(t.id);e.updateEventFragment(n,r),e.finalizeEventFragment(n,s)}(O,R,e,t)}else O.trackEvent({event:c,category:$,referrer:{url:B},properties:f});return e()})}};var r=e("@metamask/controller-utils"),n=e("@metamask/rpc-errors"),i=e("ethereumjs-util"),a=e("../../../shared/constants/app"),o=e("../../../shared/constants/metametrics"),c=e("../../../shared/modules/transaction.utils"),l=e("../../../shared/constants/security-provider"),u=e("../../../shared/constants/signatures"),d=e("../../../shared/constants/transaction"),p=e("../../../shared/modules/error"),h=e("../../../ui/helpers/utils/metrics"),m=e("../../../shared/lib/confirmation.utils"),g=e("../../../shared/lib/snaps/snaps"),f=e("./snap-keyring/metrics");const y={TIMEOUT:"timeout",BLOCKED:"blocked",NON_RATE_LIMITED:"non_rate_limited",RANDOM_SAMPLE:"random_sample"},w={REQUESTED:"REQUESTED",APPROVED:"APPROVED",REJECTED:"REJECTED"},v={[a.MESSAGE_TYPE.ETH_SIGN_TYPED_DATA]:y.NON_RATE_LIMITED,[a.MESSAGE_TYPE.ETH_SIGN_TYPED_DATA_V3]:y.NON_RATE_LIMITED,[a.MESSAGE_TYPE.ETH_SIGN_TYPED_DATA_V4]:y.NON_RATE_LIMITED,[a.MESSAGE_TYPE.PERSONAL_SIGN]:y.NON_RATE_LIMITED,[a.MESSAGE_TYPE.ETH_DECRYPT]:y.NON_RATE_LIMITED,[a.MESSAGE_TYPE.ETH_GET_ENCRYPTION_PUBLIC_KEY]:y.NON_RATE_LIMITED,[a.MESSAGE_TYPE.ADD_ETHEREUM_CHAIN]:y.NON_RATE_LIMITED,[a.MESSAGE_TYPE.SWITCH_ETHEREUM_CHAIN]:y.NON_RATE_LIMITED,[a.MESSAGE_TYPE.ETH_REQUEST_ACCOUNTS]:y.TIMEOUT,[a.MESSAGE_TYPE.WALLET_REQUEST_PERMISSIONS]:y.TIMEOUT,[a.MESSAGE_TYPE.WALLET_CREATE_SESSION]:y.NON_RATE_LIMITED,[a.MESSAGE_TYPE.SEND_METADATA]:y.BLOCKED,[a.MESSAGE_TYPE.ETH_CHAIN_ID]:y.BLOCKED,[a.MESSAGE_TYPE.ETH_ACCOUNTS]:y.BLOCKED,[a.MESSAGE_TYPE.LOG_WEB3_SHIM_USAGE]:y.BLOCKED,[a.MESSAGE_TYPE.GET_PROVIDER_STATE]:y.BLOCKED,[a.MESSAGE_TYPE.WALLET_GET_CALLS_STATUS]:y.NON_RATE_LIMITED,[a.MESSAGE_TYPE.WALLET_GET_CAPABILITIES]:y.NON_RATE_LIMITED,[a.MESSAGE_TYPE.WALLET_SEND_CALLS]:y.NON_RATE_LIMITED},b={[a.MESSAGE_TYPE.PERSONAL_SIGN]:r.ApprovalType.PersonalSign,[a.MESSAGE_TYPE.SIGN]:r.ApprovalType.SignTransaction,[a.MESSAGE_TYPE.ETH_SIGN_TYPED_DATA]:r.ApprovalType.EthSignTypedData,[a.MESSAGE_TYPE.ETH_SIGN_TYPED_DATA_V1]:r.ApprovalType.EthSignTypedData,[a.MESSAGE_TYPE.ETH_SIGN_TYPED_DATA_V3]:r.ApprovalType.EthSignTypedData,[a.MESSAGE_TYPE.ETH_SIGN_TYPED_DATA_V4]:r.ApprovalType.EthSignTypedData},S={[a.MESSAGE_TYPE.ETH_SIGN_TYPED_DATA]:{APPROVED:o.MetaMetricsEventName.SignatureApproved,REJECTED:o.MetaMetricsEventName.SignatureRejected,REQUESTED:o.MetaMetricsEventName.SignatureRequested},[a.MESSAGE_TYPE.ETH_SIGN_TYPED_DATA_V3]:{APPROVED:o.MetaMetricsEventName.SignatureApproved,REJECTED:o.MetaMetricsEventName.SignatureRejected,REQUESTED:o.MetaMetricsEventName.SignatureRequested},[a.MESSAGE_TYPE.ETH_SIGN_TYPED_DATA_V4]:{APPROVED:o.MetaMetricsEventName.SignatureApproved,REJECTED:o.MetaMetricsEventName.SignatureRejected,REQUESTED:o.MetaMetricsEventName.SignatureRequested},[a.MESSAGE_TYPE.PERSONAL_SIGN]:{APPROVED:o.MetaMetricsEventName.SignatureApproved,REJECTED:o.MetaMetricsEventName.SignatureRejected,REQUESTED:o.MetaMetricsEventName.SignatureRequested},[a.MESSAGE_TYPE.ETH_DECRYPT]:{APPROVED:o.MetaMetricsEventName.DecryptionApproved,REJECTED:o.MetaMetricsEventName.DecryptionRejected,REQUESTED:o.MetaMetricsEventName.DecryptionRequested},[a.MESSAGE_TYPE.ETH_GET_ENCRYPTION_PUBLIC_KEY]:{APPROVED:o.MetaMetricsEventName.EncryptionPublicKeyApproved,REJECTED:o.MetaMetricsEventName.EncryptionPublicKeyRejected,REQUESTED:o.MetaMetricsEventName.EncryptionPublicKeyRequested},[a.MESSAGE_TYPE.ETH_REQUEST_ACCOUNTS]:{APPROVED:o.MetaMetricsEventName.PermissionsApproved,REJECTED:o.MetaMetricsEventName.PermissionsRejected,REQUESTED:o.MetaMetricsEventName.PermissionsRequested},[a.MESSAGE_TYPE.WALLET_REQUEST_PERMISSIONS]:{APPROVED:o.MetaMetricsEventName.PermissionsApproved,REJECTED:o.MetaMetricsEventName.PermissionsRejected,REQUESTED:o.MetaMetricsEventName.PermissionsRequested},[a.MESSAGE_TYPE.WALLET_CREATE_SESSION]:{APPROVED:o.MetaMetricsEventName.PermissionsApproved,REJECTED:o.MetaMetricsEventName.PermissionsRejected,REQUESTED:o.MetaMetricsEventName.PermissionsRequested},[a.MESSAGE_TYPE.WALLET_GET_CALLS_STATUS]:{REQUESTED:o.MetaMetricsEventName.Wallet5792Called},[a.MESSAGE_TYPE.WALLET_GET_CAPABILITIES]:{REQUESTED:o.MetaMetricsEventName.Wallet5792Called},[a.MESSAGE_TYPE.WALLET_SEND_CALLS]:{REQUESTED:o.MetaMetricsEventName.Wallet5792Called}},E={[a.MESSAGE_TYPE.WATCH_ASSET]:({type:e})=>({type:e}),[a.MESSAGE_TYPE.ADD_ETHEREUM_CHAIN]:([{chainId:e}])=>({chainId:e}),[a.MESSAGE_TYPE.SWITCH_ETHEREUM_CHAIN]:([{chainId:e}])=>({chainId:e})},k={[a.MESSAGE_TYPE.WALLET_SEND_CALLS]:function(e,t,s,r){var n;if(s!==w.REQUESTED)return;const{params:i}=e,a=null==i||null===(n=i[0])||void 0===n||null===(n=n.calls)||void 0===n?void 0:n.length;a&&(r.batch_transaction_count=a)},[a.MESSAGE_TYPE.WALLET_CREATE_SESSION]:function(e,t,s,r){if(s===w.REQUESTED){const{params:t}=e,s=(null==t?void 0:t.requiredScopes)||{},n=(null==t?void 0:t.optionalScopes)||{},i=new Set;for(const e of Object.keys(s))i.add(e);for(const e of Object.keys(n))i.add(e);r.chain_id_list=Array.from(i)}else if(s===w.APPROVED){const{result:e}=t,s=Object.keys((null==e?void 0:e.sessionScopes)||{});r.chain_id_list=s}}},T={};let M=0}}},{package:"$root$",file:"app/scripts/lib/createRPCMethodTrackingMiddleware.js"}],[19,{"../../../shared/constants/bridge":5449,"../../../shared/lib/fetch-with-cache":5527,"../../../shared/lib/trace":5546,"../lib/util":276,"@metamask/bridge-controller":1210,"@metamask/controller-utils":1321},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,s){Object.defineProperty(s,"__esModule",{value:!0}),s.BridgeControllerInit=void 0;var r,n=e("@metamask/bridge-controller"),i=e("@metamask/controller-utils"),a=e("../../../shared/constants/bridge"),o=e("../../../shared/lib/trace"),c=(r=e("../../../shared/lib/fetch-with-cache"))&&r.__esModule?r:{default:r},l=e("../lib/util");s.BridgeControllerInit=({controllerMessenger:e,initMessenger:t,getController:s})=>{const r=s("TransactionController");return{persistedStateKey:null,memStateKey:null,controller:new n.BridgeController({messenger:e,clientId:n.BridgeClientId.EXTENSION,getLayer1GasFee:(...e)=>r.getLayer1GasFee(...e),fetchFn:async(e,{cacheOptions:t,functionName:s,...r}={})=>"fetchBridgeTokens"===s?await(0,c.default)({url:e.toString(),fetchOptions:{method:"GET",...r},cacheOptions:t,functionName:s}):await(0,i.handleFetch)(e,{method:"GET",...r}),trackMetaMetricsFn:(e,s)=>{const r=(Date.now()+Math.random()).toString();t.call("MetaMetricsController:trackEvent",{category:n.UNIFIED_SWAP_BRIDGE_EVENT_CATEGORY,event:e,properties:{...s??{},environmentType:(0,l.getEnvironmentType)(),actionId:r}})},traceFn:(...e)=>(0,o.trace)(...e),config:{customBridgeApiBaseUrl:a.BRIDGE_API_BASE_URL}})}}}}},{package:"$root$",file:"app/scripts/controller-init/bridge-controller-init.ts"}],[190,{},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,s){Object.defineProperty(s,"__esModule",{value:!0}),s.default=function(e){return function(t,s,r){t.tabId=e.tabId,r()}}}}},{package:"$root$",file:"app/scripts/lib/createTabIdMiddleware.js"}],[191,{"../../../shared/constants/app":5447,"../../../shared/lib/trace":5546},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,s){Object.defineProperty(s,"__esModule",{value:!0}),s.default=function(){return async function(e,t,s){const{id:r,method:o}=e,c=i[o];c&&(e.traceContext=await(0,n.trace)({name:c,id:r,tags:a[o]}),await(0,n.trace)({name:n.TraceName.Middleware,id:r,parentContext:e.traceContext})),s()}};var r=e("../../../shared/constants/app"),n=e("../../../shared/lib/trace");const i={[r.MESSAGE_TYPE.ETH_SEND_TRANSACTION]:n.TraceName.Transaction,[r.MESSAGE_TYPE.ETH_SIGN_TYPED_DATA]:n.TraceName.Signature,[r.MESSAGE_TYPE.ETH_SIGN_TYPED_DATA_V1]:n.TraceName.Signature,[r.MESSAGE_TYPE.ETH_SIGN_TYPED_DATA_V3]:n.TraceName.Signature,[r.MESSAGE_TYPE.ETH_SIGN_TYPED_DATA_V4]:n.TraceName.Signature,[r.MESSAGE_TYPE.PERSONAL_SIGN]:n.TraceName.Signature},a={[r.MESSAGE_TYPE.ETH_SEND_TRANSACTION]:{source:"dapp"}}}}},{package:"$root$",file:"app/scripts/lib/createTracingMiddleware.ts"}],[1918,{"./onekey-keyring.cjs":1919,"./trezor-connect-bridge.cjs":1920,"./trezor-keyring.cjs":1921},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,s){var r=this&&this.__createBinding||(Object.create?function(e,t,s,r){r===undefined&&(r=s);var n=Object.getOwnPropertyDescriptor(t,s);n&&!("get"in n?!t.__esModule:n.writable||n.configurable)||(n={enumerable:!0,get:function(){return t[s]}}),Object.defineProperty(e,r,n)}:function(e,t,s,r){r===undefined&&(r=s),e[r]=t[s]}),n=this&&this.__exportStar||function(e,t){for(var s in e)"default"===s||Object.prototype.hasOwnProperty.call(t,s)||r(t,e,s)};Object.defineProperty(s,"__esModule",{value:!0}),n(e("./trezor-keyring.cjs"),s),n(e("./onekey-keyring.cjs"),s),n(e("./trezor-connect-bridge.cjs"),s)}}},{package:"@metamask/eth-trezor-keyring",file:"node_modules/@metamask/eth-trezor-keyring/dist/index.cjs"}],[1919,{"./trezor-keyring.cjs":1921},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,s){Object.defineProperty(s,"__esModule",{value:!0}),s.OneKeyKeyring=void 0;const r=e("./trezor-keyring.cjs"),n="OneKey Hardware";class i extends r.TrezorKeyring{constructor(){super(...arguments),this.type=n}}s.OneKeyKeyring=i,i.type=n}}},{package:"@metamask/eth-trezor-keyring",file:"node_modules/@metamask/eth-trezor-keyring/dist/onekey-keyring.cjs"}],[192,{"../../../../shared/lib/deep-links/constants":5496,"../../../../shared/lib/deep-links/parse":5498,"../../../../shared/lib/deep-links/routes/route":5506,"../../../../shared/lib/deep-links/verify":5508,"../../../../shared/modules/mv3.utils":5567,events:4105,loglevel:4573,"webextension-polyfill":5430},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,s){Object.defineProperty(s,"__esModule",{value:!0}),s.DeepLinkRouter=void 0;var r=d(e("events")),n=d(e("webextension-polyfill")),i=d(e("loglevel")),a=e("../../../../shared/modules/mv3.utils"),o=e("../../../../shared/lib/deep-links/parse"),c=e("../../../../shared/lib/deep-links/constants"),l=e("../../../../shared/lib/deep-links/routes/route"),u=e("../../../../shared/lib/deep-links/verify");function d(e){return e&&e.__esModule?e:{default:e}}function p(e,t,s){return(t=function(e){var t=function(e,t){if("object"!=typeof e||!e)return e;var s=e[Symbol.toPrimitive];if(void 0!==s){var r=s.call(e,t||"default");if("object"!=typeof r)return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==typeof t?t:t+""}(t))in e?Object.defineProperty(e,t,{value:s,enumerable:!0,configurable:!0,writable:!0}):e[t]=s,e}const h=l.DEEP_LINK_ROUTE.replace(/^\//u,"");class m extends r.default{constructor({getExtensionURL:e,getState:t}){super(),p(this,"getExtensionURL",void 0),p(this,"getState",void 0),p(this,"handleBeforeRequest",({tabId:e,url:t})=>e===n.default.tabs.TAB_ID_NONE?{}:this.tryNavigateTo(e,t)),this.getExtensionURL=e,this.getState=t}formatUrlForInterstitialPage(e){return e.pathname+e.search}get404ErrorURL(e){const t=new URLSearchParams({errorCode:"404"});return e&&t.set("u",this.formatUrlForInterstitialPage(e)),this.getExtensionURL(h,t.toString())}async redirectTab(e,t){try{await n.default.tabs.update(e,{url:t})}catch(e){i.default.error("Error redirecting tab:",e),this.emit("error",e)}}install(){n.default.webRequest.onBeforeRequest.addListener(this.handleBeforeRequest,{urls:[`*://*.${c.DEEP_LINK_HOST}/*`],types:["main_frame"]},a.isManifestV3?[]:["blocking"])}uninstall(){n.default.webRequest.onBeforeRequest.removeListener(this.handleBeforeRequest)}async tryNavigateTo(e,t){if(t.length>c.DEEP_LINK_MAX_LENGTH)return i.default.debug("Url is too long, skipping deep link handling"),{};let s;try{const e=new URL(t),r=await(0,o.parse)(e);if(r)if(this.emit("navigate",{url:e,parsed:r}),"redirectTo"in r.destination)s=r.destination.redirectTo.toString();else if(this.canSkipInterstitial(r.signature))s=this.getExtensionURL(r.destination.path,r.destination.query.toString());else{const t=new URLSearchParams({u:this.formatUrlForInterstitialPage(e)});s=this.getExtensionURL(h,t.toString())}else s=this.get404ErrorURL(e)}catch(e){i.default.error("Invalid URL:",t,e),this.emit("error",e),s=this.get404ErrorURL()}return this.redirectTab(e,s),a.isManifestV3?{}:{cancel:!0}}canSkipInterstitial(e){var t;return e===u.VALID&&Boolean(null===(t=this.getState().preferences)||void 0===t?void 0:t.skipDeepLinkInterstitial)}}s.DeepLinkRouter=m}}},{package:"$root$",file:"app/scripts/lib/deep-links/deep-link-router.ts"}],[1920,{"@trezor/connect-web":2954},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,s){var r=this&&this.__createBinding||(Object.create?function(e,t,s,r){r===undefined&&(r=s);var n=Object.getOwnPropertyDescriptor(t,s);n&&!("get"in n?!t.__esModule:n.writable||n.configurable)||(n={enumerable:!0,get:function(){return t[s]}}),Object.defineProperty(e,r,n)}:function(e,t,s,r){r===undefined&&(r=s),e[r]=t[s]}),n=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),i=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var s in e)"default"!==s&&Object.prototype.hasOwnProperty.call(e,s)&&r(t,e,s);return n(t,e),t};Object.defineProperty(s,"__esModule",{value:!0}),s.TrezorConnectBridge=void 0;const a=i(e("@trezor/connect-web"));s.TrezorConnectBridge=class{constructor(){this.trezorConnectInitiated=!1}async init(e){a.default.on(a.DEVICE_EVENT,e=>{var t;e.type===a.DEVICE.CONNECT&&(this.model=null===(t=e.payload.features)||void 0===t?void 0:t.model)}),this.trezorConnectInitiated||(await a.default.init(e),this.trezorConnectInitiated=!0)}async dispose(){return a.default.dispose(),Promise.resolve()}getPublicKey(e){return a.default.getPublicKey(e)}ethereumSignTransaction(e){return a.default.ethereumSignTransaction(e)}ethereumSignMessage(e){return a.default.ethereumSignMessage(e)}ethereumSignTypedData(e){return a.default.ethereumSignTypedData(e)}}}}},{package:"@metamask/eth-trezor-keyring",file:"node_modules/@metamask/eth-trezor-keyring/dist/trezor-connect-bridge.cjs"}],[1921,{"@ethereumjs/tx":572,"@ethereumjs/util":586,"@metamask/eth-sig-util":1856,"@metamask/utils":2835,"@trezor/connect-plugin-ethereum":2945,buffer:3793,hdkey:4340},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,s){(function(t){(function(){var r,n,i,a,o,c,l=this&&this.__classPrivateFieldGet||function(e,t,s,r){if("a"===s&&!r)throw new TypeError("Private accessor was defined without a getter");if("function"==typeof t?e!==t||!r:!t.has(e))throw new TypeError("Cannot read private member from an object whose class did not declare it");return"m"===s?r:"a"===s?r.call(e):r?r.value:t.get(e)},u=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(s,"__esModule",{value:!0}),s.TrezorKeyring=s.TREZOR_CONNECT_MANIFEST=void 0;const d=e("@ethereumjs/tx"),p=e("@ethereumjs/util"),h=e("@metamask/eth-sig-util"),m=e("@metamask/utils"),g=e("@trezor/connect-plugin-ethereum"),f=u(e("hdkey")),y="m/44'/60'/0'/0",w="m/44'/1'/0'/0",v="m/44'/60'/0'",b={[y]:!0,[v]:!0,[w]:!0},S="Trezor Hardware",E=1e3;async function k(e){return new Promise(t=>setTimeout(t,e))}function T(e){return"function"==typeof e.getChainId}s.TREZOR_CONNECT_MANIFEST={appName:"MetaMask",email:"support@metamask.io",appUrl:"https://metamask.io"};class M{constructor({bridge:e}){if(r.add(this),this.type=S,this.accounts=[],this.hdk=new f.default,this.hdPath=y,this.page=0,this.perPage=5,this.unlockedAccount=0,this.paths={},!e)throw new Error("Bridge is a required dependency for the keyring");this.bridge=e}getModel(){return this.bridge.model}async init(){return this.bridge.init({manifest:s.TREZOR_CONNECT_MANIFEST,lazyLoad:!0})}async destroy(){return this.bridge.dispose()}async serialize(){return Promise.resolve({hdPath:this.hdPath,accounts:this.accounts.slice(),page:this.page,paths:this.paths,perPage:this.perPage,unlockedAccount:this.unlockedAccount})}async deserialize(e){var t,s,r,n;return this.hdPath=null!==(t=e.hdPath)&&void 0!==t?t:y,this.accounts=null!==(s=e.accounts)&&void 0!==s?s:[],this.page=null!==(r=e.page)&&void 0!==r?r:0,this.perPage=null!==(n=e.perPage)&&void 0!==n?n:5,Promise.resolve()}isUnlocked(){var e;return Boolean(null===(e=this.hdk)||void 0===e?void 0:e.publicKey)}async unlock(){return this.isUnlocked()?Promise.resolve("already unlocked"):new Promise((e,s)=>{this.bridge.getPublicKey({path:this.hdPath,coin:"ETH"}).then(r=>{var n;r.success?(this.hdk.publicKey=t.from(r.payload.publicKey,"hex"),this.hdk.chainCode=t.from(r.payload.chainCode,"hex"),e("just unlocked")):s(new Error((null===(n=r.payload)||void 0===n?void 0:n.error)||"Unknown error"))}).catch(e=>{s(new Error((null==e?void 0:e.toString())||"Unknown error"))})})}setAccountToUnlock(e){this.unlockedAccount=parseInt(String(e),10)}async addAccounts(e){return new Promise((t,s)=>{this.unlock().then(s=>{const n=this.unlockedAccount,i=n+e,a=[];for(let e=n;e<i;e++){const t=l(this,r,"m",o).call(this,"m",e);this.accounts.includes(t)||(this.accounts=[...this.accounts,t],a.push(t)),this.page=0}t(a)}).catch(e=>{s(e)})})}async getFirstPage(){return this.page=0,l(this,r,"m",n).call(this,1)}async getNextPage(){return l(this,r,"m",n).call(this,1)}async getPreviousPage(){return l(this,r,"m",n).call(this,-1)}async getAccounts(){return Promise.resolve(this.accounts.slice())}removeAccount(e){if(!this.accounts.map(e=>e.toLowerCase()).includes(e.toLowerCase()))throw new Error(`Address ${e} not found in this keyring`);this.accounts=this.accounts.filter(t=>t.toLowerCase()!==e.toLowerCase())}async signTransaction(e,s){return T(s)?l(this,r,"m",i).call(this,e,s.getChainId(),s,e=>(s.v=t.from(e.v,"hex"),s.r=t.from(e.r,"hex"),s.s=t.from(e.s,"hex"),s)):l(this,r,"m",i).call(this,e,Number(s.common.chainId()),s,e=>{const t=s.toJSON();return t.type=s.type,t.v=(0,m.add0x)(e.v),t.r=(0,m.add0x)(e.r),t.s=(0,m.add0x)(e.s),d.TransactionFactory.fromTxData(t,{common:s.common,freeze:Object.isFrozen(s)})})}async signMessage(e,t){return this.signPersonalMessage(e,t)}async signPersonalMessage(e,t){return new Promise((s,n)=>{this.unlock().then(i=>{setTimeout(()=>{this.bridge.ethereumSignMessage({path:l(this,r,"m",c).call(this,e),message:(0,m.remove0x)(t),hex:!0}).then(t=>{var r;if(t.success){t.payload.address!==(0,m.getChecksumAddress)(e)&&n(new Error("signature doesnt match the right address"));const r=`0x${t.payload.signature}`;s(r)}else n(new Error((null===(r=t.payload)||void 0===r?void 0:r.error)||"Unknown error"))}).catch(e=>{n(new Error((null==e?void 0:e.toString())||"Unknown error"))})},"just unlocked"===i?E:0)}).catch(e=>{n(new Error((null==e?void 0:e.toString())||"Unknown error"))})})}async signTypedData(e,t,s){var n,i;const{version:a}=null!=s?s:{version:h.SignTypedDataVersion.V4},o=(0,g.transformTypedData)(t,a===h.SignTypedDataVersion.V4),{types:u,message:d={},domain:p={},primaryType:f,domain_separator_hash:y,message_hash:w}=o,v=await this.unlock();await k("just unlocked"===v?E:0);const b=await this.bridge.ethereumSignTypedData({path:l(this,r,"m",c).call(this,e),data:{types:Object.assign(Object.assign({},u),{EIP712Domain:null!==(n=u.EIP712Domain)&&void 0!==n?n:[]}),message:d,domain:p,primaryType:f},metamask_v4_compat:!0,domain_separator_hash:y,message_hash:null!=w?w:""});if(b.success){if((0,m.getChecksumAddress)(e)!==b.payload.address)throw new Error("signature doesnt match the right address");return b.payload.signature}throw new Error((null===(i=b.payload)||void 0===i?void 0:i.error)||"Unknown error")}forgetDevice(){this.accounts=[],this.hdk=new f.default,this.page=0,this.unlockedAccount=0,this.paths={}}setHdPath(e){if(!b[e])throw new Error(`The setHdPath method does not support setting HD Path to ${e}`);this.hdPath!==e&&(this.hdk=new f.default,this.accounts=[],this.page=0,this.perPage=5,this.unlockedAccount=0,this.paths={}),this.hdPath=e}}s.TrezorKeyring=M,r=new WeakSet,n=async function(e){return this.page+=e,this.page<=0&&(this.page=1),new Promise((e,t)=>{this.unlock().then(t=>{const s=(this.page-1)*this.perPage,n=s+this.perPage,i=[];for(let e=s;e<n;e++){const t=l(this,r,"m",o).call(this,"m",e);i.push({address:t,balance:null,index:e}),this.paths[(0,m.getChecksumAddress)(t)]=e}e(i)}).catch(e=>{t(e)})})},i=async function(e,s,n,i){var o,u,d,p;let h;h=T(n)?{to:l(this,r,"m",a).call(this,n.to),value:l(this,r,"m",a).call(this,n.value),data:l(this,r,"m",a).call(this,n.data),chainId:s,nonce:l(this,r,"m",a).call(this,n.nonce),gasLimit:l(this,r,"m",a).call(this,n.gasLimit),gasPrice:l(this,r,"m",a).call(this,n.gasPrice)}:Object.assign(Object.assign({},n.toJSON()),{chainId:s,to:l(this,r,"m",a).call(this,t.from(null!==(u=null===(o=n.to)||void 0===o?void 0:o.bytes)&&void 0!==u?u:[]))});try{const t=await this.unlock();await k("just unlocked"===t?E:0);const s=await this.bridge.ethereumSignTransaction({path:l(this,r,"m",c).call(this,e),transaction:h});if(s.success){const t=i(s.payload),r=(0,m.getChecksumAddress)((0,m.add0x)(t.getSenderAddress().toString("hex")));if(r!==(0,m.getChecksumAddress)(e))throw new Error("signature doesn't match the right address");return t}throw new Error((null===(d=s.payload)||void 0===d?void 0:d.error)||"Unknown error")}catch(e){throw new Error(null!==(p=null==e?void 0:e.toString())&&void 0!==p?p:"Unknown error")}},a=function(e){return(0,m.bytesToHex)(e)},o=function(e,t){const s=this.hdk.derive(`${e}/${t}`),r=(0,m.bytesToHex)((0,p.publicToAddress)(s.publicKey,!0));return(0,p.toChecksumAddress)(r)},c=function(e){const t=(0,m.getChecksumAddress)(e);let s=this.paths[t];if(void 0===s)for(let e=0;e<1e3;e++)if(t===l(this,r,"m",o).call(this,"m",e)){s=e;break}if(void 0===s)throw new Error("Unknown address");return`${this.hdPath}/${s}`},M.type=S}).call(this)}).call(this,e("buffer").Buffer)}}},{package:"@metamask/eth-trezor-keyring",file:"node_modules/@metamask/eth-trezor-keyring/dist/trezor-keyring.cjs"}],[193,{"../../../../shared/constants/metametrics":5462},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,s){Object.defineProperty(s,"__esModule",{value:!0}),s.createEvent=function({signature:e,url:t}){const s={route:t.pathname,signature:e},i={};for(const[e,r]of t.searchParams.entries())"sig"!==e&&("attributionId"===e?s.attribution_id=r:n.has(e)?s[e]=r:i[e]=r);return{category:r.MetaMetricsEventCategory.DeepLink,event:r.MetaMetricsEventName.DeepLinkUsed,properties:s,sensitiveProperties:i}};var r=e("../../../../shared/constants/metametrics");const n=new Set(["utm_campaign","utm_content","utm_medium","utm_source","utm_term"])}}},{package:"$root$",file:"app/scripts/lib/deep-links/metrics.ts"}],[194,{"@metamask/browser-passworder":1277},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,s){Object.defineProperty(s,"__esModule",{value:!0}),s.encryptorFactory=void 0;var r=e("@metamask/browser-passworder");const n=e=>async(t,s,n,i)=>(0,r.encrypt)(t,s,n,i,{algorithm:"PBKDF2",params:{iterations:e}}),i=e=>async(t,s,n)=>(0,r.encryptWithDetail)(t,s,n,{algorithm:"PBKDF2",params:{iterations:e}}),a=e=>async(t,s,n,i)=>(0,r.keyFromPassword)(t,s,n,i??{algorithm:"PBKDF2",params:{iterations:e}}),o=e=>t=>(0,r.isVaultUpdated)(t,{algorithm:"PBKDF2",params:{iterations:e}});s.encryptorFactory=e=>({encrypt:n(e),encryptWithKey:r.encryptWithKey,encryptWithDetail:i(e),decrypt:r.decrypt,decryptWithKey:r.decryptWithKey,decryptWithDetail:r.decryptWithDetail,keyFromPassword:a(e),isVaultUpdated:o(e),importKey:r.importKey,exportKey:r.exportKey,generateSalt:r.generateSalt})}}},{package:"$root$",file:"app/scripts/lib/encryptor-factory.ts"}],[1942,{"./errors.cjs":1943,"./logger.cjs":1945,"./types.cjs":1946,"./utils.cjs":1947,"@metamask/base-controller":1203,"@metamask/snaps-utils":2713},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,s){var r,n,i,a,o,c,l,u,d=this&&this.__classPrivateFieldGet||function(e,t,s,r){if("a"===s&&!r)throw new TypeError("Private accessor was defined without a getter");if("function"==typeof t?e!==t||!r:!t.has(e))throw new TypeError("Cannot read private member from an object whose class did not declare it");return"m"===s?r:"a"===s?r.call(e):r?r.value:t.get(e)};Object.defineProperty(s,"__esModule",{value:!0}),s.getDefaultGatorPermissionsControllerState=void 0;const p=e("@metamask/base-controller"),h=e("@metamask/snaps-utils"),m=e("./errors.cjs"),g=e("./logger.cjs"),f=e("./types.cjs"),y=e("./utils.cjs"),w="GatorPermissionsController",v={"native-token-stream":{},"native-token-periodic":{},"erc20-token-stream":{},"erc20-token-periodic":{},other:{}},b={isGatorPermissionsEnabled:{persist:!0,anonymous:!1},gatorPermissionsMapSerialized:{persist:!0,anonymous:!1},isFetchingGatorPermissions:{persist:!1,anonymous:!1},gatorPermissionsProviderSnapId:{persist:!1,anonymous:!1}};function S(){return{isGatorPermissionsEnabled:!1,gatorPermissionsMapSerialized:(0,y.serializeGatorPermissionsMap)(v),isFetchingGatorPermissions:!1,gatorPermissionsProviderSnapId:"@metamask/gator-permissions-snap"}}s.getDefaultGatorPermissionsControllerState=S;class E extends p.BaseController{constructor({messenger:e,state:t}){super({name:w,metadata:b,messenger:e,state:{...S(),...t,isFetchingGatorPermissions:!1}}),r.add(this),d(this,r,"m",a).call(this)}get gatorPermissionsMap(){return(0,y.deserializeGatorPermissionsMap)(this.state.gatorPermissionsMapSerialized)}get permissionsProviderSnapId(){return this.state.gatorPermissionsProviderSnapId}async enableGatorPermissions(){d(this,r,"m",i).call(this,!0)}async disableGatorPermissions(){this.update(e=>{e.isGatorPermissionsEnabled=!1,e.gatorPermissionsMapSerialized=(0,y.serializeGatorPermissionsMap)(v)})}async fetchAndUpdateGatorPermissions(){try{d(this,r,"m",n).call(this,!0),d(this,r,"m",o).call(this);const e=await d(this,r,"m",c).call(this,{snapId:this.state.gatorPermissionsProviderSnapId}),t=d(this,r,"m",u).call(this,e);return this.update(e=>{e.gatorPermissionsMapSerialized=(0,y.serializeGatorPermissionsMap)(t)}),t}catch(e){throw(0,g.controllerLog)("Failed to fetch gator permissions",e),new m.GatorPermissionsFetchError({message:"Failed to fetch gator permissions",cause:e})}finally{d(this,r,"m",n).call(this,!1)}}}r=new WeakSet,n=function(e){this.update(t=>{t.isFetchingGatorPermissions=e})},i=function(e){this.update(t=>{t.isGatorPermissionsEnabled=e})},a=function(){this.messagingSystem.registerActionHandler(`${w}:fetchAndUpdateGatorPermissions`,this.fetchAndUpdateGatorPermissions.bind(this)),this.messagingSystem.registerActionHandler(`${w}:enableGatorPermissions`,this.enableGatorPermissions.bind(this)),this.messagingSystem.registerActionHandler(`${w}:disableGatorPermissions`,this.disableGatorPermissions.bind(this))},o=function(){if(!this.state.isGatorPermissionsEnabled)throw new m.GatorPermissionsNotEnabledError},c=async function({snapId:e}){try{return await this.messagingSystem.call("SnapController:handleRequest",{snapId:e,origin:"metamask",handler:h.HandlerType.OnRpcRequest,request:{jsonrpc:"2.0",method:f.GatorPermissionsSnapRpcMethod.PermissionProviderGetGrantedPermissions}})}catch(e){throw(0,g.controllerLog)("Failed to handle snap request to gator permissions provider",e),new m.GatorPermissionsProviderError({method:f.GatorPermissionsSnapRpcMethod.PermissionProviderGetGrantedPermissions,cause:e})}},l=function(e){const{permissionResponse:t}=e,{rules:s,dependencyInfo:r,signer:n,...i}=t;return{...e,permissionResponse:{...i}}},u=function(e){return e?e.reduce((e,t)=>{const{permissionResponse:s}=t,n=s.permission.type,{chainId:i}=s,a=d(this,r,"m",l).call(this,t);switch(n){case"native-token-stream":case"native-token-periodic":case"erc20-token-stream":case"erc20-token-periodic":e[n][i]||(e[n][i]=[]),e[n][i].push(a);break;default:e.other[i]||(e.other[i]=[]),e.other[i].push(a)}return e},{"native-token-stream":{},"native-token-periodic":{},"erc20-token-stream":{},"erc20-token-periodic":{},other:{}}):v},s.default=E}}},{package:"@metamask/gator-permissions-controller",file:"node_modules/@metamask/gator-permissions-controller/dist/GatorPermissionsController.cjs"}],[1943,{"./types.cjs":1946},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,s){Object.defineProperty(s,"__esModule",{value:!0}),s.GatorPermissionsProviderError=s.GatorPermissionsNotEnabledError=s.GatorPermissionsMapSerializationError=s.GatorPermissionsFetchError=s.GatorPermissionsControllerError=void 0;const r=e("./types.cjs");class n extends Error{constructor({cause:e,message:t,code:s}){super(t),this.cause=e,this.code=s}}s.GatorPermissionsControllerError=n;s.GatorPermissionsFetchError=class extends n{constructor({cause:e,message:t}){super({cause:e,message:t,code:r.GatorPermissionsControllerErrorCode.GatorPermissionsFetchError})}};s.GatorPermissionsMapSerializationError=class extends n{constructor({cause:e,message:t,data:s}){super({cause:e,message:t,code:r.GatorPermissionsControllerErrorCode.GatorPermissionsMapSerializationError}),this.data=s}};s.GatorPermissionsNotEnabledError=class extends n{constructor(){super({cause:new Error("Gator permissions are not enabled"),message:"Gator permissions are not enabled",code:r.GatorPermissionsControllerErrorCode.GatorPermissionsNotEnabled})}};s.GatorPermissionsProviderError=class extends n{constructor({cause:e,method:t}){super({cause:e,message:`Failed to handle snap request to gator permissions provider for method ${t}`,code:r.GatorPermissionsControllerErrorCode.GatorPermissionsProviderError})}}}}},{package:"@metamask/gator-permissions-controller",file:"node_modules/@metamask/gator-permissions-controller/dist/errors.cjs"}],[1944,{"./GatorPermissionsController.cjs":1942,"./utils.cjs":1947},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,s){var r=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(s,"__esModule",{value:!0}),s.deserializeGatorPermissionsMap=s.serializeGatorPermissionsMap=s.GatorPermissionsController=void 0;var n=e("./GatorPermissionsController.cjs");Object.defineProperty(s,"GatorPermissionsController",{enumerable:!0,get:function(){return r(n).default}});var i=e("./utils.cjs");Object.defineProperty(s,"serializeGatorPermissionsMap",{enumerable:!0,get:function(){return i.serializeGatorPermissionsMap}}),Object.defineProperty(s,"deserializeGatorPermissionsMap",{enumerable:!0,get:function(){return i.deserializeGatorPermissionsMap}})}}},{package:"@metamask/gator-permissions-controller",file:"node_modules/@metamask/gator-permissions-controller/dist/index.cjs"}],[1945,{"@metamask/utils":2835},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,s){Object.defineProperty(s,"__esModule",{value:!0}),s.createModuleLogger=s.utilsLog=s.controllerLog=s.projectLogger=void 0;const r=e("@metamask/utils");Object.defineProperty(s,"createModuleLogger",{enumerable:!0,get:function(){return r.createModuleLogger}}),s.projectLogger=(0,r.createProjectLogger)("gator-permissions-controller"),s.controllerLog=(0,r.createModuleLogger)(s.projectLogger,"GatorPermissionsController"),s.utilsLog=(0,r.createModuleLogger)(s.projectLogger,"utils")}}},{package:"@metamask/gator-permissions-controller",file:"node_modules/@metamask/gator-permissions-controller/dist/logger.cjs"}],[1946,{},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,s){var r,n;Object.defineProperty(s,"__esModule",{value:!0}),s.GatorPermissionsSnapRpcMethod=s.GatorPermissionsControllerErrorCode=void 0,function(e){e.GatorPermissionsFetchError="gator-permissions-fetch-error",e.GatorPermissionsNotEnabled="gator-permissions-not-enabled",e.GatorPermissionsProviderError="gator-permissions-provider-error",e.GatorPermissionsMapSerializationError="gator-permissions-map-serialization-error"}(r||(s.GatorPermissionsControllerErrorCode=r={})),function(e){e.PermissionProviderGetGrantedPermissions="permissionsProvider_getGrantedPermissions"}(n||(s.GatorPermissionsSnapRpcMethod=n={}))}}},{package:"@metamask/gator-permissions-controller",file:"node_modules/@metamask/gator-permissions-controller/dist/types.cjs"}],[1947,{"./errors.cjs":1943,"./logger.cjs":1945},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,s){Object.defineProperty(s,"__esModule",{value:!0}),s.deserializeGatorPermissionsMap=s.serializeGatorPermissionsMap=void 0;const r=e("./errors.cjs"),n=e("./logger.cjs");s.serializeGatorPermissionsMap=function(e){try{return JSON.stringify(e)}catch(t){throw(0,n.utilsLog)("Failed to serialize gator permissions map",t),new r.GatorPermissionsMapSerializationError({cause:t,message:"Failed to serialize gator permissions map",data:e})}},s.deserializeGatorPermissionsMap=function(e){try{return JSON.parse(e)}catch(t){throw(0,n.utilsLog)("Failed to deserialize gator permissions map",t),new r.GatorPermissionsMapSerializationError({cause:t,message:"Failed to deserialize gator permissions map",data:e})}}}}},{package:"@metamask/gator-permissions-controller",file:"node_modules/@metamask/gator-permissions-controller/dist/utils.cjs"}],[195,{},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,s){Object.defineProperty(s,"__esModule",{value:!0}),s.default=void 0;s.default=[{constant:!0,inputs:[{name:"node",type:"bytes32"}],name:"resolver",outputs:[{name:"",type:"address"}],payable:!1,type:"function"},{constant:!0,inputs:[{name:"node",type:"bytes32"}],name:"owner",outputs:[{name:"",type:"address"}],payable:!1,type:"function"},{constant:!1,inputs:[{name:"node",type:"bytes32"},{name:"label",type:"bytes32"},{name:"owner",type:"address"}],name:"setSubnodeOwner",outputs:[],payable:!1,type:"function"},{constant:!1,inputs:[{name:"node",type:"bytes32"},{name:"ttl",type:"uint64"}],name:"setTTL",outputs:[],payable:!1,type:"function"},{constant:!0,inputs:[{name:"node",type:"bytes32"}],name:"ttl",outputs:[{name:"",type:"uint64"}],payable:!1,type:"function"},{constant:!1,inputs:[{name:"node",type:"bytes32"},{name:"resolver",type:"address"}],name:"setResolver",outputs:[],payable:!1,type:"function"},{constant:!1,inputs:[{name:"node",type:"bytes32"},{name:"owner",type:"address"}],name:"setOwner",outputs:[],payable:!1,type:"function"},{anonymous:!1,inputs:[{indexed:!0,name:"node",type:"bytes32"},{indexed:!1,name:"owner",type:"address"}],name:"Transfer",type:"event"},{anonymous:!1,inputs:[{indexed:!0,name:"node",type:"bytes32"},{indexed:!0,name:"label",type:"bytes32"},{indexed:!1,name:"owner",type:"address"}],name:"NewOwner",type:"event"},{anonymous:!1,inputs:[{indexed:!0,name:"node",type:"bytes32"},{indexed:!1,name:"resolver",type:"address"}],name:"NewResolver",type:"event"},{anonymous:!1,inputs:[{indexed:!0,name:"node",type:"bytes32"},{indexed:!1,name:"ttl",type:"uint64"}],name:"NewTTL",type:"event"}]}}},{package:"$root$",file:"app/scripts/lib/ens-ipfs/contracts/registry.js"}],[196,{},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,s){Object.defineProperty(s,"__esModule",{value:!0}),s.default=void 0;s.default=[{constant:!1,inputs:[{name:"node",type:"bytes32"},{name:"hash",type:"bytes32"}],name:"setContent",outputs:[],payable:!1,stateMutability:"nonpayable",type:"function"},{constant:!0,inputs:[{name:"node",type:"bytes32"}],name:"content",outputs:[{name:"",type:"bytes32"}],payable:!1,stateMutability:"view",type:"function"},{constant:!0,inputs:[{name:"interfaceID",type:"bytes4"}],name:"supportsInterface",outputs:[{name:"",type:"bool"}],payable:!1,stateMutability:"pure",type:"function"},{constant:!1,inputs:[{name:"node",type:"bytes32"},{name:"key",type:"string"},{name:"value",type:"string"}],name:"setText",outputs:[],payable:!1,stateMutability:"nonpayable",type:"function"},{constant:!0,inputs:[{name:"node",type:"bytes32"},{name:"contentTypes",type:"uint256"}],name:"ABI",outputs:[{name:"contentType",type:"uint256"},{name:"data",type:"bytes"}],payable:!1,stateMutability:"view",type:"function"},{constant:!1,inputs:[{name:"node",type:"bytes32"},{name:"x",type:"bytes32"},{name:"y",type:"bytes32"}],name:"setPubkey",outputs:[],payable:!1,stateMutability:"nonpayable",type:"function"},{constant:!1,inputs:[{name:"node",type:"bytes32"},{name:"hash",type:"bytes"}],name:"setContenthash",outputs:[],payable:!1,stateMutability:"nonpayable",type:"function"},{constant:!0,inputs:[{name:"node",type:"bytes32"}],name:"addr",outputs:[{name:"",type:"address"}],payable:!1,stateMutability:"view",type:"function"},{constant:!0,inputs:[{name:"node",type:"bytes32"},{name:"key",type:"string"}],name:"text",outputs:[{name:"",type:"string"}],payable:!1,stateMutability:"view",type:"function"},{constant:!1,inputs:[{name:"node",type:"bytes32"},{name:"contentType",type:"uint256"},{name:"data",type:"bytes"}],name:"setABI",outputs:[],payable:!1,stateMutability:"nonpayable",type:"function"},{constant:!0,inputs:[{name:"node",type:"bytes32"}],name:"name",outputs:[{name:"",type:"string"}],payable:!1,stateMutability:"view",type:"function"},{constant:!1,inputs:[{name:"node",type:"bytes32"},{name:"name",type:"string"}],name:"setName",outputs:[],payable:!1,stateMutability:"nonpayable",type:"function"},{constant:!0,inputs:[{name:"node",type:"bytes32"}],name:"contenthash",outputs:[{name:"",type:"bytes"}],payable:!1,stateMutability:"view",type:"function"},{constant:!0,inputs:[{name:"node",type:"bytes32"}],name:"pubkey",outputs:[{name:"x",type:"bytes32"},{name:"y",type:"bytes32"}],payable:!1,stateMutability:"view",type:"function"},{constant:!1,inputs:[{name:"node",type:"bytes32"},{name:"addr",type:"address"}],name:"setAddr",outputs:[],payable:!1,stateMutability:"nonpayable",type:"function"},{inputs:[{name:"ensAddr",type:"address"}],payable:!1,stateMutability:"nonpayable",type:"constructor"},{anonymous:!1,inputs:[{indexed:!0,name:"node",type:"bytes32"},{indexed:!1,name:"a",type:"address"}],name:"AddrChanged",type:"event"},{anonymous:!1,inputs:[{indexed:!0,name:"node",type:"bytes32"},{indexed:!1,name:"name",type:"string"}],name:"NameChanged",type:"event"},{anonymous:!1,inputs:[{indexed:!0,name:"node",type:"bytes32"},{indexed:!0,name:"contentType",type:"uint256"}],name:"ABIChanged",type:"event"},{anonymous:!1,inputs:[{indexed:!0,name:"node",type:"bytes32"},{indexed:!1,name:"x",type:"bytes32"},{indexed:!1,name:"y",type:"bytes32"}],name:"PubkeyChanged",type:"event"},{anonymous:!1,inputs:[{indexed:!0,name:"node",type:"bytes32"},{indexed:!1,name:"indexedKey",type:"string"},{indexed:!1,name:"key",type:"string"}],name:"TextChanged",type:"event"},{anonymous:!1,inputs:[{indexed:!0,name:"node",type:"bytes32"},{indexed:!1,name:"hash",type:"bytes"}],name:"ContenthashChanged",type:"event"}]}}},{package:"$root$",file:"app/scripts/lib/ens-ipfs/contracts/resolver.js"}],[197,{"./contracts/registry":195,"./contracts/resolver":196,"@ensdomains/content-hash":547,"@ethersproject/contracts":635,"@ethersproject/providers":673,"eth-ens-namehash":3998},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,s){Object.defineProperty(s,"__esModule",{value:!0}),s.default=async function({provider:e,name:t}){const s=r.default.hash(t),l=Number.parseInt(await e.request({method:"net_version"}),10),d=function(e){switch(e){case 1:case 3:case 4:case 5:case 6:return"0x00000000000C2E074eC69A0dFb2997BA6C7d2e1e";default:return null}}(l);if(!d)throw new Error(`EnsIpfsResolver - no known ens-ipfs registry for chainId "${l}"`);const p=new i.Web3Provider(e),h=new a.Contract(d,o.default,p),m=await h.resolver(s);if(u(m))throw new Error(`EnsIpfsResolver - no resolver found for name "${t}"`);const g=new a.Contract(m,c.default,p),f=await g.supportsInterface("0xbc1c58d1"),y=await g.supportsInterface("0xd8389dc5");if(f){const e=(await g.contenthash(s))[0];let t=n.default.decode(e);const r=n.default.getCodec(e);return"ipfs-ns"!==r&&"ipns-ns"!==r||(t=n.default.helpers.cidV0ToV1Base32(t)),{type:r,hash:t}}if(y){const e=(await g.content(s))[0];if(u(e))throw new Error(`EnsIpfsResolver - no content ID found for name "${t}"`);return{type:"swarm-ns",hash:e.slice(2)}}throw new Error(`EnsIpfsResolver - the resolver for name "${t}" is not standard, it should either supports contenthash() or content()`)};var r=l(e("eth-ens-namehash")),n=l(e("@ensdomains/content-hash")),i=e("@ethersproject/providers"),a=e("@ethersproject/contracts"),o=l(e("./contracts/registry")),c=l(e("./contracts/resolver"));function l(e){return e&&e.__esModule?e:{default:e}}function u(e){return[undefined,null,"0x","0x0","0x0000000000000000000000000000000000000000000000000000000000000000"].includes(e)}}}},{package:"$root$",file:"app/scripts/lib/ens-ipfs/resolver.js"}],[198,{"../../../../shared/modules/fetch-with-timeout":5562,"./resolver":197,"base32-encode":3681,"base64-js":3682,"webextension-polyfill":5430},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,s){Object.defineProperty(s,"__esModule",{value:!0}),s.default=function({provider:e,getCurrentChainId:t,getIpfsGateway:s,getUseAddressBarEnsResolution:a}){const c=u.map(e=>`*://*.${e}/*`);return i.default.webRequest.onErrorOccurred.addListener(d,{urls:c,types:["main_frame"]}),{remove(){i.default.webRequest.onErrorOccurred.removeListener(d)}};async function d(c){const{tabId:d,url:p}=c;if(-1===d||"0x1"!==t())return;const{hostname:h,pathname:m,search:g,hash:f}=new URL(p),y=h.split("."),w=y[y.length-1];u.includes(w)&&async function({tabId:t,name:c,pathname:u,search:d,fragment:p}){const h=s(),m=a(),g=`https://app.ens.domains/name/${c}`;m&&h&&await i.default.tabs.update(t,{url:"loading.html"});let f=g;0;try{const{type:t,hash:s}=await(0,o.default)({provider:e,name:c});if("ipfs-ns"===t||"ipns-ns"===t){if(""===h)return void(f=null);const e=`https://${s}.${t.slice(0,4)}.${h}${u}${d||""}${p||""}`;try{200===(await l(e,{method:"HEAD"})).status&&(f=e)}catch(e){console.warn(e)}}else if("swarm-ns"===t)f=`https://swarm-gateways.net/bzz:/${s}${u}${d||""}${p||""}`;else if("onion"===t||"onion3"===t)f=`http://${s}.onion${u}${d||""}${p||""}`;else if("zeronet"===t)f=`http://127.0.0.1:43110/${s}${u}${d||""}${p||""}`;else if("skynet-ns"===t){const e=s.padEnd(s.length+4-s.length%4,"="),t=n.default.toByteArray(e),i={padding:!1};f=`https://${(0,r.default)(t,"RFC4648-HEX",i).toLowerCase()}.siasky.net${u}${d||""}${p||""}`}}catch(e){console.warn(e)}finally{f&&(m||!m&&f!==g)&&await i.default.tabs.update(t,{url:f})}}({tabId:d,name:h,pathname:m,search:g,fragment:f})}};var r=c(e("base32-encode")),n=c(e("base64-js")),i=c(e("webextension-polyfill")),a=c(e("../../../../shared/modules/fetch-with-timeout")),o=c(e("./resolver"));function c(e){return e&&e.__esModule?e:{default:e}}const l=(0,a.default)(),u=["eth"]}}},{package:"$root$",file:"app/scripts/lib/ens-ipfs/setup.js"}],[199,{"@metamask/snaps-sdk":2599,"@metamask/snaps-utils":2713},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,s){Object.defineProperty(s,"__esModule",{value:!0}),s.forwardRequestToSnap=async function(e,t,s){const{method:i,params:a,origin:o}=s,{handleRequest:c,snapId:l}=e;if(!l)throw new n.InternalError(`No snapId configured for method ${i}`);if(!o)throw new n.InternalError(`No origin specified for method ${i}`);return await c({snapId:l,origin:o,handler:r.HandlerType.OnRpcRequest,request:{jsonrpc:"2.0",method:i,params:a}})};var r=e("@metamask/snaps-utils"),n=e("@metamask/snaps-sdk")}}},{package:"$root$",file:"app/scripts/lib/forwardRequestToSnap.ts"}],[20,{"../../../shared/constants/bridge":5449,"../../../shared/lib/trace":5546,"@metamask/bridge-status-controller":1268,"@metamask/controller-utils":1321},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,s){Object.defineProperty(s,"__esModule",{value:!0}),s.BridgeStatusControllerInit=void 0;var r=e("@metamask/bridge-status-controller"),n=e("@metamask/controller-utils"),i=e("../../../shared/lib/trace"),a=e("../../../shared/constants/bridge");s.BridgeStatusControllerInit=({controllerMessenger:e,persistedState:t,getController:s})=>{const o=s("TransactionController");return{controller:new r.BridgeStatusController({messenger:e,state:t.BridgeStatusController,fetchFn:async(e,t)=>await(0,n.handleFetch)(e,{method:"GET",...t}),addTransactionFn:(...e)=>o.addTransaction(...e),addTransactionBatchFn:(...e)=>o.addTransactionBatch(...e),estimateGasFeeFn:(...e)=>o.estimateGasFee(...e),updateTransactionFn:(...e)=>o.updateTransaction(...e),config:{customBridgeApiBaseUrl:a.BRIDGE_API_BASE_URL},traceFn:(...e)=>(0,i.trace)(...e)})}}}}},{package:"$root$",file:"app/scripts/controller-init/bridge-status-controller-init.ts"}],[200,{lodash:4565},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,s){Object.defineProperty(s,"__esModule",{value:!0}),s.default=function(e){return n((0,r.cloneDeep)(e),e=>null===e?"null":typeof e)};var r=e("lodash");function n(e={},t){return Object.entries(e).forEach(([s,r])=>{e[s]="object"==typeof r&&null!==r?n(r,t):t(r)}),e}}}},{package:"$root$",file:"app/scripts/lib/getObjStructure.js"}],[201,{},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,s){Object.defineProperty(s,"__esModule",{value:!0}),s.hardwareKeyringBuilderFactory=function(e,t){const s=()=>new e({bridge:new t});return s.type=e.type,s}}}},{package:"$root$",file:"app/scripts/lib/hardware-keyring-builder-factory.ts"}],[203,{"../util":276,"@metamask/json-rpc-engine":1961},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,s){Object.defineProperty(s,"__esModule",{value:!0}),s.createPendingNonceMiddleware=function({getPendingNonce:e}){return(0,r.createAsyncMiddleware)(async(t,s,r)=>{const{method:n,params:i}=t;if("eth_getTransactionCount"!==n)return void r();const[a,o]=i;"pending"===o?s.result=await e(a,t.networkClientId):r()})},s.createPendingTxMiddleware=function({getPendingTransactionByHash:e}){return(0,r.createAsyncMiddleware)(async(t,s,r)=>{const{method:i,params:a}=t;if("eth_getTransactionByHash"!==i)return void r();const[o]=a,c=e(o);c?s.result=(0,n.formatTxMetaForRpcResult)(c):r()})};var r=e("@metamask/json-rpc-engine"),n=e("../util")}}},{package:"$root$",file:"app/scripts/lib/middleware/pending.js"}],[204,{events:4105,loglevel:4573},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,s){Object.defineProperty(s,"__esModule",{value:!0}),s.default=void 0;var r=i(e("events")),n=i(e("loglevel"));function i(e){return e&&e.__esModule?e:{default:e}}class a extends r.default{constructor(e={}){super();const t=e.migrations||[];this.migrations=t.sort((e,t)=>e.version-t.version);const s=this.migrations.slice(-1)[0];this.defaultVersion=e.defaultVersion||s&&s.version||0}async migrateData(e=this.generateInitialState()){const t=this.migrations.filter(function(t){return t.version>e.meta.version});for(const s of t)try{n.default.info(`Running migration ${s.version}...`);const t=await s.migrate(e);if(!t.data)throw new Error("Migrator - migration returned empty data");if(t.version!==undefined&&t.meta.version!==s.version)throw new Error("Migrator - Migration did not update version number correctly");e=t,n.default.info(`Migration ${s.version} complete`)}catch(t){const r=t.message;return t.message=`MetaMask Migration Error #${s.version}: ${r}`,this.emit("error",t),e}return e}generateInitialState(e){return{data:e,meta:{version:this.defaultVersion}}}}s.default=a}}},{package:"$root$",file:"app/scripts/lib/migrator/index.js"}],[206,{"../../../../shared/constants/metametrics":5462,"../../../../shared/lib/only-keep-host":5538,"./utils":207,"@metamask/utils":2835,loglevel:4573},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,s){Object.defineProperty(s,"__esModule",{value:!0}),s.onRpcEndpointDegraded=function({chainId:e,endpointUrl:t,error:s,infuraProjectId:r,metaMetricsId:n,trackEvent:i}){l(a.MetaMetricsEventName.RpcServiceDegraded,{chainId:e,endpointUrl:t,error:s,infuraProjectId:r,metaMetricsId:n,trackEvent:i})},s.onRpcEndpointUnavailable=function({chainId:e,endpointUrl:t,error:s,infuraProjectId:r,metaMetricsId:n,trackEvent:i}){l(a.MetaMetricsEventName.RpcServiceUnavailable,{chainId:e,endpointUrl:t,error:s,infuraProjectId:r,metaMetricsId:n,trackEvent:i})},s.trackRpcEndpointEvent=l;var r,n=(r=e("loglevel"))&&r.__esModule?r:{default:r},i=e("@metamask/utils"),a=e("../../../../shared/constants/metametrics"),o=e("../../../../shared/lib/only-keep-host"),c=e("./utils");function l(e,{chainId:t,endpointUrl:s,error:r,infuraProjectId:l,trackEvent:u,metaMetricsId:d}){if(!(0,c.shouldCreateRpcServiceEvents)({error:r,metaMetricsId:d}))return;const p={chain_id_caip:`eip155:${(0,i.hexToNumber)(t)}`,rpc_endpoint_url:(0,c.isPublicEndpointUrl)(s,l)?(0,o.onlyKeepHost)(s):"custom",...(0,i.isObject)(r)&&"httpStatus"in r&&(0,i.isValidJson)(r.httpStatus)?{http_status:r.httpStatus}:{}};n.default.debug(`Creating Segment event "${e}" with ${JSON.stringify(p)}`),u({category:a.MetaMetricsEventCategory.Network,event:e,properties:p})}}}},{package:"$root$",file:"app/scripts/lib/network-controller/messenger-action-handlers.ts"}],[2067,{"@metamask/base-controller":1203,events:4105,uuid:5398},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,s){Object.defineProperty(s,"__esModule",{value:!0}),s.AbstractMessageManager=void 0;const r=e("@metamask/base-controller"),n=e("events"),i=e("uuid"),a={unapprovedMessages:{persist:!1,anonymous:!1},unapprovedMessagesCount:{persist:!1,anonymous:!1}};class o extends r.BaseController{constructor({additionalFinishStatuses:e,messenger:t,name:s,securityProviderRequest:r,state:i={}}){super({messenger:t,metadata:a,name:s,state:{unapprovedMessages:{},unapprovedMessagesCount:0,...i}}),this.internalEvents=new n.EventEmitter,this.messages=[],this.securityProviderRequest=r,this.additionalFinishStatuses=e??[]}addRequestToMessageParams(e,t){const s={...e};return t&&(s.requestId=t.id,s.origin=t.origin),s}createUnapprovedMessage(e,t,s){return{id:(0,i.v1)(),messageParams:e,securityAlertResponse:s?.securityAlertResponse,status:"unapproved",time:Date.now(),type:t}}saveMessageList(e=!0){this.update(e=>{e.unapprovedMessages=this.getUnapprovedMessages(),e.unapprovedMessagesCount=this.getUnapprovedMessagesCount()}),e&&this.messagingSystem.publish(`${this.name}:updateBadge`)}setMessageStatus(e,t){const s=this.getMessage(e);if(!s)throw new Error(`${this.name}: Message not found for id: ${e}.`);const r={...s,status:t};this.updateMessage(r),this.internalEvents.emit(`${e}:${t}`,r),("rejected"===t||"signed"===t||"errored"===t||this.additionalFinishStatuses.includes(t))&&this.internalEvents.emit(`${e}:finished`,r)}updateMessage(e,t=!0){const s=this.messages.findIndex(t=>e.id===t.id);-1!==s&&(this.messages[s]=e),this.saveMessageList(t)}async securityCheck(e){if(this.securityProviderRequest){const t=await this.securityProviderRequest(e,e.type);return{...e,securityProviderResponse:t}}return e}clearUnapprovedMessages(){this.update(e=>{e.unapprovedMessages={},e.unapprovedMessagesCount=0})}getUnapprovedMessagesCount(){return Object.keys(this.getUnapprovedMessages()).length}getUnapprovedMessages(){return this.messages.filter(e=>"unapproved"===e.status).reduce((e,t)=>(e[t.id]=t,e),{})}async addMessage(e){const t=await this.securityCheck(e);this.messages.push(t),this.saveMessageList()}getMessage(e){return this.messages.find(t=>t.id===e)}getAllMessages(){return this.messages}approveMessage(e){return this.setMessageStatusApproved(e.metamaskId),this.prepMessageForSigning(e)}setMessageStatusApproved(e){this.setMessageStatus(e,"approved")}setMessageStatusInProgress(e){this.setMessageStatus(e,"inProgress")}setMessageStatusSigned(e,t){this.setMessageStatusAndResult(e,t,"signed")}setMessageStatusAndResult(e,t,s){this.setResult(e,t),this.setMessageStatus(e,s)}setResult(e,t){const s=this.getMessage(e);s&&this.updateMessage({...s,rawSig:t},!1)}setMetadata(e,t){const s=this.getMessage(e);if(!s)throw new Error(`${this.name}: Message not found for id: ${e}.`);this.updateMessage({...s,metadata:t},!1)}rejectMessage(e){this.setMessageStatus(e,"rejected")}async waitForFinishStatus(e,t){const{metamaskId:s,...r}=e;return new Promise((e,n)=>{this.internalEvents.once(`${s}:finished`,s=>{switch(s.status){case"signed":return e(s.rawSig);case"rejected":return n(new Error(`MetaMask ${t} Signature: User denied message signature.`));case"errored":return n(new Error(`MetaMask ${t} Signature: ${s.error}`));default:return n(new Error(`MetaMask ${t} Signature: Unknown problem: ${JSON.stringify(r)}`))}})})}}s.AbstractMessageManager=o,s.default=o}}},{package:"@metamask/message-manager",file:"node_modules/@metamask/message-manager/dist/AbstractMessageManager.cjs"}],[2068,{"./AbstractMessageManager.cjs":2067,"./utils.cjs":2072,"@metamask/controller-utils":1321},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,s){Object.defineProperty(s,"__esModule",{value:!0}),s.DecryptMessageManager=void 0;const r=e("@metamask/controller-utils"),n=e("./AbstractMessageManager.cjs"),i=e("./utils.cjs"),a="DecryptMessageManager";class o extends n.AbstractMessageManager{constructor({additionalFinishStatuses:e,messenger:t,securityProviderRequest:s,state:r}){super({additionalFinishStatuses:e,messenger:t,name:a,securityProviderRequest:s,state:r})}async addUnapprovedMessageAsync(e,t){(0,i.validateDecryptedMessageData)(e);const s=await this.addUnapprovedMessage(e,t);return new Promise((t,r)=>{this.internalEvents.once(`${s}:finished`,s=>{switch(s.status){case"decrypted":return t(s.rawSig);case"rejected":return r(new Error("MetaMask DecryptMessage: User denied message decryption."));case"errored":return r(new Error("MetaMask DecryptMessage: This message cannot be decrypted."));default:return r(new Error(`MetaMask DecryptMessage: Unknown problem: ${JSON.stringify(e)}`))}})})}async addUnapprovedMessage(e,t){const s=this.addRequestToMessageParams(e,t);e.data=(0,i.normalizeMessageData)(e.data);const n=this.createUnapprovedMessage(s,r.ApprovalType.EthDecrypt,t),o=n.id;return await this.addMessage(n),this.messagingSystem.publish(`${a}:unapprovedMessage`,{...s,metamaskId:o}),o}prepMessageForSigning(e){return delete e.metamaskId,Promise.resolve(e)}}s.DecryptMessageManager=o}}},{package:"@metamask/message-manager",file:"node_modules/@metamask/message-manager/dist/DecryptMessageManager.cjs"}]],[],{});